<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ç¬¬4ç« æ•°æ®å¯è§†åŒ–å¹³å° - Pythonæ•°æ®å¯è§†åŒ–åŸºç¡€</title>
    <!-- åŠ å›ºCDNåŠ è½½ - å¤šä¸ªå¤‡é€‰æº -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js@3.9.1/dist/chart.min.js"></script>
    <script>
        // Chart.js åŠ è½½å¤±è´¥æ£€æµ‹å’Œé‡è¯•
        if (typeof Chart === 'undefined') {
            document.write('<script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.9.1/chart.min.js"><\/script>');
        }
    </script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
        }

        .header {
            text-align: center;
            color: white;
            margin-bottom: 40px;
            animation: fadeInDown 1s ease;
        }

        .header h1 {
            font-size: 2.8rem;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }

        .header p {
            font-size: 1.2rem;
            opacity: 0.9;
        }

        .tabs {
            display: flex;
            justify-content: center;
            margin-bottom: 30px;
            flex-wrap: wrap;
            gap: 10px;
        }

        .tab-button {
            padding: 12px 24px;
            background: rgba(255, 255, 255, 0.2);
            border: 2px solid rgba(255, 255, 255, 0.3);
            color: white;
            cursor: pointer;
            border-radius: 30px;
            transition: all 0.3s ease;
            font-size: 1rem;
            font-weight: 600;
        }

        .tab-button:hover {
            background: rgba(255, 255, 255, 0.3);
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
        }

        .tab-button.active {
            background: white;
            color: #667eea;
            transform: scale(1.05);
        }

        .content-area {
            background: white;
            border-radius: 20px;
            padding: 30px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
            animation: fadeInUp 1s ease;
        }

        .tab-content {
            display: none;
            animation: fadeIn 0.5s ease;
        }

        .tab-content.active {
            display: block;
        }

        .chart-container {
            margin-bottom: 30px;
            background: #f8f9fa;
            border-radius: 15px;
            padding: 20px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }

        .chart-title {
            font-size: 1.4rem;
            color: #333;
            margin-bottom: 20px;
            text-align: center;
            font-weight: 600;
        }

        .chart-wrapper {
            position: relative;
            height: 400px;
            width: 100%;
        }

        .controls {
            margin-top: 20px;
            text-align: center;
        }

        .control-btn {
            padding: 10px 20px;
            background: #667eea;
            color: white;
            border: none;
            border-radius: 25px;
            cursor: pointer;
            margin: 0 10px;
            transition: all 0.3s ease;
            font-size: 0.9rem;
            font-weight: 600;
        }

        .control-btn:hover {
            background: #5a6fd8;
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4);
        }

        .grid-layout {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(500px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }

        .stats-info {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            padding: 15px;
            border-radius: 10px;
            margin-top: 20px;
            text-align: center;
        }

        @keyframes fadeInDown {
            from {
                opacity: 0;
                transform: translateY(-30px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        @keyframes fadeInUp {
            from {
                opacity: 0;
                transform: translateY(30px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        @media (max-width: 768px) {
            .header h1 {
                font-size: 2rem;
            }
            
            .grid-layout {
                grid-template-columns: 1fr;
            }
            
            .tabs {
                justify-content: center;
            }
            
            .tab-button {
                font-size: 0.9rem;
                padding: 10px 20px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ğŸ“Š ç¬¬4ç« æ•°æ®å¯è§†åŒ–å¹³å°</h1>
            <p>Pythonæ•°æ®å¯è§†åŒ–åŸºç¡€ - 5ç§æ ¸å¿ƒå›¾è¡¨ç±»å‹æ¼”ç¤º</p>
        </div>

        <div class="tabs">
            <button class="tab-button active" onclick="showTab('book', this)">å®ä¾‹1ï¼šå›¾ä¹¦é‡‡è´­</button>
            <button class="tab-button" onclick="showTab('exchange', this)">å®ä¾‹2ï¼šæ±‡ç‡èµ°åŠ¿</button>
            <button class="tab-button" onclick="showTab('sales', this)">å®ä¾‹3ï¼šäº§å“é”€å”®é¢</button>
            <button class="tab-button" onclick="showTab('temperature', this)">å®ä¾‹4ï¼šæ°”æ¸©èµ°åŠ¿</button>
            <button class="tab-button" onclick="showTab('snowflake', this)">å®ä¾‹5ï¼šå½©è‰²é›ªèŠ±</button>
        </div>

        <div class="content-area">
            <!-- å®ä¾‹1ï¼šå›¾ä¹¦é‡‡è´­ -->
            <div id="book" class="tab-content active">
                <div class="chart-container">
                    <div class="chart-title">ğŸ“š ä¸¤ä¸ªåœ°åŒºå¯¹ä¸åŒç§ç±»å›¾ä¹¦çš„é‡‡è´­æƒ…å†µ</div>
                    <div class="chart-wrapper">
                        <canvas id="bookChart"></canvas>
                    </div>
                    <div class="controls">
                        <button class="control-btn" onclick="generateBookData()">ğŸ”„ é‡æ–°ç”Ÿæˆæ•°æ®</button>
                        <button class="control-btn" onclick="toggleBookType()">ğŸ“Š åˆ‡æ¢å›¾è¡¨ç±»å‹</button>
                    </div>
                    <div class="stats-info">
                        <p>å †å æŸ±å½¢å›¾å±•ç¤ºä¸¤ä¸ªåœ°åŒºå¯¹ä¸åŒå›¾ä¹¦ç±»åˆ«çš„é‡‡è´­æ•°é‡å¯¹æ¯”ï¼Œå¸®åŠ©åˆ†æåœ°åŒºé—´é‡‡è´­åå¥½å·®å¼‚</p>
                    </div>
                </div>
            </div>

            <!-- å®ä¾‹2ï¼šæ±‡ç‡èµ°åŠ¿ -->
            <div id="exchange" class="tab-content">
                <div class="chart-container">
                    <div class="chart-title">ğŸ’° 2017å¹´7æœˆä¸2019å¹´7æœˆç¾å…ƒ/äººæ°‘å¸æ±‡ç‡èµ°åŠ¿</div>
                    <div class="chart-wrapper">
                        <canvas id="exchangeChart"></canvas>
                    </div>
                    <div class="controls">
                        <button class="control-btn" onclick="generateExchangeData()">ğŸ”„ åˆ·æ–°æ•°æ®</button>
                        <button class="control-btn" onclick="toggleLineStyle()">ğŸ“ˆ åˆ‡æ¢çº¿å‹</button>
                    </div>
                    <div class="stats-info">
                        <p>åŒæŠ˜çº¿å›¾å±•ç¤ºä¸åŒå¹´ä»½åŒæœˆæ±‡ç‡å˜åŒ–è¶‹åŠ¿ï¼Œåˆ†ææ±‡ç‡æ³¢åŠ¨è§„å¾‹å’Œå­£èŠ‚æ€§ç‰¹å¾</p>
                    </div>
                </div>
            </div>

            <!-- å®ä¾‹3ï¼šäº§å“é”€å”®é¢ -->
            <div id="sales" class="tab-content">
                <div class="chart-container">
                    <div class="chart-title">ğŸ“ˆ æ ‡è®°ä¸åŒäº§å“å„å­£åº¦çš„é”€å”®é¢</div>
                    <div class="chart-wrapper">
                        <canvas id="salesChart"></canvas>
                    </div>
                    <div class="controls">
                        <button class="control-btn" onclick="generateSalesData()">ğŸ”„ æ›´æ–°æ•°æ®</button>
                        <button class="control-btn" onclick="toggleMarkerStyle()">ğŸ¯ åˆ‡æ¢æ ‡è®°æ ·å¼</button>
                    </div>
                    <div class="stats-info">
                        <p>å¤šç³»åˆ—æŠ˜çº¿å›¾å±•ç¤ºä¸åŒäº§å“åœ¨å„å­£åº¦çš„é”€å”®è¡¨ç°ï¼ŒåŒ…å«æ•°æ®ç‚¹æ ‡è®°ä¾¿äºç²¾ç¡®è¯»å–</p>
                    </div>
                </div>
            </div>

            <!-- å®ä¾‹4ï¼šæ°”æ¸©èµ°åŠ¿ -->
            <div id="temperature" class="tab-content">
                <div class="chart-container">
                    <div class="chart-title">ğŸŒ¡ï¸ æœªæ¥15å¤©æœ€é«˜æ°”æ¸©å’Œæœ€ä½æ°”æ¸©çš„èµ°åŠ¿</div>
                    <div class="chart-wrapper">
                        <canvas id="temperatureChart"></canvas>
                    </div>
                    <div class="controls">
                        <button class="control-btn" onclick="generateTemperatureData()">ğŸ”„ é‡æ–°ç”Ÿæˆæ•°æ®</button>
                        <button class="control-btn" onclick="toggleTemperatureLabels()">ğŸ·ï¸ æ˜¾ç¤º/éšè—æ•°å€¼æ ‡ç­¾</button>
                    </div>
                    <div class="stats-info">
                        <p>åŒæŠ˜çº¿å›¾å±•ç¤ºæœªæ¥ä¸¤å‘¨æ¸©åº¦å˜åŒ–è¶‹åŠ¿ï¼ŒåŒ…å«æ•°å€¼æ ‡æ³¨ä¾¿äºç²¾ç¡®äº†è§£æ¯æ—¥æ¸©åº¦æƒ…å†µ</p>
                    </div>
                </div>
            </div>

            <!-- å®ä¾‹5ï¼šå½©è‰²é›ªèŠ± -->
            <div id="snowflake" class="tab-content">
                <div class="chart-container">
                    <div class="chart-title">â„ï¸ å½©è‰²çš„"é›ªèŠ±"åˆ†å½¢å›¾æ¡ˆ</div>
                    <div class="chart-wrapper">
                        <canvas id="kochSnowflake" width="600" height="400"></canvas>
                    </div>
                    <div class="controls">
                        <div style="display: flex; gap: 10px; align-items: center; flex-wrap: wrap;">
                            <label>è¿­ä»£æ¬¡æ•°:</label>
                            <select id="snowflakeIterations" onchange="drawKochSnowflake()">
                                <option value="0">0</option>
                                <option value="1">1</option>
                                <option value="2">2</option>
                                <option value="3" selected>3</option>
                                <option value="4">4</option>
                            </select>
                            <label>é¢œè‰²:</label>
                            <select id="snowflakeColor" onchange="drawKochSnowflake()">
                                <option value="#FF6B6B">çŠç‘šçº¢</option>
                                <option value="#4ECDC4">é’ç»¿è‰²</option>
                                <option value="#45B7D1">å¤©è“è‰²</option>
                                <option value="#96CEB4">è–„è·ç»¿</option>
                                <option value="#DDA0DD">æ¢…èŠ±ç´«</option>
                                <option value="#FFB6C1">ç²‰çº¢è‰²</option>
                            </select>
                            <button class="control-btn" onclick="animateSnowflake()">ğŸ¬ åŠ¨ç”»æ¼”ç¤º</button>
                            <button class="control-btn" onclick="drawKochSnowflake()">ğŸ”„ é‡æ–°ç»˜åˆ¶</button>
                        </div>
                    </div>
                    <div class="stats-info">
                        <p>Koché›ªèŠ±åˆ†å½¢å›¾æ¡ˆå±•ç¤ºæ•°å­¦ä¹‹ç¾ï¼Œé€šè¿‡è¿­ä»£ç®—æ³•ç”Ÿæˆå…·æœ‰è‡ªç›¸ä¼¼æ€§çš„å‡ ä½•å›¾å½¢</p>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // å…¨å±€å˜é‡å­˜å‚¨å›¾è¡¨å®ä¾‹
        let charts = {};
        let currentSnowflakeColor = '#FF6B6B';
        let snowflakeComplexity = 3;
        let showLabels = true;

        // æ ‡ç­¾åˆ‡æ¢åŠŸèƒ½
        function showTab(tabName, buttonElement) {
            // éšè—æ‰€æœ‰æ ‡ç­¾å†…å®¹
            document.querySelectorAll('.tab-content').forEach(tab => {
                tab.classList.remove('active');
            });
            
            // ç§»é™¤æ‰€æœ‰æŒ‰é’®çš„activeç±»
            document.querySelectorAll('.tab-button').forEach(btn => {
                btn.classList.remove('active');
            });
            
            // æ˜¾ç¤ºé€‰ä¸­çš„æ ‡ç­¾å†…å®¹
            document.getElementById(tabName).classList.add('active');
            
            // æ·»åŠ activeç±»åˆ°å¯¹åº”æŒ‰é’®
            if (buttonElement) {
                buttonElement.classList.add('active');
            }
            
            // å»¶è¿Ÿåˆå§‹åŒ–å›¾è¡¨ï¼Œç¡®ä¿å®¹å™¨å¯è§
            setTimeout(() => {
                switch(tabName) {
                    case 'book': 
                        initBookChart(); 
                        break;
                    case 'exchange': 
                        initExchangeChart(); 
                        break;
                    case 'sales': 
                        initSalesChart(); 
                        break;
                    case 'temperature': 
                        initTemperatureChart(); 
                        break;
                    case 'snowflake': 
                        initSnowflakeChart(); 
                        break;
                }
            }, 100);
        }

        // ç”Ÿæˆéšæœºæ•°æ®
        function generateRandomData(count, min, max) {
            return Array.from({length: count}, () => 
                Math.floor(Math.random() * (max - min + 1)) + min
            );
        }

        // å®ä¾‹1ï¼šå›¾ä¹¦é‡‡è´­
        function initBookChart() {
            const ctx = document.getElementById('bookChart');
            if (!ctx) return;
            
            if (charts.book) {
                charts.book.destroy();
            }

            const data = {
                labels: ['å®¶åº­', 'å°è¯´', 'å¿ƒç†', 'ç§‘æŠ€', 'å„¿ç«¥'],
                datasets: [{
                    label: 'åœ°åŒº1',
                    data: generateRandomData(5, 1000, 2500),
                    backgroundColor: '#FFCC00',
                    borderColor: '#FFCC00',
                    borderWidth: 1
                }, {
                    label: 'åœ°åŒº2',
                    data: generateRandomData(5, 800, 2200),
                    backgroundColor: '#B0C4DE',
                    borderColor: '#B0C4DE',
                    borderWidth: 1
                }]
            };

            charts.book = new Chart(ctx, {
                type: 'bar',
                data: data,
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        title: {
                            display: false
                        },
                        legend: {
                            display: true,
                            position: 'top'
                        },
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                    return context.dataset.label + ': ' + context.parsed.y + ' æœ¬';
                                }
                            }
                        }
                    },
                    scales: {
                        x: {
                            stacked: true,
                            title: {
                                display: true,
                                text: 'å›¾ä¹¦ç§ç±»'
                            },
                            grid: {
                                display: false
                            }
                        },
                        y: {
                            stacked: true,
                            beginAtZero: true,
                            title: {
                                display: true,
                                text: 'é‡‡è´­æ•°é‡(æœ¬)'
                            },
                            grid: {
                                display: true,
                                color: 'rgba(0,0,0,0.1)'
                            }
                        }
                    }
                }
            });
        }

        function generateBookData() {
            if (charts.book) {
                charts.book.data.datasets[0].data = generateRandomData(5, 1000, 2500);
                charts.book.data.datasets[1].data = generateRandomData(5, 800, 2200);
                charts.book.update();
            }
        }

        function toggleBookType() {
            if (charts.book) {
                const currentType = charts.book.config.type;
                charts.book.config.type = currentType === 'bar' ? 'line' : 'bar';
                charts.book.update();
            }
        }

        // å®ä¾‹2ï¼šæ±‡ç‡èµ°åŠ¿
        function initExchangeChart() {
            const ctx = document.getElementById('exchangeChart');
            if (!ctx) return;
            
            if (charts.exchange) {
                charts.exchange.destroy();
            }

            const date_x = [3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 17, 18, 19, 24, 25, 26, 31];
            const eurcny_2017 = generateRandomData(19, 6.7, 6.9);
            const eurcny_2019 = generateRandomData(19, 6.8, 7.0);

            const data = {
                labels: date_x,
                datasets: [{
                    label: '2017å¹´7æœˆç¾å…ƒ/äººæ°‘å¸æ±‡ç‡',
                    data: eurcny_2017,
                    borderColor: '#006374',
                    backgroundColor: 'rgba(0, 99, 116, 0.1)',
                    borderWidth: 2,
                    tension: 0.1,
                    pointRadius: 4,
                    pointHoverRadius: 6
                }, {
                    label: '2019å¹´7æœˆç¾å…ƒ/äººæ°‘å¸æ±‡ç‡',
                    data: eurcny_2019,
                    borderColor: '#8a2e76',
                    backgroundColor: 'rgba(138, 46, 118, 0.1)',
                    borderWidth: 2,
                    borderDash: [5, 5],
                    tension: 0.1,
                    pointRadius: 4,
                    pointHoverRadius: 6
                }]
            };

            charts.exchange = new Chart(ctx, {
                type: 'line',
                data: data,
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        title: {
                            display: false
                        },
                        legend: {
                            display: true,
                            position: 'top'
                        },
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                    return context.dataset.label + ': ' + context.parsed.y.toFixed(4);
                                }
                            }
                        }
                    },
                    scales: {
                        x: {
                            title: {
                                display: true,
                                text: 'æ—¥æœŸ'
                            },
                            grid: {
                                display: false
                            }
                        },
                        y: {
                            title: {
                                display: true,
                                text: 'æ±‡ç‡'
                            },
                            grid: {
                                display: true,
                                color: 'rgba(0,0,0,0.1)'
                            }
                        }
                    }
                }
            });
        }

        function generateExchangeData() {
            if (charts.exchange) {
                charts.exchange.data.datasets[0].data = generateRandomData(19, 6.7, 6.9);
                charts.exchange.data.datasets[1].data = generateRandomData(19, 6.8, 7.0);
                charts.exchange.update();
            }
        }

        function toggleLineStyle() {
            if (charts.exchange) {
                const dataset1 = charts.exchange.data.datasets[1];
                dataset1.borderDash = dataset1.borderDash.length ? [] : [5, 5];
                charts.exchange.update();
            }
        }

        // å®ä¾‹3ï¼šäº§å“é”€å”®é¢
        function initSalesChart() {
            const ctx = document.getElementById('salesChart');
            if (!ctx) return;
            
            if (charts.sales) {
                charts.sales.destroy();
            }

            const sale_a = generateRandomData(4, 2000, 8000);
            const sale_b = generateRandomData(4, 800, 4500);
            const sale_c = generateRandomData(4, 100, 700);

            const data = {
                labels: ['ç¬¬1å­£åº¦', 'ç¬¬2å­£åº¦', 'ç¬¬3å­£åº¦', 'ç¬¬4å­£åº¦'],
                datasets: [{
                    label: 'äº§å“A',
                    data: sale_a,
                    borderColor: '#FF6B6B',
                    backgroundColor: 'rgba(255, 107, 107, 0.1)',
                    borderWidth: 3,
                    pointStyle: 'triangle',
                    pointRadius: 8,
                    pointHoverRadius: 10,
                    tension: 0.1
                }, {
                    label: 'äº§å“B',
                    data: sale_b,
                    borderColor: '#4ECDC4',
                    backgroundColor: 'rgba(78, 205, 196, 0.1)',
                    borderWidth: 3,
                    pointStyle: 'rect',
                    pointRadius: 8,
                    pointHoverRadius: 10,
                    tension: 0.1
                }, {
                    label: 'äº§å“C',
                    data: sale_c,
                    borderColor: '#45B7D1',
                    backgroundColor: 'rgba(69, 183, 209, 0.1)',
                    borderWidth: 3,
                    pointStyle: 'rectRot',
                    pointRadius: 8,
                    pointHoverRadius: 10,
                    tension: 0.1,
                    borderDash: [5, 5]
                }]
            };

            charts.sales = new Chart(ctx, {
                type: 'line',
                data: data,
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        title: {
                            display: false
                        },
                        legend: {
                            display: true,
                            position: 'top'
                        },
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                    return context.dataset.label + ': ' + context.parsed.y + ' ä¸‡å…ƒ';
                                }
                            }
                        }
                    },
                    scales: {
                        x: {
                            title: {
                                display: true,
                                text: 'å­£åº¦'
                            },
                            grid: {
                                display: false
                            }
                        },
                        y: {
                            beginAtZero: true,
                            title: {
                                display: true,
                                text: 'é”€å”®é¢(ä¸‡å…ƒ)'
                            },
                            grid: {
                                display: true,
                                color: 'rgba(0,0,0,0.1)'
                            }
                        }
                    }
                }
            });
        }

        function generateSalesData() {
            if (charts.sales) {
                charts.sales.data.datasets[0].data = generateRandomData(4, 2000, 8000);
                charts.sales.data.datasets[1].data = generateRandomData(4, 800, 4500);
                charts.sales.data.datasets[2].data = generateRandomData(4, 100, 700);
                charts.sales.update();
            }
        }

        function toggleMarkerStyle() {
            if (charts.sales) {
                const styles = ['circle', 'triangle', 'rect', 'rectRot', 'star', 'triangle'];
                charts.sales.data.datasets.forEach((dataset, index) => {
                    const currentStyle = dataset.pointStyle;
                    const currentIndex = styles.indexOf(currentStyle);
                    dataset.pointStyle = styles[(currentIndex + 1) % styles.length];
                });
                charts.sales.update();
            }
        }

        // å®ä¾‹4ï¼šæ°”æ¸©èµ°åŠ¿
        function initTemperatureChart() {
            const ctx = document.getElementById('temperatureChart');
            if (!ctx) return;
            
            if (charts.temperature) {
                charts.temperature.destroy();
            }

            const x = Array.from({length: 15}, (_, i) => i + 4);
            const y_max = generateRandomData(15, 20, 35);
            const y_min = generateRandomData(15, 10, 25);

            const data = {
                labels: x,
                datasets: [{
                    label: 'æœ€é«˜æ¸©åº¦',
                    data: y_max,
                    borderColor: '#FF6B6B',
                    backgroundColor: 'rgba(255, 107, 107, 0.1)',
                    borderWidth: 3,
                    pointRadius: 6,
                    pointHoverRadius: 8,
                    tension: 0.2
                }, {
                    label: 'æœ€ä½æ¸©åº¦',
                    data: y_min,
                    borderColor: '#4ECDC4',
                    backgroundColor: 'rgba(78, 205, 196, 0.1)',
                    borderWidth: 3,
                    pointRadius: 6,
                    pointHoverRadius: 8,
                    tension: 0.2
                }]
            };

            charts.temperature = new Chart(ctx, {
                type: 'line',
                data: data,
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        title: {
                            display: false
                        },
                        legend: {
                            display: true,
                            position: 'top'
                        },
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                    return context.dataset.label + ': ' + context.parsed.y + 'Â°C';
                                }
                            }
                        },
                        datalabels: {
                            display: showLabels,
                            align: 'top',
                            anchor: 'end',
                            offset: 8,
                            color: '#666',
                            font: {
                                size: 10
                            },
                            formatter: function(value, context) {
                                return value + 'Â°C';
                            }
                        }
                    },
                    scales: {
                        x: {
                            title: {
                                display: true,
                                text: 'æ—¥æœŸ'
                            },
                            grid: {
                                display: false
                            }
                        },
                        y: {
                            beginAtZero: false,
                            min: 0,
                            max: 40,
                            title: {
                                display: true,
                                text: 'æ¸©åº¦(Â°C)'
                            },
                            grid: {
                                display: true,
                                color: 'rgba(0,0,0,0.1)'
                            }
                        }
                    }
                }
            });
        }

        function generateTemperatureData() {
            if (charts.temperature) {
                charts.temperature.data.datasets[0].data = generateRandomData(15, 20, 35);
                charts.temperature.data.datasets[1].data = generateRandomData(15, 10, 25);
                charts.temperature.update();
            }
        }

        function toggleTemperatureLabels() {
            showLabels = !showLabels;
            if (charts.temperature) {
                charts.temperature.options.plugins.datalabels.display = showLabels;
                charts.temperature.update();
            }
        }

        // å®ä¾‹5ï¼šKoché›ªèŠ±åˆ†å½¢
        function initSnowflakeChart() {
            // ä½¿ç”¨Canvasç›´æ¥ç»˜åˆ¶Koché›ªèŠ±
            drawKochSnowflake();
        }

        function drawKochSnowflake() {
            const canvas = document.getElementById('kochSnowflake');
            if (!canvas) {
                console.log('Canvas not found');
                return;
            }
            
            const ctx = canvas.getContext('2d');
            
            // è®¾ç½®Canvaså°ºå¯¸
            canvas.width = 600;
            canvas.height = 400;
            
            // æ¸…ç©ºç”»å¸ƒ
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            
            // è·å–ç”¨æˆ·è®¾ç½®
            const iterations = parseInt(document.getElementById('snowflakeIterations').value);
            const snowflakeColor = document.getElementById('snowflakeColor').value;
            
            console.log('Drawing snowflake:', iterations, snowflakeColor);
            
            // è®¾ç½®æ ·å¼
            ctx.strokeStyle = snowflakeColor;
            ctx.lineWidth = 2;
            ctx.fillStyle = snowflakeColor + '30'; // æ·»åŠ é€æ˜åº¦å¡«å……
            
            // é›ªèŠ±å‚æ•°
            const size = 150;
            const centerX = 300;
            const centerY = 200;
            
            // å…ˆç»˜åˆ¶ä¸€ä¸ªç®€å•çš„ä¸‰è§’å½¢ä½œä¸ºæµ‹è¯•
            const angle1 = -Math.PI / 2; // é¡¶ç‚¹æœä¸Š
            const angle2 = angle1 + (2 * Math.PI / 3);
            const angle3 = angle2 + (2 * Math.PI / 3);
            
            const p1 = {
                x: centerX + size * Math.cos(angle1),
                y: centerY + size * Math.sin(angle1)
            };
            const p2 = {
                x: centerX + size * Math.cos(angle2),
                y: centerY + size * Math.sin(angle2)
            };
            const p3 = {
                x: centerX + size * Math.cos(angle3),
                y: centerY + size * Math.sin(angle3)
            };
            
            // Kochæ›²çº¿ç”Ÿæˆå‡½æ•° - ä¿®å¤ç‰ˆæœ¬
            function getKochLine(x1, y1, x2, y2, level) {
                if (level === 0) {
                    return [{x: x1, y: y1}, {x: x2, y: y2}];
                }
                
                const dx = x2 - x1;
                const dy = y2 - y1;
                
                // è®¡ç®—ä¸‰ç­‰åˆ†ç‚¹
                const x3 = x1 + dx/3;
                const y3 = y1 + dy/3;
                const x5 = x1 + 2*dx/3;
                const y5 = y1 + 2*dy/3;
                
                // è®¡ç®—ç­‰è¾¹ä¸‰è§’å½¢çš„é¡¶ç‚¹
                const angle = Math.atan2(dy, dx) - Math.PI/3;
                const length = Math.sqrt(dx*dx + dy*dy) / 3;
                
                const x4 = x3 + length * Math.cos(angle);
                const y4 = y3 + length * Math.sin(angle);
                
                // é€’å½’ç”Ÿæˆå››æ®µ
                const segment1 = getKochLine(x1, y1, x3, y3, level - 1);
                const segment2 = getKochLine(x3, y3, x4, y4, level - 1);
                const segment3 = getKochLine(x4, y4, x5, y5, level - 1);
                const segment4 = getKochLine(x5, y5, x2, y2, level - 1);
                
                // åˆå¹¶æ‰€æœ‰ç‚¹ï¼Œå»æ‰é‡å¤çš„ç‚¹
                return [
                    ...segment1.slice(0, -1),
                    ...segment2.slice(0, -1),
                    ...segment3.slice(0, -1),
                    ...segment4
                ];
            }
            
            // ç”Ÿæˆä¸‰æ¡Kochæ›²çº¿ç»„æˆé›ªèŠ±
            const side1 = getKochLine(p1.x, p1.y, p2.x, p2.y, iterations);
            const side2 = getKochLine(p2.x, p2.y, p3.x, p3.y, iterations);
            const side3 = getKochLine(p3.x, p3.y, p1.x, p1.y, iterations);
            
            console.log('Points generated:', side1.length, side2.length, side3.length);
            
            // ç»˜åˆ¶é›ªèŠ±
            ctx.beginPath();
            
            // ç»˜åˆ¶ç¬¬ä¸€æ¡è¾¹
            ctx.moveTo(side1[0].x, side1[0].y);
            for (let i = 1; i < side1.length; i++) {
                ctx.lineTo(side1[i].x, side1[i].y);
            }
            
            // ç»˜åˆ¶ç¬¬äºŒæ¡è¾¹
            for (let i = 1; i < side2.length; i++) {
                ctx.lineTo(side2[i].x, side2[i].y);
            }
            
            // ç»˜åˆ¶ç¬¬ä¸‰æ¡è¾¹
            for (let i = 1; i < side3.length; i++) {
                ctx.lineTo(side3[i].x, side3[i].y);
            }
            
            ctx.closePath();
            ctx.fill();
            ctx.stroke();
            
            // æ˜¾ç¤ºè¿­ä»£ä¿¡æ¯
            ctx.fillStyle = '#666';
            ctx.font = '14px Arial';
            ctx.fillText(`Koché›ªèŠ±åˆ†å½¢ - è¿­ä»£æ¬¡æ•°: ${iterations}`, 10, 25);
            ctx.fillText(`è¾¹æ•°: ${3 * Math.pow(4, iterations)}`, 10, 45);
            
            console.log('Snowflake drawing completed');
        }

        function generateSnowflake() {
            drawKochSnowflake();
        }

        function changeSnowflakeColor() {
            drawKochSnowflake();
        }

        function adjustSnowflakeComplexity() {
            drawKochSnowflake();
        }

        function animateSnowflake() {
            let iteration = 0;
            const maxIteration = 4;
            
            const animate = () => {
                document.getElementById('snowflakeIterations').value = iteration;
                drawKochSnowflake();
                
                iteration++;
                if (iteration <= maxIteration) {
                    setTimeout(animate, 800);
                }
            };
            
            animate();
        }

        // åˆå§‹åŒ–å›¾è¡¨
        function initializeCharts() {
            // å»¶è¿Ÿåˆå§‹åŒ–ï¼Œç¡®ä¿DOMå…ƒç´ å·²åŠ è½½
            if (document.getElementById('bookChart')) {
                initBookChart();
            }
            if (document.getElementById('kochSnowflake')) {
                initSnowflakeChart();
            }
        }

        // é¡µé¢åŠ è½½å®Œæˆååˆå§‹åŒ– - åŠ å›ºç‰ˆæœ¬
        document.addEventListener('DOMContentLoaded', function() {
            waitForChartJSAndInit();
        });

        function waitForChartJSAndInit() {
            let retries = 0;
            const maxRetries = 10;
            const retryInterval = 500;

            function checkChartJS() {
                retries++;
                
                if (typeof Chart === 'undefined') {
                    console.warn('Chart.js å°šæœªåŠ è½½ï¼Œé‡è¯•ä¸­...', retries);
                    if (retries < maxRetries) {
                        setTimeout(checkChartJS, retryInterval);
                        return;
                    } else {
                        console.error('Chart.js åŠ è½½å¤±è´¥');
                        showErrorMessage('Chart.js å›¾è¡¨åº“åŠ è½½å¤±è´¥ï¼Œè¯·åˆ·æ–°é¡µé¢é‡è¯•');
                        return;
                    }
                }
                
                // Chart.jså·²åŠ è½½ï¼Œå¼€å§‹åˆå§‹åŒ–
                console.log('Chart.js åŠ è½½å®Œæˆï¼Œå¼€å§‹åˆå§‹åŒ–...');
                try {
                    setTimeout(() => {
                        initializeCharts();
                        // é»˜è®¤æ˜¾ç¤ºç¬¬ä¸€ä¸ªæ ‡ç­¾
                        const firstButton = document.querySelector('.tab-button');
                        if (firstButton) {
                            firstButton.classList.add('active');
                            const tabName = firstButton.getAttribute('onclick').match(/'([^']+)'/)[1];
                            showTab(tabName, firstButton);
                        }
                        console.log('ç¬¬4ç« å›¾è¡¨åˆå§‹åŒ–æˆåŠŸ');
                    }, 200);
                } catch (error) {
                    console.error('ç¬¬4ç« å›¾è¡¨åˆå§‹åŒ–å¤±è´¥:', error);
                    showErrorMessage('å›¾è¡¨åˆå§‹åŒ–å¤±è´¥: ' + error.message);
                }
            }
            
            checkChartJS();
        }

        function showErrorMessage(message) {
            const errorDiv = document.createElement('div');
            errorDiv.style.cssText = `
                position: fixed;
                top: 20px;
                right: 20px;
                background: #e74c3c;
                color: white;
                padding: 15px 20px;
                border-radius: 8px;
                box-shadow: 0 4px 12px rgba(0,0,0,0.3);
                z-index: 10000;
                max-width: 300px;
                font-size: 14px;
            `;
            errorDiv.innerHTML = `<strong>åŠ è½½é”™è¯¯:</strong> ${message}<br><small>è¯·æ£€æŸ¥ç½‘ç»œè¿æ¥å¹¶åˆ·æ–°é¡µé¢</small>`;
            document.body.appendChild(errorDiv);
            
            setTimeout(() => {
                if (errorDiv.parentNode) {
                    errorDiv.parentNode.removeChild(errorDiv);
                }
            }, 5000);
        }
    </script>
</body>
</html>