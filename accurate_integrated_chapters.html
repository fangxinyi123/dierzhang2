<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ•°æ®å¯è§†åŒ–ç»¼åˆå¹³å° - ç¬¬2-8ç« å®Œæ•´ç‰ˆ</title>
    
    <!-- åŠ è½½æ‰€éœ€çš„å›¾è¡¨åº“ -->
    <script src="https://cdn.plot.ly/plotly-2.27.0.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://d3js.org/d3.v7.min.js"></script>
    
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Microsoft YaHei', Arial, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1600px;
            margin: 0 auto;
            background: rgba(255, 255, 255, 0.98);
            border-radius: 20px;
            padding: 30px;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.15);
            margin-bottom: 30px;
            overflow: hidden;
        }

        .header {
            text-align: center;
            margin-bottom: 40px;
            background: linear-gradient(135deg, #764ba2 0%, #667eea 100%);
            color: white;
            padding: 40px;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
        }

        .main-title h1 {
            font-size: 3rem;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.3);
        }

        .main-title p {
            font-size: 1.2rem;
            opacity: 0.9;
        }

        .chapter-tabs {
            display: flex;
            justify-content: center;
            background: rgba(255, 255, 255, 0.95);
            padding: 15px;
            flex-wrap: wrap;
            gap: 10px;
            border-radius: 10px;
            margin-bottom: 30px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
        }

        .chapter-tab {
            padding: 12px 24px;
            background: linear-gradient(135deg, #e9ecef 0%, #f8f9fa 100%);
            border: none;
            color: #495057;
            cursor: pointer;
            border-radius: 25px;
            font-size: 1em;
            font-weight: bold;
            transition: all 0.3s ease;
        }

        .chapter-tab:hover {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
        }

        .chapter-tab.active {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            transform: scale(1.05);
        }

        .chapter-content {
            display: none;
            animation: fadeIn 0.6s ease;
        }

        .chapter-content.active {
            display: block;
        }

        .chapter-title {
            color: #2c3e50;
            font-size: 2.5rem;
            margin-bottom: 20px;
            text-align: center;
            font-weight: bold;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .charts-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(500px, 1fr));
            gap: 25px;
            margin-bottom: 30px;
        }

        .chart-container {
            background: white;
            border-radius: 15px;
            padding: 20px;
            box-shadow: 0 5px 20px rgba(0, 0, 0, 0.1);
            transition: all 0.3s ease;
            border: 1px solid #e0e0e0;
            min-height: 450px;
            display: flex;
            flex-direction: column;
        }

        .chart-container:hover {
            transform: translateY(-5px);
            box-shadow: 0 15px 40px rgba(0, 0, 0, 0.15);
        }

        .chart-title {
            color: #2c3e50;
            font-size: 1.3em;
            margin-bottom: 15px;
            text-align: center;
            font-weight: bold;
        }

        .plot-area {
            width: 100%;
            height: 400px;
            border: 1px solid #e0e0e0;
            border-radius: 10px;
            background: #fafafa;
            flex: 1;
        }

        .controls {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 15px;
            padding: 20px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
            text-align: center;
            margin-bottom: 30px;
        }

        .btn {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 12px 25px;
            border-radius: 25px;
            font-size: 1em;
            cursor: pointer;
            margin: 5px;
            transition: all 0.3s ease;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
        }

        /* ç¬¬äºŒç« ä¸“ç”¨æ ·å¼ */
        .ch2-nav {
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 20px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }

        .ch2-nav-btn {
            padding: 10px 20px;
            background: #667eea;
            color: white;
            border: none;
            border-radius: 20px;
            cursor: pointer;
            font-size: 1em;
            transition: all 0.3s ease;
        }

        .ch2-nav-btn:hover {
            background: #5a6fd8;
            transform: translateY(-2px);
        }

        .ch2-nav-btn:disabled {
            background: #ccc;
            cursor: not-allowed;
            transform: none;
        }

        .ch2-indicator {
            background: #e9ecef;
            padding: 8px 16px;
            border-radius: 15px;
            font-weight: bold;
            color: #495057;
        }

        /* ç¬¬ä¸‰ç« ä¸“ç”¨æ ·å¼ */
        .ch3-tabs {
            display: flex;
            justify-content: center;
            margin-bottom: 30px;
            flex-wrap: wrap;
            gap: 10px;
        }

        .ch3-tab {
            padding: 12px 24px;
            background: #f8f9fa;
            border: 2px solid #dee2e6;
            color: #495057;
            cursor: pointer;
            border-radius: 25px;
            transition: all 0.3s ease;
            font-size: 1em;
        }

        .ch3-tab:hover {
            background: #e9ecef;
            border-color: #667eea;
        }

        .ch3-tab.active {
            background: #667eea;
            color: white;
            border-color: #667eea;
        }

        /* ç¬¬å››ç« ä¸“ç”¨æ ·å¼ */
        .ch4-tabs {
            display: flex;
            justify-content: center;
            margin-bottom: 30px;
            flex-wrap: wrap;
            gap: 10px;
        }

        .ch4-tab {
            padding: 12px 24px;
            background: rgba(255, 255, 255, 0.2);
            border: 2px solid rgba(255, 255, 255, 0.3);
            color: white;
            cursor: pointer;
            border-radius: 30px;
            transition: all 0.3s ease;
            font-size: 1rem;
            font-weight: 600;
        }

        .ch4-tab:hover {
            background: rgba(255, 255, 255, 0.3);
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
        }

        .ch4-tab.active {
            background: white;
            color: #667eea;
            transform: scale(1.05);
        }

        /* ç¬¬äº”ç« ä¸“ç”¨æ ·å¼ */
        .ch5-tabs {
            display: flex;
            justify-content: center;
            gap: 15px;
            margin-bottom: 30px;
            flex-wrap: wrap;
        }

        .ch5-tab {
            padding: 10px 20px;
            background: #6c757d;
            color: white;
            border: none;
            border-radius: 20px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .ch5-tab:hover {
            background: #5a6268;
            transform: translateY(-2px);
        }

        .ch5-tab.active {
            background: #007bff;
        }

        /* ç¬¬å…­ç« ä¸“ç”¨æ ·å¼ */
        .ch6-tabs {
            display: flex;
            justify-content: center;
            background: #ecf0f1;
            padding: 15px;
            border-bottom: 1px solid #bdc3c7;
            flex-wrap: wrap;
            gap: 10px;
        }

        .ch6-tab {
            padding: 10px 20px;
            background: #3498db;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 1.1em;
        }

        .ch6-tab:hover {
            background: #2980b9;
            transform: translateY(-2px);
        }

        .ch6-tab.active {
            background: #2c3e50;
        }

        /* ç¬¬å…«ç« ä¸“ç”¨æ ·å¼ */
        .ch8-nav {
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 20px;
            margin-bottom: 15px;
            flex-wrap: wrap;
        }

        .ch8-nav-btn {
            background: rgba(255, 255, 255, 0.2);
            border: 2px solid rgba(255, 255, 255, 0.5);
            color: white;
            padding: 12px 24px;
            border-radius: 25px;
            cursor: pointer;
            font-size: 1rem;
            transition: all 0.3s ease;
        }

        .ch8-nav-btn:hover {
            background: rgba(255, 255, 255, 0.3);
            transform: translateY(-2px);
        }

        .ch8-nav-btn:disabled {
            background: rgba(100, 100, 100, 0.5);
            cursor: not-allowed;
            transform: none;
        }

        .ch8-counter {
            background: rgba(255, 255, 255, 0.3);
            padding: 10px 20px;
            border-radius: 20px;
            font-weight: bold;
            min-width: 100px;
            text-align: center;
        }

        .ch8-dots {
            display: flex;
            justify-content: center;
            gap: 8px;
        }

        .ch8-dot {
            width: 12px;
            height: 12px;
            border-radius: 50%;
            background: rgba(255, 255, 255, 0.4);
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .ch8-dot.active {
            background: white;
            transform: scale(1.2);
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* å“åº”å¼è®¾è®¡ */
        @media (max-width: 768px) {
            .charts-grid {
                grid-template-columns: 1fr;
            }
            
            .main-title h1 {
                font-size: 2rem;
            }
            
            .chapter-tabs, .ch3-tabs, .ch4-tabs, .ch5-tabs, .ch6-tabs {
                flex-direction: column;
                align-items: center;
            }
            
            .chapter-tab, .ch3-tab, .ch4-tab, .ch5-tab, .ch6-tab {
                width: 95%;
                text-align: center;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <div class="main-title">
                <h1>æ•°æ®å¯è§†åŒ–ç»¼åˆå¹³å°</h1>
                <p>ç¬¬2-8ç« å®Œæ•´æ•™ç¨‹ - ä»åŸºç¡€åˆ°é«˜çº§çš„æ•°æ®å¯è§†åŒ–æŠ€æœ¯</p>
            </div>
        </div>

        <!-- ç« èŠ‚å¯¼èˆªæ ‡ç­¾ -->
        <nav class="chapter-tabs">
            <button class="chapter-tab active" onclick="switchChapter('chapter2', this)">ç¬¬äºŒç« </button>
            <button class="chapter-tab" onclick="switchChapter('chapter3', this)">ç¬¬ä¸‰ç« </button>
            <button class="chapter-tab" onclick="switchChapter('chapter4', this)">ç¬¬å››ç« </button>
            <button class="chapter-tab" onclick="switchChapter('chapter5', this)">ç¬¬äº”ç« </button>
            <button class="chapter-tab" onclick="switchChapter('chapter6', this)">ç¬¬å…­ç« </button>
            <button class="chapter-tab" onclick="switchChapter('chapter7', this)">ç¬¬ä¸ƒç« </button>
            <button class="chapter-tab" onclick="switchChapter('chapter8', this)">ç¬¬å…«ç« </button>
        </nav>

        <!-- ç¬¬äºŒç« ï¼šåŸºç¡€å›¾è¡¨ -->
        <section id="chapter2" class="chapter-content active">
            <h2 class="chapter-title">ç¬¬äºŒç«  - åŸºç¡€å›¾è¡¨</h2>
            
            <div class="ch2-nav">
                <button class="ch2-nav-btn" id="ch2-prev" onclick="prevChart_ch2()">â† ä¸Šä¸€å¼ </button>
                <div class="ch2-indicator" id="ch2-indicator">1 / 10</div>
                <button class="ch2-nav-btn" id="ch2-next" onclick="nextChart_ch2()">ä¸‹ä¸€å¼  â†’</button>
            </div>

            <div class="charts-grid">
                <div class="chart-container" id="ch2-chart-container">
                    <div class="chart-title" id="ch2-chart-title">æŠ˜çº¿å›¾ - æœˆåº¦é”€å”®è¶‹åŠ¿</div>
                    <div id="ch2-chart" class="plot-area"></div>
                </div>
            </div>
        </section>

        <!-- ç¬¬ä¸‰ç« ï¼šç»¼åˆå›¾è¡¨ -->
        <section id="chapter3" class="chapter-content">
            <h2 class="chapter-title">ç¬¬ä¸‰ç«  - ç»¼åˆå›¾è¡¨</h2>
            
            <div class="ch3-tabs">
                <button class="ch3-tab active" onclick="showBasicCharts_ch3(this)">åŸºç¡€å›¾è¡¨å±•ç¤º</button>
                <button class="ch3-tab" onclick="showInteractive_ch3(this)">äº¤äº’å¼å¯è§†åŒ–</button>
            </div>

            <!-- åŸºç¡€å›¾è¡¨å±•ç¤ºéƒ¨åˆ† -->
            <div id="ch3-basic" class="ch3-content">
                <div class="ch2-nav">
                    <button class="ch2-nav-btn" id="ch3-prev" onclick="prevBasicChart_ch3()">â† ä¸Šä¸€å¼ </button>
                    <div class="ch2-indicator" id="ch3-indicator">1 / 5</div>
                    <button class="ch2-nav-btn" id="ch3-next" onclick="nextBasicChart_ch3()">ä¸‹ä¸€å¼  â†’</button>
                </div>

                <div class="charts-grid">
                    <div class="chart-container">
                        <div class="chart-title" id="ch3-basic-title">æ­£å¼¦å’Œä½™å¼¦å‡½æ•°å›¾</div>
                        <div id="ch3-basic-chart" class="plot-area"></div>
                    </div>
                </div>
            </div>

            <!-- äº¤äº’å¼å¯è§†åŒ–éƒ¨åˆ† -->
            <div id="ch3-interactive" class="ch3-content" style="display:none;">
                <div class="charts-grid">
                    <div class="chart-container">
                        <div class="chart-title">åŠ¨æ€æŠ˜çº¿å›¾</div>
                        <div id="ch3-interactive1" class="plot-area"></div>
                    </div>
                    <div class="chart-container">
                        <div class="chart-title">æ•£ç‚¹å›¾</div>
                        <div id="ch3-interactive2" class="plot-area"></div>
                    </div>
                    <div class="chart-container">
                        <div class="chart-title">æŸ±çŠ¶å›¾</div>
                        <div id="ch3-interactive3" class="plot-area"></div>
                    </div>
                    <div class="chart-container">
                        <div class="chart-title">å¤šå›¾è¡¨è”åŠ¨</div>
                        <div id="ch3-interactive4" class="plot-area"></div>
                    </div>
                </div>

                <div class="controls">
                    <label>æ•°æ®ç‚¹æ•°é‡: <input type="range" id="ch3-points" min="10" max="100" value="50" oninput="updateInteractive_ch3()"></label>
                    <label>å›¾è¡¨ç±»å‹: <select id="ch3-type" onchange="updateInteractive_ch3()"><option value="line">æŠ˜çº¿</option><option value="scatter">æ•£ç‚¹</option><option value="bar">æŸ±çŠ¶</option></select></label>
                    <label>åŠ¨ç”»é€Ÿåº¦: <input type="range" id="ch3-speed" min="100" max="2000" value="1000" oninput="updateInteractive_ch3()"></label>
                </div>
            </div>
        </section>

        <!-- ç¬¬å››ç« ï¼šPythoné£æ ¼å›¾è¡¨ -->
        <section id="chapter4" class="chapter-content">
            <h2 class="chapter-title">ç¬¬å››ç«  - Pythonæ•°æ®å¯è§†åŒ–åŸºç¡€</h2>
            
            <div class="ch4-tabs">
                <button class="ch4-tab-button active" onclick="showTab_ch4('book', this)">å®ä¾‹1ï¼šå›¾ä¹¦é‡‡è´­</button>
                <button class="ch4-tab-button" onclick="showTab_ch4('exchange', this)">å®ä¾‹2ï¼šæ±‡ç‡èµ°åŠ¿</button>
                <button class="ch4-tab-button" onclick="showTab_ch4('sales', this)">å®ä¾‹3ï¼šäº§å“é”€å”®é¢</button>
                <button class="ch4-tab-button" onclick="showTab_ch4('temperature', this)">å®ä¾‹4ï¼šæ°”æ¸©èµ°åŠ¿</button>
                <button class="ch4-tab-button" onclick="showTab_ch4('snowflake', this)">å®ä¾‹5ï¼šå½©è‰²é›ªèŠ±</button>
            </div>

            <div class="ch4-content-area">
                <!-- å®ä¾‹1ï¼šå›¾ä¹¦é‡‡è´­ -->
                <div id="ch4-book" class="ch4-tab-content active">
                    <div class="chart-container">
                        <div class="chart-title">ğŸ“š ä¸¤ä¸ªåœ°åŒºå¯¹ä¸åŒç§ç±»å›¾ä¹¦çš„é‡‡è´­æƒ…å†µ</div>
                        <div class="chart-wrapper">
                            <canvas id="bookChart"></canvas>
                        </div>
                        <div class="controls">
                            <button class="control-btn" onclick="generateBookData_ch4()">ğŸ”„ é‡æ–°ç”Ÿæˆæ•°æ®</button>
                            <button class="control-btn" onclick="toggleBookType_ch4()">ğŸ“Š åˆ‡æ¢å›¾è¡¨ç±»å‹</button>
                        </div>
                        <div class="stats-info">
                            <p>å †å æŸ±å½¢å›¾å±•ç¤ºä¸¤ä¸ªåœ°åŒºå¯¹ä¸åŒå›¾ä¹¦ç±»åˆ«çš„é‡‡è´­æ•°é‡å¯¹æ¯”ï¼Œå¸®åŠ©åˆ†æåœ°åŒºé—´é‡‡è´­åå¥½å·®å¼‚</p>
                        </div>
                    </div>
                </div>

                <!-- å®ä¾‹2ï¼šæ±‡ç‡èµ°åŠ¿ -->
                <div id="ch4-exchange" class="ch4-tab-content">
                    <div class="chart-container">
                        <div class="chart-title">ğŸ’° 2017å¹´7æœˆä¸2019å¹´7æœˆç¾å…ƒ/äººæ°‘å¸æ±‡ç‡èµ°åŠ¿</div>
                        <div class="chart-wrapper">
                            <canvas id="exchangeChart"></canvas>
                        </div>
                        <div class="controls">
                            <button class="control-btn" onclick="generateExchangeData_ch4()">ğŸ”„ åˆ·æ–°æ•°æ®</button>
                            <button class="control-btn" onclick="toggleLineStyle_ch4()">ğŸ“ˆ åˆ‡æ¢çº¿å‹</button>
                        </div>
                        <div class="stats-info">
                            <p>åŒæŠ˜çº¿å›¾å±•ç¤ºä¸åŒå¹´ä»½åŒæœˆæ±‡ç‡å˜åŒ–è¶‹åŠ¿ï¼Œåˆ†ææ±‡ç‡æ³¢åŠ¨è§„å¾‹å’Œå­£èŠ‚æ€§ç‰¹å¾</p>
                        </div>
                    </div>
                </div>

                <!-- å®ä¾‹3ï¼šäº§å“é”€å”®é¢ -->
                <div id="ch4-sales" class="ch4-tab-content">
                    <div class="chart-container">
                        <div class="chart-title">ğŸ“ˆ æ ‡è®°ä¸åŒäº§å“å„å­£åº¦çš„é”€å”®é¢</div>
                        <div class="chart-wrapper">
                            <canvas id="salesChart"></canvas>
                        </div>
                        <div class="controls">
                            <button class="control-btn" onclick="generateSalesData_ch4()">ğŸ”„ æ›´æ–°æ•°æ®</button>
                            <button class="control-btn" onclick="toggleMarkerStyle_ch4()">ğŸ¯ åˆ‡æ¢æ ‡è®°æ ·å¼</button>
                        </div>
                        <div class="stats-info">
                            <p>å¤šç³»åˆ—æŠ˜çº¿å›¾å±•ç¤ºä¸åŒäº§å“åœ¨å„å­£åº¦çš„é”€å”®è¡¨ç°ï¼ŒåŒ…å«æ•°æ®ç‚¹æ ‡è®°ä¾¿äºç²¾ç¡®è¯»å–</p>
                        </div>
                    </div>
                </div>

                <!-- å®ä¾‹4ï¼šæ°”æ¸©èµ°åŠ¿ -->
                <div id="ch4-temperature" class="ch4-tab-content">
                    <div class="chart-container">
                        <div class="chart-title">ğŸŒ¡ï¸ æœªæ¥15å¤©æœ€é«˜æ°”æ¸©å’Œæœ€ä½æ°”æ¸©çš„èµ°åŠ¿</div>
                        <div class="chart-wrapper">
                            <canvas id="temperatureChart"></canvas>
                        </div>
                        <div class="controls">
                            <button class="control-btn" onclick="generateTemperatureData_ch4()">ğŸ”„ é‡æ–°ç”Ÿæˆæ•°æ®</button>
                            <button class="control-btn" onclick="toggleTemperatureLabels_ch4()">ğŸ·ï¸ æ˜¾ç¤º/éšè—æ•°å€¼æ ‡ç­¾</button>
                        </div>
                        <div class="stats-info">
                            <p>åŒæŠ˜çº¿å›¾å±•ç¤ºæœªæ¥ä¸¤å‘¨æ¸©åº¦å˜åŒ–è¶‹åŠ¿ï¼ŒåŒ…å«æ•°å€¼æ ‡æ³¨ä¾¿äºç²¾ç¡®äº†è§£æ¯æ—¥æ¸©åº¦æƒ…å†µ</p>
                        </div>
                    </div>
                </div>

                <!-- å®ä¾‹5ï¼šå½©è‰²é›ªèŠ± -->
                <div id="ch4-snowflake" class="ch4-tab-content">
                    <div class="chart-container">
                        <div class="chart-title">â„ï¸ å½©è‰²çš„"é›ªèŠ±"åˆ†å½¢å›¾æ¡ˆ</div>
                        <div class="chart-wrapper">
                            <canvas id="kochSnowflake" width="600" height="400"></canvas>
                        </div>
                        <div class="controls">
                            <div style="display: flex; gap: 10px; align-items: center; flex-wrap: wrap;">
                                <label>è¿­ä»£æ¬¡æ•°:</label>
                                <select id="snowflakeIterations" onchange="drawKochSnowflake_ch4()">
                                    <option value="0">0</option>
                                    <option value="1">1</option>
                                    <option value="2">2</option>
                                    <option value="3" selected>3</option>
                                    <option value="4">4</option>
                                </select>
                                <label>é¢œè‰²:</label>
                                <select id="snowflakeColor" onchange="drawKochSnowflake_ch4()">
                                    <option value="#FF6B6B">çŠç‘šçº¢</option>
                                    <option value="#4ECDC4">é’ç»¿è‰²</option>
                                    <option value="#45B7D1">å¤©è“è‰²</option>
                                    <option value="#96CEB4">è–„è·ç»¿</option>
                                    <option value="#DDA0DD">æ¢…èŠ±ç´«</option>
                                    <option value="#FFB6C1">ç²‰çº¢è‰²</option>
                                </select>
                                <button class="control-btn" onclick="animateSnowflake_ch4()">ğŸ¬ åŠ¨ç”»æ¼”ç¤º</button>
                                <button class="control-btn" onclick="drawKochSnowflake_ch4()">ğŸ”„ é‡æ–°ç»˜åˆ¶</button>
                            </div>
                        </div>
                        <div class="stats-info">
                            <p>Koché›ªèŠ±åˆ†å½¢å›¾æ¡ˆå±•ç¤ºæ•°å­¦ä¹‹ç¾ï¼Œé€šè¿‡è¿­ä»£ç®—æ³•ç”Ÿæˆå…·æœ‰è‡ªç›¸ä¼¼æ€§çš„å‡ ä½•å›¾å½¢</p>
                        </div>
                    </div>
                </div>
            </div>
        </section>

            <!-- å®ä¾‹2ï¼šæ±‡ç‡èµ°åŠ¿ -->
            <div id="ch4-exchange" class="ch4-content" style="display:none;">
                <div class="charts-grid">
                    <div class="chart-container">
                        <div class="chart-title">ğŸ’° 2017å¹´7æœˆä¸2019å¹´7æœˆç¾å…ƒ/äººæ°‘å¸æ±‡ç‡èµ°åŠ¿</div>
                        <canvas id="ch4-exchange-chart"></canvas>
                        <div class="controls">
                            <button class="btn" onclick="generateExchangeData_ch4()">ğŸ”„ åˆ·æ–°æ•°æ®</button>
                            <button class="btn" onclick="toggleLineStyle_ch4()">ğŸ“ˆ åˆ‡æ¢çº¿å‹</button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- å®ä¾‹3ï¼šäº§å“é”€å”®é¢ -->
            <div id="ch4-sales" class="ch4-content" style="display:none;">
                <div class="charts-grid">
                    <div class="chart-container">
                        <div class="chart-title">ğŸ“ˆ æ ‡è®°ä¸åŒäº§å“å„å­£åº¦çš„é”€å”®é¢</div>
                        <canvas id="ch4-sales-chart"></canvas>
                        <div class="controls">
                            <button class="btn" onclick="generateSalesData_ch4()">ğŸ”„ æ›´æ–°æ•°æ®</button>
                            <button class="btn" onclick="toggleMarkerStyle_ch4()">ğŸ¯ åˆ‡æ¢æ ‡è®°æ ·å¼</button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- å®ä¾‹4ï¼šæ°”æ¸©èµ°åŠ¿ -->
            <div id="ch4-temperature" class="ch4-content" style="display:none;">
                <div class="charts-grid">
                    <div class="chart-container">
                        <div class="chart-title">ğŸŒ¡ï¸ æœªæ¥15å¤©æœ€é«˜æ°”æ¸©å’Œæœ€ä½æ°”æ¸©çš„èµ°åŠ¿</div>
                        <canvas id="ch4-temperature-chart"></canvas>
                        <div class="controls">
                            <button class="btn" onclick="generateTemperatureData_ch4()">ğŸ”„ é‡æ–°ç”Ÿæˆæ•°æ®</button>
                            <button class="btn" onclick="toggleTemperatureLabels_ch4()">ğŸ·ï¸ æ˜¾ç¤º/éšè—æ•°å€¼æ ‡ç­¾</button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- å®ä¾‹5ï¼šå½©è‰²é›ªèŠ± -->
            <div id="ch4-snowflake" class="ch4-content" style="display:none;">
                <div class="charts-grid">
                    <div class="chart-container">
                        <div class="chart-title">â„ï¸ å½©è‰²çš„"é›ªèŠ±"åˆ†å½¢å›¾æ¡ˆ</div>
                        <canvas id="ch4-koch-snowflake" width="600" height="400"></canvas>
                        <div class="controls">
                            <select id="ch4-snowflake-iterations" onchange="drawKochSnowflake_ch4()">
                                <option value="0">0</option><option value="1">1</option><option value="2">2</option>
                                <option value="3" selected>3</option><option value="4">4</option>
                            </select>
                            <select id="ch4-snowflake-color" onchange="drawKochSnowflake_ch4()">
                                <option value="#FF6B6B">çŠç‘šçº¢</option><option value="#4ECDC4">é’ç»¿è‰²</option>
                                <option value="#45B7D1">å¤©è“è‰²</option><option value="#96CEB4">è–„è·ç»¿</option>
                                <option value="#DDA0DD">æ¢…èŠ±ç´«</option><option value="#FFB6C1">ç²‰çº¢è‰²</option>
                            </select>
                            <button class="btn" onclick="animateSnowflake_ch4()">ğŸ¬ åŠ¨ç”»æ¼”ç¤º</button>
                            <button class="btn" onclick="drawKochSnowflake_ch4()">ğŸ”„ é‡æ–°ç»˜åˆ¶</button>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- ç¬¬äº”ç« ï¼šé«˜çº§æŠ€æœ¯ -->
        <section id="chapter5" class="chapter-content">
            <h2 class="chapter-title">ç¬¬äº”ç«  - é«˜çº§æŠ€æœ¯</h2>
            
            <div class="ch5-tabs">
                <button class="ch5-tab active" onclick="showInstance_ch5(1, this)">å®ä¾‹1ï¼šäº§å“é”€å”®é¢</button>
                <button class="ch5-tab" onclick="showInstance_ch5(2, this)">å®ä¾‹2ï¼šå® ç‰©äººç¾¤</button>
                <button class="ch5-tab" onclick="showInstance_ch5(3, this)">å®ä¾‹3ï¼šæŠ–éŸ³ç”¨æˆ·</button>
                <button class="ch5-tab" onclick="showInstance_ch5(4, this)">å®ä¾‹4ï¼šæ°”æ¸©é™æ°´</button>
                <button class="ch5-tab" onclick="showInstance_ch5(5, this)">å®ä¾‹5ï¼šæ±½è½¦é”€å”®</button>
            </div>

            <div id="ch5-instance" class="charts-grid">
                <div class="chart-container">
                    <div class="chart-title" id="ch5-title">å®ä¾‹1ï¼šäº§å“é”€å”®é¢åˆ†æ</div>
                    <div id="ch5-chart1" class="plot-area"></div>
                </div>
                <div class="chart-container">
                    <div class="chart-title" id="ch5-title2">é¥¼å›¾ï¼šäº§å“é”€å”®å æ¯”</div>
                    <div id="ch5-chart2" class="plot-area"></div>
                </div>
                <div class="chart-container">
                    <div class="chart-title" id="ch5-title3">é¥¼å›¾ï¼šå­£åº¦é”€å”®å¯¹æ¯”</div>
                    <div id="ch5-chart3" class="plot-area"></div>
                </div>
            </div>

            <div class="controls">
                <button class="btn" onclick="updateInstance_ch5()">æ›´æ–°æ•°æ®</button>
            </div>
        </section>

        <!-- ç¬¬å…­ç« ï¼šåæ ‡è½´é«˜çº§è®¾ç½® -->
        <section id="chapter6" class="chapter-content">
            <h2 class="chapter-title">ç¬¬å…­ç«  - åæ ‡è½´é«˜çº§è®¾ç½®</h2>
            
            <div class="ch6-tabs">
                <button class="ch6-tab active" onclick="showSection_ch6('axis-overview', this)">åæ ‡è½´æ¦‚è¿°</button>
                <button class="ch6-tab" onclick="showSection_ch6('custom-ticks', this)">å®šåˆ¶åˆ»åº¦</button>
                <button class="ch6-tab" onclick="showSection_ch6('hide-spines', this)">éšè—è½´è„Š</button>
                <button class="ch6-tab" onclick="showSection_ch6('case-study-1', this)">æ·±åœ³é£é€Ÿæ¡ˆä¾‹(ä¸€)</button>
                <button class="ch6-tab" onclick="showSection_ch6('case-study-2', this)">æ·±åœ³é£é€Ÿæ¡ˆä¾‹(äºŒ)</button>
                <button class="ch6-tab" onclick="showSection_ch6('case-study-3', this)">æ­£ä½™å¼¦å‡½æ•°æ¡ˆä¾‹</button>
            </div>

            <!-- åæ ‡è½´æ¦‚è¿° -->
            <div id="ch6-axis-overview" class="ch6-content">
                <div class="charts-grid">
                    <div class="chart-container">
                        <div class="chart-title">ğŸ“Š åŸºç¡€åæ ‡è½´ç»“æ„å±•ç¤º</div>
                        <div id="ch6-basic-axis" class="plot-area"></div>
                    </div>
                    <div class="chart-container">
                        <div class="chart-title">ğŸ¯ è½´è„Šç»„ä»¶æ ‡è¯†</div>
                        <div id="ch6-spine-chart" class="plot-area"></div>
                    </div>
                </div>
            </div>

            <!-- å…¶ä»–éƒ¨åˆ†ç±»ä¼¼æ·»åŠ ... -->
            <div id="ch6-custom-ticks" class="ch6-content" style="display:none;">
                <div class="charts-grid">
                    <div class="chart-container">
                        <div class="chart-title">ğŸ• æ—¶é—´åˆ»åº¦æ ¼å¼åŒ–</div>
                        <div id="ch6-time-tick" class="plot-area"></div>
                    </div>
                    <div class="chart-container">
                        <div class="chart-title">ğŸ¨ åˆ»åº¦æ ·å¼å®šåˆ¶</div>
                        <div id="ch6-tick-style" class="plot-area"></div>
                    </div>
                </div>
            </div>

            <div id="ch6-hide-spines" class="ch6-content" style="display:none;">
                <div class="charts-grid">
                    <div class="chart-container">
                        <div class="chart-title">ğŸ”² éšè—å…¨éƒ¨è½´è„Š</div>
                        <div id="ch6-hide-all" class="plot-area"></div>
                    </div>
                    <div class="chart-container">
                        <div class="chart-title">ğŸ“ éƒ¨åˆ†è½´è„Šéšè—</div>
                        <div id="ch6-hide-part" class="plot-area"></div>
                    </div>
                </div>
            </div>

            <div id="ch6-case-study-1" class="ch6-content" style="display:none;">
                <div class="charts-grid">
                    <div class="chart-container">
                        <div class="chart-title">ğŸŒ† æ·±åœ³å¸‚24å°æ—¶çš„å¹³å‡é£é€Ÿï¼ˆåŸºç¡€ç‰ˆï¼‰</div>
                        <div id="ch6-shenzhen-wind" class="plot-area"></div>
                    </div>
                </div>
            </div>

            <div id="ch6-case-study-2" class="ch6-content" style="display:none;">
                <div class="charts-grid">
                    <div class="chart-container">
                        <div class="chart-title">ğŸŒ† æ·±åœ³å¸‚24å°æ—¶å¹³å‡é£é€Ÿï¼ˆéšè—è½´è„Šç‰ˆï¼‰</div>
                        <div id="ch6-shenzhen-wind2" class="plot-area"></div>
                    </div>
                </div>
            </div>

            <div id="ch6-case-study-3" class="ch6-content" style="display:none;">
                <div class="charts-grid">
                    <div class="chart-container">
                        <div class="chart-title">ğŸ“ æ­£å¼¦å’Œä½™å¼¦å‡½æ•°å¯¹æ¯”</div>
                        <div id="ch6-sine-cosine" class="plot-area"></div>
                    </div>
                </div>
            </div>
        </section>

        <!-- ç¬¬ä¸ƒç« ï¼š3Då¯è§†åŒ– -->
        <section id="chapter7" class="chapter-content">
            <h2 class="chapter-title">ç¬¬ä¸ƒç«  - 3Då¯è§†åŒ–</h2>
            
            <div class="charts-grid">
                <div class="chart-container">
                    <div class="chart-title">å®ä¾‹1ï¼šä¸‰ç»´ç©ºé—´çš„æ˜Ÿæ˜Ÿ</div>
                    <div class="chart-description">ä½¿ç”¨3Dæ•£ç‚¹å›¾åœ¨ä¸‰ç»´ç©ºé—´ä¸­ç»˜åˆ¶ä¸åŒé¢œè‰²çš„æ˜Ÿæ˜Ÿï¼Œæ ¹æ®zå€¼å¤§å°ç€è‰²</div>
                    <div id="ch7-chart1" class="plot-area"></div>
                </div>
                <div class="chart-container">
                    <div class="chart-title">å®ä¾‹2ï¼šä¸‰ç»´ç©ºé—´é—ªçƒçš„æ˜Ÿæ˜Ÿ</div>
                    <div class="chart-description">åŠ¨ç”»æ•ˆæœå±•ç¤ºæ˜Ÿæ˜Ÿåœ¨ä¸‰ç»´ç©ºé—´ä¸­é—ªçƒï¼Œé¢œè‰²åœ¨ç™½è‰²å’Œç´«è‰²é—´å˜åŒ–</div>
                    <div id="ch7-chart2" class="plot-area"></div>
                </div>
                <div class="chart-container">
                    <div class="chart-title">å®ä¾‹3ï¼šç¾å›½éƒ¨åˆ†åŸé•‡äººå£åˆ†å¸ƒ</div>
                    <div class="chart-description">ä½¿ç”¨åœ°å›¾æŠ•å½±å±•ç¤ºç¾å›½å„åŸé•‡çš„äººå£åˆ†å¸ƒæƒ…å†µï¼Œæ°”æ³¡å¤§å°è¡¨ç¤ºäººå£æ•°é‡</div>
                    <div id="ch7-chart3" class="plot-area"></div>
                </div>
            </div>

            <div class="controls">
                <button class="btn" onclick="refreshAllCharts_ch7()">åˆ·æ–°æ‰€æœ‰å›¾è¡¨</button>
                <button class="btn" onclick="toggleAnimation_ch7()">åˆ‡æ¢åŠ¨ç”»</button>
                <button class="btn" onclick="resetView_ch7()">é‡ç½®è§†å›¾</button>
            </div>
        </section>

        <!-- ç¬¬å…«ç« ï¼šé«˜çº§æ•°æ®å¯è§†åŒ–æŠ€æœ¯ -->
        <section id="chapter8" class="chapter-content">
            <h2 class="chapter-title">ç¬¬å…«ç«  - é«˜çº§æ•°æ®å¯è§†åŒ–æŠ€æœ¯</h2>
            
            <div class="ch8-nav">
                <button class="ch8-nav-btn" id="ch8-prev" onclick="showPrevChart_ch8()">â† ä¸Šä¸€å¼ </button>
                <div class="ch8-counter" id="ch8-counter">1 / 10</div>
                <button class="ch8-nav-btn" id="ch8-next" onclick="showNextChart_ch8()">ä¸‹ä¸€å¼  â†’</button>
            </div>
            <div class="ch8-dots">
                <span class="ch8-dot active" onclick="jumpToChart_ch8(0)"></span>
                <span class="ch8-dot" onclick="jumpToChart_ch8(1)"></span>
                <span class="ch8-dot" onclick="jumpToChart_ch8(2)"></span>
                <span class="ch8-dot" onclick="jumpToChart_ch8(3)"></span>
                <span class="ch8-dot" onclick="jumpToChart_ch8(4)"></span>
                <span class="ch8-dot" onclick="jumpToChart_ch8(5)"></span>
                <span class="ch8-dot" onclick="jumpToChart_ch8(6)"></span>
                <span class="ch8-dot" onclick="jumpToChart_ch8(7)"></span>
                <span class="ch8-dot" onclick="jumpToChart_ch8(8)"></span>
                <span class="ch8-dot" onclick="jumpToChart_ch8(9)"></span>
            </div>

            <div class="charts-grid">
                <!-- ç­‰é«˜çº¿å›¾ -->
                <div class="chart-container" id="ch8-chart-0" style="display: block;">
                    <div class="chart-title">ç­‰é«˜çº¿å›¾ (8.1)</div>
                    <div class="chart-description">ç­‰é«˜çº¿å›¾ç”¨äºè¡¨ç¤ºä¸‰ç»´æ•°æ®åœ¨äºŒç»´å¹³é¢ä¸Šçš„æŠ•å½±ï¼Œé€šè¿‡ç­‰å€¼çº¿å±•ç¤ºæ•°æ®çš„é«˜åº¦åˆ†å¸ƒç‰¹å¾ã€‚</div>
                    <div id="ch8-contour" class="plot-area"></div>
                </div>
                
                <!-- çŸ¢é‡åœºæµçº¿å›¾ -->
                <div class="chart-container" id="ch8-chart-1" style="display: none;">
                    <div class="chart-title">çŸ¢é‡åœºæµçº¿å›¾ (8.2)</div>
                    <div class="chart-description">çŸ¢é‡åœºæµçº¿å›¾ç”¨äºå¯è§†åŒ–å‘é‡åœºçš„æµåŠ¨æ–¹å‘å’Œå¼ºåº¦ï¼Œå¹¿æ³›åº”ç”¨äºæµä½“åŠ›å­¦ã€ç”µç£åœºç­‰ç§‘å­¦è®¡ç®—é¢†åŸŸã€‚</div>
                    <div id="ch8-streamplot" class="plot-area"></div>
                </div>
                
                <!-- æ£‰æ£’å›¾ -->
                <div class="chart-container" id="ch8-chart-2" style="display: none;">
                    <div class="chart-title">æ£‰æ£’å›¾ (8.3)</div>
                    <div class="chart-description">æ£‰æ£’å›¾ç”¨äºå±•ç¤ºç¦»æ•£æ•°æ®ç‚¹çš„æ•°å€¼ï¼Œé€šè¿‡å‚ç›´çº¿æ¡è¿æ¥åŸºçº¿åˆ°æ•°æ®ç‚¹ï¼Œé€‚åˆå±•ç¤ºæ—¶é—´åºåˆ—æ•°æ®å¯¹æ¯”ã€‚</div>
                    <div id="ch8-stem" class="plot-area"></div>
                </div>
                
                <!-- å“‘é“ƒå›¾ -->
                <div class="chart-container" id="ch8-chart-3" style="display: none;">
                    <div class="chart-title">å“‘é“ƒå›¾ (8.4)</div>
                    <div class="chart-description">å“‘é“ƒå›¾ç”¨äºæ¯”è¾ƒä¸¤ä¸ªæ—¶é—´ç‚¹æˆ–ä¸¤ç»„æ•°æ®çš„å·®å¼‚ï¼Œé€šè¿‡è¿æ¥çº¿å±•ç¤ºå˜åŒ–è¶‹åŠ¿ï¼Œé€‚åˆå±•ç¤ºå‰åå¯¹æ¯”ã€‚</div>
                    <div id="ch8-dumbbell" class="plot-area"></div>
                </div>
                
                <!-- ç”˜ç‰¹å›¾ -->
                <div class="chart-container" id="ch8-chart-4" style="display: none;">
                    <div class="chart-title">ç”˜ç‰¹å›¾ (8.5)</div>
                    <div class="chart-description">ç”˜ç‰¹å›¾æ˜¯é¡¹ç›®ç®¡ç†ä¸­çš„é‡è¦å·¥å…·ï¼Œé€šè¿‡æ¡å½¢å›¾å±•ç¤ºé¡¹ç›®ä»»åŠ¡çš„æ—¶é—´å®‰æ’ã€æŒç»­æ—¶é—´å’Œä¾èµ–å…³ç³»ã€‚</div>
                    <div id="ch8-gantt" class="plot-area"></div>
                </div>
                
                <!-- äººå£é‡‘å­—å¡”å›¾ -->
                <div class="chart-container" id="ch8-chart-5" style="display: none;">
                    <div class="chart-title">äººå£é‡‘å­—å¡”å›¾ (8.6)</div>
                    <div class="chart-description">äººå£é‡‘å­—å¡”å›¾ç”¨äºå±•ç¤ºäººå£æŒ‰å¹´é¾„å’Œæ€§åˆ«çš„åˆ†å¸ƒæƒ…å†µï¼Œæ˜¯äººå£ç»Ÿè®¡å­¦ä¸­çš„ç»å…¸å›¾è¡¨ã€‚</div>
                    <div id="ch8-pyramid" class="plot-area"></div>
                </div>
                
                <!-- æ¼æ–—å›¾ -->
                <div class="chart-container" id="ch8-chart-6" style="display: none;">
                    <div class="chart-title">æ¼æ–—å›¾ (8.7)</div>
                    <div class="chart-description">æ¼æ–—å›¾ç”¨äºå±•ç¤ºæ•°æ®åœ¨ä¸åŒé˜¶æ®µçš„é€’å‡è¿‡ç¨‹ï¼Œå¸¸ç”¨äºé”€å”®æ¼æ–—ã€è½¬åŒ–ç‡åˆ†æç­‰åœºæ™¯ã€‚</div>
                    <div id="ch8-funnel" class="plot-area"></div>
                </div>
                
                <!-- æ¡‘åŸºå›¾ -->
                <div class="chart-container" id="ch8-chart-7" style="display: none;">
                    <div class="chart-title">æ¡‘åŸºå›¾ (8.8)</div>
                    <div class="chart-description">æ¡‘åŸºå›¾ç”¨äºå±•ç¤ºæµé‡åœ¨ä¸åŒèŠ‚ç‚¹é—´çš„åˆ†é…å’ŒæµåŠ¨ï¼Œé€šè¿‡æµåŠ¨å¸¦çš„å®½åº¦è¡¨ç¤ºæµé‡å¤§å°ã€‚</div>
                    <div id="ch8-sankey" class="plot-area"></div>
                </div>
                
                <!-- æ ‘çŠ¶å›¾ -->
                <div class="chart-container" id="ch8-chart-8" style="display: none;">
                    <div class="chart-title">æ ‘çŠ¶å›¾ (8.9)</div>
                    <div class="chart-description">æ ‘çŠ¶å›¾ä»¥æ ‘å½¢ç»“æ„å±•ç¤ºå±‚çº§æ•°æ®ï¼Œé€šè¿‡èŠ‚ç‚¹çš„è¿æ¥å…³ç³»å±•ç¤ºæ•°æ®çš„å±‚æ¬¡ç»“æ„å’Œä»å±å…³ç³»ã€‚</div>
                    <div id="ch8-tree" class="plot-area"></div>
                </div>
                
                <!-- åå¤«é¥¼å›¾ -->
                <div class="chart-container" id="ch8-chart-9" style="display: none;">
                    <div class="chart-title">åå¤«é¥¼å›¾ (8.10)</div>
                    <div class="chart-description">åå¤«é¥¼å›¾é€šè¿‡ç½‘æ ¼å•å…ƒçš„ç»„åˆå±•ç¤ºæ¯”ä¾‹æ•°æ®ï¼Œä»¥ç›´è§‚çš„æ–¹å¼å‘ˆç°ç™¾åˆ†æ¯”ä¿¡æ¯ã€‚</div>
                    <div id="ch8-waffle" class="plot-area"></div>
                </div>
            </div>
        </section>
    </div>

    <script>
        // ==================== å…¨å±€å˜é‡ ====================
        let currentChapter = 'chapter2';
        let animationFrame_ch7 = null;
        let isAnimating_ch7 = false;
        let currentChartIndex_ch2 = 0;
        let currentBasicChartIndex_ch3 = 0;
        let currentChartIndex_ch8 = 0;
        let charts_ch4 = {};
        let charts_ch5 = {};
        let currentInstance_ch5 = 1;

        // ==================== ç« èŠ‚åˆ‡æ¢ ====================
        function switchChapter(chapterId, tabElement) {
            // éšè—å½“å‰ç« èŠ‚
            document.querySelectorAll('.chapter-content').forEach(content => {
                content.classList.remove('active');
            });
            
            // ç§»é™¤æ‰€æœ‰æ ‡ç­¾çš„activeçŠ¶æ€
            document.querySelectorAll('.chapter-tab').forEach(tab => {
                tab.classList.remove('active');
            });
            
            // æ˜¾ç¤ºé€‰ä¸­çš„ç« èŠ‚
            document.getElementById(chapterId).classList.add('active');
            
            if (tabElement) {
                tabElement.classList.add('active');
            }
            
            currentChapter = chapterId;
            
            // åˆå§‹åŒ–å¯¹åº”ç« èŠ‚çš„å›¾è¡¨
            setTimeout(() => {
                initializeChapter(chapterId);
            }, 100);
        }

        function initializeChapter(chapterId) {
            switch(chapterId) {
                case 'chapter2':
                    initChapter2();
                    break;
                case 'chapter3':
                    initChapter3();
                    break;
                case 'chapter4':
                    initChapter4();
                    break;
                case 'chapter5':
                    initChapter5();
                    break;
                case 'chapter6':
                    initChapter6();
                    break;
                case 'chapter7':
                    initChapter7();
                    break;
                case 'chapter8':
                    initChapter8();
                    break;
            }
        }

        // ==================== ç¬¬äºŒç« ï¼šåŸºç¡€å›¾è¡¨ ====================
        const ch2Charts = [
            {
                title: "æŠ˜çº¿å›¾ - æœˆåº¦é”€å”®è¶‹åŠ¿",
                type: "line",
                data: {
                    x: ['1æœˆ', '2æœˆ', '3æœˆ', '4æœˆ', '5æœˆ', '6æœˆ', '7æœˆ', '8æœˆ', '9æœˆ', '10æœˆ', '11æœˆ', '12æœˆ'],
                    y: [4500, 5200, 4800, 6200, 5800, 7100, 6500, 7300, 6800, 7500, 8200, 9000],
                    name: 'é”€å”®é¢(ä¸‡å…ƒ)'
                }
            },
            {
                title: "æŸ±å½¢å›¾ - äº§å“é”€é‡å¯¹æ¯”",
                type: "bar",
                data: {
                    x: ['äº§å“A', 'äº§å“B', 'äº§å“C', 'äº§å“D', 'äº§å“E'],
                    y: [120, 200, 150, 80, 180],
                    name: 'é”€é‡'
                }
            },
            {
                title: "æ¡å½¢å›¾ - åŸå¸‚äººå£ç»Ÿè®¡",
                type: "bar",
                orientation: "h",
                data: {
                    y: ['åŒ—äº¬', 'ä¸Šæµ·', 'å¹¿å·', 'æ·±åœ³', 'æ­å·'],
                    x: [2154, 2424, 1500, 1303, 1036],
                    name: 'äººå£(ä¸‡)'
                }
            },
            {
                title: "å †ç§¯é¢ç§¯å›¾ - äº§å“å¸‚åœºä»½é¢",
                type: "area",
                data: {
                    x: ['1æœˆ', '2æœˆ', '3æœˆ', '4æœˆ', '5æœˆ', '6æœˆ'],
                    y1: [1500, 1800, 2000, 2200, 2500, 2800],
                    y2: [800, 950, 1100, 1200, 1300, 1400],
                    name1: 'çº¿ä¸Šæ¸ é“',
                    name2: 'çº¿ä¸‹æ¸ é“'
                }
            },
            {
                title: "ç›´æ–¹å›¾ - å¹´é¾„åˆ†å¸ƒ",
                type: "histogram",
                data: {
                    x: [22, 25, 29, 35, 42, 28, 31, 26, 33, 38, 27, 30, 24, 36, 41, 29, 32, 26, 34, 39],
                    name: 'å¹´é¾„åˆ†å¸ƒ'
                }
            },
            {
                title: "é¥¼å›¾ - é”€å”®æ¸ é“å æ¯”",
                type: "pie",
                data: {
                    labels: ['çº¿ä¸Š', 'çº¿ä¸‹', 'ä»£ç†å•†', 'ç›´é”€'],
                    values: [35, 25, 20, 20],
                    name: 'é”€å”®æ¸ é“'
                }
            },
            {
                title: "æ•£ç‚¹å›¾ - èº«é«˜ä½“é‡å…³ç³»",
                type: "scatter",
                mode: "markers",
                data: {
                    x: [165, 170, 175, 180, 185, 160, 168, 172, 178, 182],
                    y: [55, 60, 68, 75, 80, 50, 58, 65, 70, 78],
                    name: 'èº«é«˜ä½“é‡'
                }
            },
            {
                title: "ç®±å‹å›¾ - æˆç»©åˆ†å¸ƒ",
                type: "box",
                data: {
                    y: [[65, 70, 75, 80, 85], [60, 68, 72, 78, 82], [70, 75, 80, 85, 90]],
                    name: 'æˆç»©åˆ†å¸ƒ'
                }
            },
            {
                title: "é›·è¾¾å›¾ - æŠ€èƒ½è¯„ä¼°",
                type: "scatterpolar",
                data: {
                    r: [80, 65, 90, 75, 85],
                    theta: ['ç¼–ç¨‹', 'è®¾è®¡', 'æ²Ÿé€š', 'ç®¡ç†', 'åˆ›æ–°'],
                    name: 'æŠ€èƒ½æ°´å¹³'
                }
            },
            {
                title: "è¯¯å·®æ£’å›¾ - å®éªŒæ•°æ®",
                type: "scatter",
                mode: "markers",
                data: {
                    x: [1, 2, 3, 4, 5],
                    y: [2.3, 2.8, 3.1, 3.6, 4.2],
                    error_y: {type: 'data', array: [0.2, 0.3, 0.2, 0.4, 0.3]},
                    name: 'æµ‹é‡å€¼'
                }
            }
        ];

        function initChapter2() {
            showChart_ch2(currentChartIndex_ch2);
        }

        function showChart_ch2(index) {
            const chart = ch2Charts[index];
            const titleElement = document.getElementById('ch2-chart-title');
            titleElement.textContent = chart.title;

            let trace;
            let layout = {
                title: chart.title.includes(' - ') ? chart.title.split(' - ')[1] : chart.title,
                xaxis: chart.title === "æŠ˜çº¿å›¾ - æœˆåº¦é”€å”®è¶‹åŠ¿" ? {title: 'æœˆä»½'} : 
                       chart.title === "æŸ±å½¢å›¾ - äº§å“é”€é‡å¯¹æ¯”" ? {title: 'äº§å“åç§°'} : {},
                yaxis: chart.title === "æŠ˜çº¿å›¾ - æœˆåº¦é”€å”®è¶‹åŠ¿" ? {title: 'é”€å”®é¢(ä¸‡å…ƒ)'} : 
                       chart.title === "æŸ±å½¢å›¾ - äº§å“é”€é‡å¯¹æ¯”" ? {title: 'é”€é‡(ä»¶)'} : {},
                plot_bgcolor: 'rgba(0,0,0,0)',
                paper_bgcolor: 'rgba(0,0,0,0)',
                margin: { t: 40, r: 20, b: 40, l: 60 }
            };

            if (chart.type === 'pie') {
                trace = {
                    labels: chart.data.labels,
                    values: chart.data.values,
                    type: 'pie'
                };
            } else if (chart.type === 'box') {
                trace = chart.data.y.map((y, i) => ({
                    y: y,
                    type: 'box',
                    name: `ç»„${i+1}`
                }));
            } else if (chart.type === 'scatterpolar') {
                trace = {
                    r: chart.data.r,
                    theta: chart.data.theta,
                    type: 'scatterpolar',
                    fill: 'toself'
                };
                layout.polar = {};
            } else if (chart.type === 'histogram') {
                trace = {
                    x: chart.data.x,
                    type: 'histogram',
                    nbinsx: 10
                };
            } else if (chart.type === 'area') {
                // å †ç§¯é¢ç§¯å›¾éœ€è¦ä¸¤ä¸ªæ•°æ®ç³»åˆ—
                trace = [
                    {
                        x: chart.data.x,
                        y: chart.data.y1,
                        type: 'scatter',
                        mode: 'lines',
                        fill: 'tozeroy',
                        name: chart.data.name1,
                        line: {color: '#e74c3c'}
                    },
                    {
                        x: chart.data.x,
                        y: chart.data.y2,
                        type: 'scatter',
                        mode: 'lines',
                        fill: 'tonexty',
                        name: chart.data.name2,
                        line: {color: '#3498db'}
                    }
                ];
                
                // è®¾ç½®ä¸“é—¨çš„å¸ƒå±€
                layout.xaxis = {title: 'æœˆä»½'};
                layout.yaxis = {title: 'å¸‚åœºä»½é¢(%)'};
            } else {
                trace = {
                    x: chart.data.x,
                    y: chart.data.y,
                    type: chart.type === 'line' ? 'scatter' : (chart.type || 'scatter'),
                    mode: chart.type === 'line' ? 'lines+markers' : (chart.mode || 'markers'),
                    name: chart.data.name,
                    orientation: chart.orientation
                };
                
                // ä¸ºæŠ˜çº¿å›¾æ·»åŠ æ­£ç¡®çš„æ ·å¼
                if (chart.type === 'line') {
                    trace.line = {color: '#e74c3c', width: 3};
                    trace.marker = {size: 6, color: '#e74c3c'};
                }
                
                if (chart.data.error_y) {
                    trace.error_y = chart.data.error_y;
                }
                
                if (chart.fill) {
                    trace.fill = chart.fill;
                }
            }

            const traces = Array.isArray(trace) ? trace : [trace];
            Plotly.newPlot('ch2-chart', traces, layout, {responsive: true});

            // æ›´æ–°æŒ‡ç¤ºå™¨
            document.getElementById('ch2-indicator').textContent = `${index + 1} / ${ch2Charts.length}`;
            
            // æ›´æ–°æŒ‰é’®çŠ¶æ€
            document.getElementById('ch2-prev').disabled = index === 0;
            document.getElementById('ch2-next').disabled = index === ch2Charts.length - 1;
            
            currentChartIndex_ch2 = index;
        }

        function prevChart_ch2() {
            if (currentChartIndex_ch2 > 0) {
                showChart_ch2(currentChartIndex_ch2 - 1);
            }
        }

        function nextChart_ch2() {
            if (currentChartIndex_ch2 < ch2Charts.length - 1) {
                showChart_ch2(currentChartIndex_ch2 + 1);
            }
        }

        // ==================== ç¬¬ä¸‰ç« ï¼šç»¼åˆå›¾è¡¨ ====================
        let autoUpdateInterval_ch3 = null;

        function initChapter3() {
            showBasicCharts_ch3(document.querySelector('.ch3-tab.active'));
        }

        function showBasicCharts_ch3(tabElement) {
            // åœæ­¢è‡ªåŠ¨æ›´æ–°
            stopAutoUpdate_ch3();
            
            // åˆ‡æ¢æ ‡ç­¾çŠ¶æ€
            document.querySelectorAll('.ch3-tab').forEach(tab => tab.classList.remove('active'));
            tabElement.classList.add('active');
            
            // æ˜¾ç¤ºåŸºç¡€å›¾è¡¨éƒ¨åˆ†
            document.getElementById('ch3-basic').style.display = 'block';
            document.getElementById('ch3-interactive').style.display = 'none';
            
            showBasicChart_ch3(currentBasicChartIndex_ch3);
        }

        function showInteractive_ch3(tabElement) {
            // åˆ‡æ¢æ ‡ç­¾çŠ¶æ€
            document.querySelectorAll('.ch3-tab').forEach(tab => tab.classList.remove('active'));
            tabElement.classList.add('active');
            
            // æ˜¾ç¤ºäº¤äº’å¼éƒ¨åˆ†
            document.getElementById('ch3-basic').style.display = 'none';
            document.getElementById('ch3-interactive').style.display = 'block';
            
            updateInteractive_ch3();
            // å¯åŠ¨è‡ªåŠ¨æ›´æ–°
            startAutoUpdate_ch3();
        }

        function startAutoUpdate_ch3() {
            if (autoUpdateInterval_ch3) clearInterval(autoUpdateInterval_ch3);
            const speed = parseInt(document.getElementById('ch3-speed').value);
            // è°ƒæ•´ä¸ºæ›´æ…¢çš„é€Ÿåº¦ï¼Œæœ€é«˜é€Ÿåº¦ä¹Ÿæ§åˆ¶åœ¨åˆç†èŒƒå›´
            const intervalTime = Math.max(1000, 5000 / speed); // æœ€å¿«1ç§’ï¼Œæœ€æ…¢5ç§’
            autoUpdateInterval_ch3 = setInterval(() => {
                updateInteractive_ch3();
            }, intervalTime);
        }

        function stopAutoUpdate_ch3() {
            if (autoUpdateInterval_ch3) {
                clearInterval(autoUpdateInterval_ch3);
                autoUpdateInterval_ch3 = null;
            }
        }

        const ch3BasicCharts = [
            {
                title: "æ­£å¼¦ä½™å¼¦å‡½æ•°æ›²çº¿",
                data: [
                    {
                        x: Array.from({length: 101}, (_, i) => (-Math.PI + 2 * Math.PI * i / 100).toFixed(2)),
                        y: Array.from({length: 101}, (_, i) => Math.sin(-Math.PI + 2 * Math.PI * i / 100)),
                        type: 'scatter',
                        mode: 'lines',
                        name: 'sin(x)',
                        line: {color: '#e74c3c', width: 3}
                    },
                    {
                        x: Array.from({length: 101}, (_, i) => (-Math.PI + 2 * Math.PI * i / 100).toFixed(2)),
                        y: Array.from({length: 101}, (_, i) => Math.cos(-Math.PI + 2 * Math.PI * i / 100)),
                        type: 'scatter',
                        mode: 'lines',
                        name: 'cos(x)',
                        line: {color: '#3498db', width: 3}
                    }
                ]
            },
            {
                title: "ç”µå½±ç¥¨æˆ¿æ’è¡Œ",
                data: [
                    {
                        x: [50.03, 46.86, 42.5, 31.7, 29.12],
                        y: ['å“ªå’ä¹‹é­”ç«¥é™ä¸–', 'æµæµªåœ°çƒ', 'å¤ä»‡è€…è”ç›Ÿ4', 'æˆ‘å’Œæˆ‘çš„ç¥–å›½', 'ä¸­å›½æœºé•¿'],
                        type: 'bar',
                        orientation: 'h',
                        name: 'ç¥¨æˆ¿ï¼ˆäº¿å…ƒï¼‰',
                        marker: {color: '#27ae60'}
                    }
                ]
            },
            {
                title: "æ”¯ä»˜å®è´¦å•åˆ†æ",
                data: [
                    {
                        x: ['é¤é¥®', 'è´­ç‰©', 'äº¤é€š', 'å¨±ä¹', 'ç”Ÿæ´»ç¼´è´¹'],
                        y: [2800, 3500, 1200, 800, 600],
                        type: 'pie',
                        labels: ['é¤é¥®', 'è´­ç‰©', 'äº¤é€š', 'å¨±ä¹', 'ç”Ÿæ´»ç¼´è´¹']
                    }
                ]
            },
            {
                title: "æ±½è½¦é€Ÿåº¦åˆ†æ",
                data: [
                    {
                        x: [20, 30, 40, 50, 60, 70, 80],
                        y: [6, 14, 24, 38, 55, 75, 98],
                        type: 'scatter',
                        mode: 'markers',
                        name: 'é€Ÿåº¦ä¸åˆ¶åŠ¨è·ç¦»',
                        marker: {color: '#e67e22', size: 8}
                    }
                ]
            },
            {
                title: "è‹±è¯­æˆç»©å¯¹æ¯”",
                data: [
                    {
                        x: ['1ç­', '2ç­', '3ç­', '4ç­', '5ç­'],
                        y: [85, 78, 92, 88, 76],
                        type: 'bar',
                        name: 'ä¸Šå­¦æœŸ',
                        marker: {color: '#3498db'}
                    },
                    {
                        x: ['1ç­', '2ç­', '3ç­', '4ç­', '5ç­'],
                        y: [88, 82, 95, 91, 80],
                        type: 'bar',
                        name: 'ä¸‹å­¦æœŸ',
                        marker: {color: '#e74c3c'}
                    }
                ]
            }
        ];

        function showBasicChart_ch3(index) {
            const chart = ch3BasicCharts[index];
            document.getElementById('ch3-basic-title').textContent = chart.title;
            
            Plotly.newPlot('ch3-basic-chart', chart.data, {
                title: chart.title,
                margin: { t: 40, r: 20, b: 40, l: 40 }
            }, {responsive: true});

            // æ›´æ–°æŒ‡ç¤ºå™¨å’ŒæŒ‰é’®
            document.getElementById('ch3-indicator').textContent = `${index + 1} / ${ch3BasicCharts.length}`;
            document.getElementById('ch3-prev').disabled = index === 0;
            document.getElementById('ch3-next').disabled = index === ch3BasicCharts.length - 1;
            
            currentBasicChartIndex_ch3 = index;
        }

        function prevBasicChart_ch3() {
            if (currentBasicChartIndex_ch3 > 0) {
                showBasicChart_ch3(currentBasicChartIndex_ch3 - 1);
            }
        }

        function nextBasicChart_ch3() {
            if (currentBasicChartIndex_ch3 < ch3BasicCharts.length - 1) {
                showBasicChart_ch3(currentBasicChartIndex_ch3 + 1);
            }
        }

        function updateInteractive_ch3() {
            const points = parseInt(document.getElementById('ch3-points').value);
            const type = document.getElementById('ch3-type').value;
            const range = 50;
            // å‡æ…¢æ—¶é—´å˜åŒ–é€Ÿåº¦ï¼Œè®©åŠ¨ç”»æ›´å¹³æ»‘
            const time = Date.now() / 5000; // ä»1000æ”¹ä¸º5000ï¼Œå˜æ…¢5å€

            const x = Array.from({length: points}, (_, i) => i);
            
            // åŠ¨æ€æŠ˜çº¿å›¾ - åŸºäºæ—¶é—´çš„æ­£å¼¦æ³¢ï¼Œå‡å°‘éšæœºæ‰°åŠ¨
            const y1 = x.map(i => Math.sin(i * 0.1 + time) * range / 4 + range / 2);
            
            // æ•£ç‚¹å›¾ - éšæœºåˆ†å¸ƒä½†æœ‰è§„å¾‹ï¼Œå‡å°‘å˜åŒ–å¹…åº¦
            const y2 = y1.map(val => val + (Math.random() - 0.5) * 10); // ä»rangeæ”¹ä¸º10
            const y3 = Array.from({length: points}, () => Math.random() * 30 + 20); // å‡å°èŒƒå›´

            Plotly.newPlot('ch3-interactive1', [{
                x: x, y: y1, 
                type: type, 
                mode: type === 'scatter' ? 'markers' : 'lines+markers', 
                name: 'å®æ—¶æ•°æ®æµ',
                line: {color: '#27ae60', width: 3},
                marker: {size: 6, color: '#27ae60'}
            }], {
                title: `åŠ¨æ€æŠ˜çº¿å›¾ - å®æ—¶æ•°æ®æµ`,
                margin: {t: 40, r: 20, b: 40, l: 50}
            }, {responsive: true});

            Plotly.newPlot('ch3-interactive2', [{
                x: y1, 
                y: y2, 
                mode: 'markers', 
                type: 'scatter', 
                name: 'æ•°æ®ç‚¹å…³ç³»',
                marker: {size: 8, color: '#3498db', opacity: 0.7}
            }], {
                title: 'äº¤äº’å¼æ•£ç‚¹å›¾ - æ•°æ®ç­›é€‰',
                xaxis: {title: 'Xå€¼'},
                yaxis: {title: 'Yå€¼'},
                margin: {t: 40, r: 20, b: 40, l: 50}
            }, {responsive: true});

            // å®æ—¶æŸ±çŠ¶å›¾ - å‰10ä¸ªæ•°æ®ç‚¹
            const barData = y3.slice(0, 10);
            Plotly.newPlot('ch3-interactive3', [{
                x: Array.from({length: 10}, (_, i) => `é¡¹ç›®${i+1}`), 
                y: barData, 
                type: 'bar', 
                name: 'æŸ±çŠ¶å›¾',
                marker: {color: ['#e74c3c', '#3498db', '#2ecc71', '#f39c12', '#9b59b6'].slice(0, 10)}
            }], {
                title: 'å®æ—¶æŸ±çŠ¶å›¾ - åŠ¨æ€æ›´æ–°',
                yaxis: {title: 'æ•°å€¼'},
                margin: {t: 40, r: 20, b: 40, l: 50}
            }, {responsive: true});

            // å¤šå›¾è¡¨è”åŠ¨ - ä¸¤ä¸ªç›¸å…³æ•°æ®ç³»åˆ—
            const y4 = x.map(i => Math.cos(i * 0.1 + time) * range / 4 + range / 2);
            Plotly.newPlot('ch3-interactive4', [
                {
                    x: x, 
                    y: y1, 
                    type: 'scatter', 
                    name: 'æ•°æ®é›†1',
                    line: {color: '#e74c3c', width: 3}
                },
                {
                    x: x, 
                    y: y4, 
                    type: 'scatter', 
                    name: 'æ•°æ®é›†2',
                    line: {color: '#f39c12', width: 3, dash: 'dash'}
                }
            ], {
                title: 'å¤šå›¾è¡¨è”åŠ¨',
                xaxis: {title: 'æ—¶é—´'},
                yaxis: {title: 'æ•°å€¼'},
                margin: {t: 40, r: 20, b: 40, l: 50}
            }, {responsive: true});
        }

        // ==================== ç¬¬å››ç« ï¼šPythoné£æ ¼å›¾è¡¨ ====================
        let charts_ch4 = {};
        let showLabels_ch4 = true;

        function initChapter4() {
            initBookChart_ch4();
        }

        function showTab_ch4(tabName, buttonElement) {
            // éšè—æ‰€æœ‰æ ‡ç­¾å†…å®¹
            document.querySelectorAll('.ch4-tab-content').forEach(tab => {
                tab.classList.remove('active');
            });
            
            // ç§»é™¤æ‰€æœ‰æŒ‰é’®çš„activeç±»
            document.querySelectorAll('.ch4-tab-button').forEach(btn => {
                btn.classList.remove('active');
            });
            
            // æ˜¾ç¤ºé€‰ä¸­çš„æ ‡ç­¾å†…å®¹
            document.getElementById('ch4-' + tabName).classList.add('active');
            
            // æ·»åŠ activeç±»åˆ°å¯¹åº”æŒ‰é’®
            if (buttonElement) {
                buttonElement.classList.add('active');
            }
            
            // å»¶è¿Ÿåˆå§‹åŒ–å›¾è¡¨ï¼Œç¡®ä¿å®¹å™¨å¯è§
            setTimeout(() => {
                switch(tabName) {
                    case 'book': 
                        initBookChart_ch4(); 
                        break;
                    case 'exchange': 
                        initExchangeChart_ch4(); 
                        break;
                    case 'sales': 
                        initSalesChart_ch4(); 
                        break;
                    case 'temperature': 
                        initTemperatureChart_ch4(); 
                        break;
                    case 'snowflake': 
                        initSnowflakeChart_ch4(); 
                        break;
                }
            }, 100);
        }

        // ç”Ÿæˆéšæœºæ•°æ®
        function generateRandomData(count, min, max) {
            return Array.from({length: count}, () => 
                Math.floor(Math.random() * (max - min + 1)) + min
            );
        }

        // å®ä¾‹1ï¼šå›¾ä¹¦é‡‡è´­
        function initBookChart_ch4() {
            const ctx = document.getElementById('bookChart');
            if (!ctx) return;
            
            if (charts_ch4.book) {
                charts_ch4.book.destroy();
            }

            const data = {
                labels: ['å®¶åº­', 'å°è¯´', 'å¿ƒç†', 'ç§‘æŠ€', 'å„¿ç«¥'],
                datasets: [{
                    label: 'åœ°åŒº1',
                    data: generateRandomData(5, 1000, 2500),
                    backgroundColor: '#FFCC00',
                    borderColor: '#FFCC00',
                    borderWidth: 1
                }, {
                    label: 'åœ°åŒº2',
                    data: generateRandomData(5, 800, 2200),
                    backgroundColor: '#B0C4DE',
                    borderColor: '#B0C4DE',
                    borderWidth: 1
                }]
            };

            charts_ch4.book = new Chart(ctx, {
                type: 'bar',
                data: data,
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        title: {display: false},
                        legend: {display: true, position: 'top'}
                    },
                    scales: {
                        x: {stacked: true, title: {display: true, text: 'å›¾ä¹¦ç§ç±»'}},
                        y: {stacked: true, beginAtZero: true, title: {display: true, text: 'é‡‡è´­æ•°é‡(æœ¬)'}}
                    }
                }
            });
        }

        function generateBookData_ch4() {
            if (charts_ch4.book) {
                charts_ch4.book.data.datasets[0].data = generateRandomData(5, 1000, 2500);
                charts_ch4.book.data.datasets[1].data = generateRandomData(5, 800, 2200);
                charts_ch4.book.update();
            }
        }

        function toggleBookType_ch4() {
            if (charts_ch4.book) {
                charts_ch4.book.config.type = charts_ch4.book.config.type === 'bar' ? 'line' : 'bar';
                charts_ch4.book.update();
            }
        }

        // å®ä¾‹2ï¼šæ±‡ç‡èµ°åŠ¿
        function initExchangeChart_ch4() {
            const ctx = document.getElementById('ch4-exchange-chart');
            if (!ctx) return;
            
            if (charts_ch4.exchange) {
                charts_ch4.exchange.destroy();
            }

            const date_x = [3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 17, 18, 19, 24, 25, 26, 31];
            const eurcny_2017 = generateRandomData(19, 6.7, 6.9);
            const eurcny_2019 = generateRandomData(19, 6.8, 7.0);

            const data = {
                labels: date_x,
                datasets: [{
                    label: '2017å¹´7æœˆç¾å…ƒ/äººæ°‘å¸æ±‡ç‡',
                    data: eurcny_2017,
                    borderColor: '#006374',
                    backgroundColor: 'rgba(0, 99, 116, 0.1)',
                    borderWidth: 2,
                    tension: 0.1
                }, {
                    label: '2019å¹´7æœˆç¾å…ƒ/äººæ°‘å¸æ±‡ç‡',
                    data: eurcny_2019,
                    borderColor: '#8a2e76',
                    backgroundColor: 'rgba(138, 46, 118, 0.1)',
                    borderWidth: 2,
                    borderDash: [5, 5],
                    tension: 0.1
                }]
            };

            charts_ch4.exchange = new Chart(ctx, {
                type: 'line',
                data: data,
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        title: {display: false},
                        legend: {display: true, position: 'top'}
                    },
                    scales: {
                        x: {title: {display: true, text: 'æ—¥æœŸ'}},
                        y: {title: {display: true, text: 'æ±‡ç‡'}}
                    }
                }
            });
        }

        function generateExchangeData_ch4() {
            if (charts_ch4.exchange) {
                charts_ch4.exchange.data.datasets[0].data = generateRandomData(19, 6.7, 6.9);
                charts_ch4.exchange.data.datasets[1].data = generateRandomData(19, 6.8, 7.0);
                charts_ch4.exchange.update();
            }
        }

        function toggleLineStyle_ch4() {
            if (charts_ch4.exchange) {
                const dataset1 = charts_ch4.exchange.data.datasets[1];
                dataset1.borderDash = dataset1.borderDash.length ? [] : [5, 5];
                charts_ch4.exchange.update();
            }
        }

        // å®ä¾‹3ï¼šäº§å“é”€å”®é¢
        function initSalesChart_ch4() {
            const ctx = document.getElementById('ch4-sales-chart');
            if (!ctx) return;
            
            if (charts_ch4.sales) {
                charts_ch4.sales.destroy();
            }

            const data = {
                labels: ['ç¬¬1å­£åº¦', 'ç¬¬2å­£åº¦', 'ç¬¬3å­£åº¦', 'ç¬¬4å­£åº¦'],
                datasets: [{
                    label: 'äº§å“A',
                    data: generateRandomData(4, 2000, 8000),
                    borderColor: '#FF6B6B',
                    backgroundColor: 'rgba(255, 107, 107, 0.1)',
                    borderWidth: 3,
                    pointStyle: 'triangle',
                    pointRadius: 8,
                    tension: 0.1
                }, {
                    label: 'äº§å“B',
                    data: generateRandomData(4, 800, 4500),
                    borderColor: '#4ECDC4',
                    backgroundColor: 'rgba(78, 205, 196, 0.1)',
                    borderWidth: 3,
                    pointStyle: 'rect',
                    pointRadius: 8,
                    tension: 0.1
                }, {
                    label: 'äº§å“C',
                    data: generateRandomData(4, 100, 700),
                    borderColor: '#45B7D1',
                    backgroundColor: 'rgba(69, 183, 209, 0.1)',
                    borderWidth: 3,
                    pointStyle: 'rectRot',
                    pointRadius: 8,
                    tension: 0.1,
                    borderDash: [5, 5]
                }]
            };

            charts_ch4.sales = new Chart(ctx, {
                type: 'line',
                data: data,
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        title: {display: false},
                        legend: {display: true, position: 'top'}
                    },
                    scales: {
                        x: {title: {display: true, text: 'å­£åº¦'}},
                        y: {beginAtZero: true, title: {display: true, text: 'é”€å”®é¢(ä¸‡å…ƒ)'}}
                    }
                }
            });
        }

        function generateSalesData_ch4() {
            if (charts_ch4.sales) {
                charts_ch4.sales.data.datasets[0].data = generateRandomData(4, 2000, 8000);
                charts_ch4.sales.data.datasets[1].data = generateRandomData(4, 800, 4500);
                charts_ch4.sales.data.datasets[2].data = generateRandomData(4, 100, 700);
                charts_ch4.sales.update();
            }
        }

        function toggleMarkerStyle_ch4() {
            if (charts_ch4.sales) {
                const styles = ['circle', 'triangle', 'rect', 'rectRot', 'star', 'triangle'];
                charts_ch4.sales.data.datasets.forEach((dataset, index) => {
                    const currentStyle = dataset.pointStyle;
                    const currentIndex = styles.indexOf(currentStyle);
                    dataset.pointStyle = styles[(currentIndex + 1) % styles.length];
                });
                charts_ch4.sales.update();
            }
        }

        // å®ä¾‹4ï¼šæ°”æ¸©èµ°åŠ¿
        function initTemperatureChart_ch4() {
            const ctx = document.getElementById('ch4-temperature-chart');
            if (!ctx) return;
            
            if (charts_ch4.temperature) {
                charts_ch4.temperature.destroy();
            }

            const x = Array.from({length: 15}, (_, i) => i + 4);
            const y_max = generateRandomData(15, 20, 35);
            const y_min = generateRandomData(15, 10, 25);

            const data = {
                labels: x,
                datasets: [{
                    label: 'æœ€é«˜æ¸©åº¦',
                    data: y_max,
                    borderColor: '#FF6B6B',
                    backgroundColor: 'rgba(255, 107, 107, 0.1)',
                    borderWidth: 3,
                    pointRadius: 6,
                    tension: 0.2
                }, {
                    label: 'æœ€ä½æ¸©åº¦',
                    data: y_min,
                    borderColor: '#4ECDC4',
                    backgroundColor: 'rgba(78, 205, 196, 0.1)',
                    borderWidth: 3,
                    pointRadius: 6,
                    tension: 0.2
                }]
            };

            charts_ch4.temperature = new Chart(ctx, {
                type: 'line',
                data: data,
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        title: {display: false},
                        legend: {display: true, position: 'top'}
                    },
                    scales: {
                        x: {title: {display: true, text: 'æ—¥æœŸ'}},
                        y: {beginAtZero: false, min: 0, max: 40, title: {display: true, text: 'æ¸©åº¦(Â°C)'}}
                    }
                }
            });
        }

        function generateTemperatureData_ch4() {
            if (charts_ch4.temperature) {
                charts_ch4.temperature.data.datasets[0].data = generateRandomData(15, 20, 35);
                charts_ch4.temperature.data.datasets[1].data = generateRandomData(15, 10, 25);
                charts_ch4.temperature.update();
            }
        }

        function toggleTemperatureLabels_ch4() {
            showLabels_ch4 = !showLabels_ch4;
            if (charts_ch4.temperature) {
                charts_ch4.temperature.options.plugins.datalabels.display = showLabels_ch4;
                charts_ch4.temperature.update();
            }
        }

        // å®ä¾‹5ï¼šKoché›ªèŠ±
        function initSnowflakeChart_ch4() {
            drawKochSnowflake_ch4();
        }

        function drawKochSnowflake_ch4() {
            const canvas = document.getElementById('ch4-koch-snowflake');
            if (!canvas) return;
            
            const ctx = canvas.getContext('2d');
            canvas.width = 600;
            canvas.height = 400;
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            
            const iterations = parseInt(document.getElementById('ch4-snowflake-iterations').value);
            const snowflakeColor = document.getElementById('ch4-snowflake-color').value;
            
            ctx.strokeStyle = snowflakeColor;
            ctx.lineWidth = 2;
            ctx.fillStyle = snowflakeColor + '30';
            
            // Kochæ›²çº¿ç”Ÿæˆå‡½æ•°
            function getKochLine(x1, y1, x2, y2, level) {
                if (level === 0) {
                    return [{x: x1, y: y1}, {x: x2, y: y2}];
                }
                
                const dx = x2 - x1;
                const dy = y2 - y1;
                
                const x3 = x1 + dx/3;
                const y3 = y1 + dy/3;
                const x5 = x1 + 2*dx/3;
                const y5 = y1 + 2*dy/3;
                
                const angle = Math.atan2(dy, dx) - Math.PI/3;
                const length = Math.sqrt(dx*dx + dy*dy) / 3;
                
                const x4 = x3 + length * Math.cos(angle);
                const y4 = y3 + length * Math.sin(angle);
                
                const segment1 = getKochLine(x1, y1, x3, y3, level - 1);
                const segment2 = getKochLine(x3, y3, x4, y4, level - 1);
                const segment3 = getKochLine(x4, y4, x5, y5, level - 1);
                const segment4 = getKochLine(x5, y5, x2, y2, level - 1);
                
                return [
                    ...segment1.slice(0, -1),
                    ...segment2.slice(0, -1),
                    ...segment3.slice(0, -1),
                    ...segment4
                ];
            }
            
            // ç”Ÿæˆé›ªèŠ±
            const size = 150;
            const centerX = 300;
            const centerY = 200;
            
            const angle1 = -Math.PI / 2;
            const angle2 = angle1 + (2 * Math.PI / 3);
            const angle3 = angle2 + (2 * Math.PI / 3);
            
            const p1 = {x: centerX + size * Math.cos(angle1), y: centerY + size * Math.sin(angle1)};
            const p2 = {x: centerX + size * Math.cos(angle2), y: centerY + size * Math.sin(angle2)};
            const p3 = {x: centerX + size * Math.cos(angle3), y: centerY + size * Math.sin(angle3)};
            
            const side1 = getKochLine(p1.x, p1.y, p2.x, p2.y, iterations);
            const side2 = getKochLine(p2.x, p2.y, p3.x, p3.y, iterations);
            const side3 = getKochLine(p3.x, p3.y, p1.x, p1.y, iterations);
            
            // ç»˜åˆ¶é›ªèŠ±
            ctx.beginPath();
            ctx.moveTo(side1[0].x, side1[0].y);
            for (let i = 1; i < side1.length; i++) {
                ctx.lineTo(side1[i].x, side1[i].y);
            }
            for (let i = 1; i < side2.length; i++) {
                ctx.lineTo(side2[i].x, side2[i].y);
            }
            for (let i = 1; i < side3.length; i++) {
                ctx.lineTo(side3[i].x, side3[i].y);
            }
            ctx.closePath();
            ctx.fill();
            ctx.stroke();
        }

        function animateSnowflake_ch4() {
            let iteration = 0;
            const maxIteration = 4;
            
            const animate = () => {
                document.getElementById('ch4-snowflake-iterations').value = iteration;
                drawKochSnowflake_ch4();
                
                iteration++;
                if (iteration <= maxIteration) {
                    setTimeout(animate, 800);
                }
            };
            
            animate();
        }

        // ==================== ç¬¬äº”ç« ï¼šé«˜çº§æŠ€æœ¯ ====================
        function initChapter5() {
            showInstance_ch5(currentInstance_ch5, document.querySelector('.ch5-tab.active'));
        }

        function showInstance_ch5(instanceNum, tabElement) {
            // åˆ‡æ¢æ ‡ç­¾çŠ¶æ€
            document.querySelectorAll('.ch5-tab').forEach(tab => tab.classList.remove('active'));
            tabElement.classList.add('active');
            
            currentInstance_ch5 = instanceNum;
            createInstanceCharts_ch5(instanceNum);
        }

        function createInstanceCharts_ch5(instanceNum) {
            const titleElement = document.getElementById('ch5-title');
            const titleElement2 = document.getElementById('ch5-title2');
            const titleElement3 = document.getElementById('ch5-title3');
            
            switch(instanceNum) {
                case 1:
                    // äº§å“é”€å”®é¢åˆ†æ
                    titleElement.textContent = "å®ä¾‹1ï¼šäº§å“é”€å”®é¢åˆ†æ";
                    titleElement2.textContent = "é¥¼å›¾ï¼šäº§å“é”€å”®å æ¯”";
                    titleElement3.textContent = "é¥¼å›¾ï¼šå­£åº¦é”€å”®å¯¹æ¯”";
                    
                    // é”€å”®è¶‹åŠ¿å›¾
                    const salesData = [
                        {x: ['Q1', 'Q2', 'Q3', 'Q4'], y: [120, 150, 180, 200], type: 'scatter', mode: 'lines+markers', name: 'é”€å”®é¢(ä¸‡å…ƒ)'}
                    ];
                    Plotly.newPlot('ch5-chart1', salesData, {title: 'äº§å“é”€å”®è¶‹åŠ¿'}, {responsive: true});
                    
                    // äº§å“å æ¯”é¥¼å›¾
                    const productData = [{
                        values: [35, 25, 20, 15, 5],
                        labels: ['äº§å“A', 'äº§å“B', 'äº§å“C', 'äº§å“D', 'å…¶ä»–'],
                        type: 'pie'
                    }];
                    Plotly.newPlot('ch5-chart2', productData, {title: 'äº§å“é”€å”®å æ¯”'}, {responsive: true});
                    
                    // å­£åº¦å¯¹æ¯”é¥¼å›¾
                    const quarterData = [{
                        values: [120, 150, 180, 200],
                        labels: ['Q1', 'Q2', 'Q3', 'Q4'],
                        type: 'pie'
                    }];
                    Plotly.newPlot('ch5-chart3', quarterData, {title: 'å­£åº¦é”€å”®å¯¹æ¯”'}, {responsive: true});
                    break;
                    
                case 2:
                    // å® ç‰©äººç¾¤æ¯”ä¾‹åˆ†æ
                    titleElement.textContent = "å®ä¾‹2ï¼šå® ç‰©äººç¾¤æ¯”ä¾‹åˆ†æ";
                    titleElement2.textContent = "å…»å® äººç¾¤æ€§åˆ«åˆ†å¸ƒ";
                    titleElement3.textContent = "å…»å® äººç¾¤å¹´é¾„åˆ†å¸ƒ";
                    
                    const petData1 = [{
                        x: ['çŒ«', 'ç‹—', 'é±¼', 'å…”å­', 'ä»“é¼ '],
                        y: [45, 38, 8, 6, 3],
                        type: 'bar',
                        orientation: 'h',
                        name: 'å æ¯”(%)'
                    }];
                    Plotly.newPlot('ch5-chart1', petData1, {title: 'å® ç‰©ç§ç±»åˆ†å¸ƒ'}, {responsive: true});
                    
                    const genderData = [{
                        values: [58, 42],
                        labels: ['å¥³æ€§', 'ç”·æ€§'],
                        type: 'pie'
                    }];
                    Plotly.newPlot('ch5-chart2', genderData, {title: 'å…»å® äººç¾¤æ€§åˆ«åˆ†å¸ƒ'}, {responsive: true});
                    
                    const ageData = [{
                        x: ['18-25', '26-35', '36-45', '46-55', '55+'],
                        y: [25, 35, 22, 12, 6],
                        type: 'bar',
                        name: 'å æ¯”(%)'
                    }];
                    Plotly.newPlot('ch5-chart3', ageData, {title: 'å…»å® äººç¾¤å¹´é¾„åˆ†å¸ƒ'}, {responsive: true});
                    break;
                    
                case 3:
                    // æŠ–éŸ³ç”¨æˆ·åˆ†æ
                    titleElement.textContent = "å®ä¾‹3ï¼šæŠ–éŸ³ç”¨æˆ·åˆ†æ";
                    titleElement2.textContent = "ç”¨æˆ·æ´»è·ƒæ—¶é—´æ®µ";
                    titleElement3.textContent = "å†…å®¹ç±»å‹åˆ†å¸ƒ";
                    
                    const growthData = [
                        {x: ['2018', '2019', '2020', '2021', '2022'], y: [1, 3.2, 6, 8.5, 10], type: 'scatter', mode: 'lines+markers', name: 'ç”¨æˆ·å¢é•¿(äº¿)'}
                    ];
                    Plotly.newPlot('ch5-chart1', growthData, {title: 'æŠ–éŸ³ç”¨æˆ·å¢é•¿è¶‹åŠ¿'}, {responsive: true});
                    
                    const activeData = [{
                        values: [35, 28, 20, 10, 7],
                        labels: ['æ™šä¸Š', 'ä¸‹åˆ', 'ä¸Šåˆ', 'æ·±å¤œ', 'å‡Œæ™¨'],
                        type: 'pie'
                    }];
                    Plotly.newPlot('ch5-chart2', activeData, {title: 'ç”¨æˆ·æ´»è·ƒæ—¶é—´æ®µ'}, {responsive: true});
                    
                    const contentTypeData = [{
                        values: [30, 25, 20, 15, 10],
                        labels: ['å¨±ä¹', 'æ•™è‚²', 'ç”Ÿæ´»', 'æ–°é—»', 'å…¶ä»–'],
                        type: 'pie'
                    }];
                    Plotly.newPlot('ch5-chart3', contentTypeData, {title: 'å†…å®¹ç±»å‹åˆ†å¸ƒ'}, {responsive: true});
                    break;
                    
                case 4:
                    // æ°”æ¸©é™æ°´è’¸å‘é‡
                    titleElement.textContent = "å®ä¾‹4ï¼šæ°”æ¸©é™æ°´è’¸å‘é‡";
                    titleElement2.textContent = "é™æ°´é‡åˆ†å¸ƒ";
                    titleElement3.textContent = "è’¸å‘é‡åˆ†æ";
                    
                    const months = ['1æœˆ', '2æœˆ', '3æœˆ', '4æœˆ', '5æœˆ', '6æœˆ', '7æœˆ', '8æœˆ', '9æœˆ', '10æœˆ', '11æœˆ', '12æœˆ'];
                    const temp = [5, 8, 15, 20, 25, 30, 35, 34, 28, 20, 12, 6];
                    const rain = [50, 60, 80, 100, 120, 150, 180, 160, 90, 70, 55, 45];
                    
                    const climateData = [
                        {x: months, y: temp, type: 'scatter', mode: 'lines+markers', name: 'æ¸©åº¦(Â°C)', yaxis: 'y'},
                        {x: months, y: rain, type: 'scatter', mode: 'lines+markers', name: 'é™æ°´é‡(mm)', yaxis: 'y2'}
                    ];
                    Plotly.newPlot('ch5-chart1', climateData, {
                        title: 'æ°”æ¸©ä¸é™æ°´é‡å…³ç³»',
                        yaxis: {title: 'æ¸©åº¦(Â°C)'},
                        yaxis2: {title: 'é™æ°´é‡(mm)', overlaying: 'y', side: 'right'}
                    }, {responsive: true});
                    
                    const rainDist = [{
                        x: months,
                        y: rain,
                        type: 'bar',
                        name: 'é™æ°´é‡(mm)'
                    }];
                    Plotly.newPlot('ch5-chart2', rainDist, {title: 'å„æœˆé™æ°´é‡åˆ†å¸ƒ'}, {responsive: true});
                    
                    const evaporation = [40, 45, 70, 90, 110, 140, 160, 150, 100, 80, 50, 35];
                    const evapData = [{
                        x: months,
                        y: evaporation,
                        type: 'scatter',
                        mode: 'lines+markers',
                        name: 'è’¸å‘é‡(mm)'
                    }];
                    Plotly.newPlot('ch5-chart3', evapData, {title: 'å„æœˆè’¸å‘é‡åˆ†æ'}, {responsive: true});
                    break;
                    
                case 5:
                    // æ±½è½¦é”€å”®æƒ…å†µ
                    titleElement.textContent = "å®ä¾‹5ï¼šæ±½è½¦é”€å”®æƒ…å†µ";
                    titleElement2.textContent = "ä¸åŒå“ç‰Œé”€é‡";
                    titleElement3.textContent = "é”€å”®è¶‹åŠ¿é¢„æµ‹";
                    
                    const carBrands = ['å¤§ä¼—', 'ä¸°ç”°', 'æœ¬ç”°', 'æ—¥äº§', 'å¥”é©°', 'å®é©¬'];
                    const carSales = [280, 250, 220, 180, 150, 120];
                    
                    const brandData = [{
                        x: carBrands,
                        y: carSales,
                        type: 'bar',
                        name: 'é”€é‡(ä¸‡è¾†)'
                    }];
                    Plotly.newPlot('ch5-chart1', brandData, {title: 'æ±½è½¦å“ç‰Œé”€é‡å¯¹æ¯”'}, {responsive: true});
                    
                    const brandPie = [{
                        values: carSales,
                        labels: carBrands,
                        type: 'pie'
                    }];
                    Plotly.newPlot('ch5-chart2', brandPie, {title: 'å“ç‰Œé”€é‡å æ¯”'}, {responsive: true});
                    
                    const futureYears = ['2023', '2024', '2025', '2026'];
                    const futureSales = [1500, 1650, 1800, 1950];
                    const trendData = [{
                        x: futureYears,
                        y: futureSales,
                        type: 'scatter',
                        mode: 'lines+markers',
                        name: 'é¢„è®¡é”€é‡(ä¸‡è¾†)'
                    }];
                    Plotly.newPlot('ch5-chart3', trendData, {title: 'å¸‚åœºé”€å”®è¶‹åŠ¿é¢„æµ‹'}, {responsive: true});
                    break;
            }
        }

        function updateInstance_ch5() {
            createInstanceCharts_ch5(currentInstance_ch5);
        }

        // ==================== ç¬¬å…­ç« ï¼šåæ ‡è½´é«˜çº§è®¾ç½® ====================
        function initChapter6() {
            initializeAxisOverview_ch6();
        }

        function showSection_ch6(sectionId, buttonElement) {
            // éšè—æ‰€æœ‰å†…å®¹
            document.querySelectorAll('.ch6-content').forEach(section => {
                section.style.display = 'none';
            });
            
            // ç§»é™¤æ‰€æœ‰æŒ‰é’®çš„activeç±»
            document.querySelectorAll('.ch6-tab').forEach(button => {
                button.classList.remove('active');
            });
            
            // æ˜¾ç¤ºé€‰ä¸­çš„å†…å®¹
            document.getElementById('ch6-' + sectionId).style.display = 'block';
            buttonElement.classList.add('active');
            
            // åˆå§‹åŒ–å¯¹åº”çš„å›¾è¡¨
            setTimeout(() => {
                switch(sectionId) {
                    case 'axis-overview':
                        initializeAxisOverview_ch6();
                        break;
                    case 'custom-ticks':
                        initializeCustomTicks_ch6();
                        break;
                    case 'hide-spines':
                        initializeHideSpines_ch6();
                        break;
                    case 'case-study-1':
                        initializeCaseStudy1_ch6();
                        break;
                    case 'case-study-2':
                        initializeCaseStudy2_ch6();
                        break;
                    case 'case-study-3':
                        initializeCaseStudy3_ch6();
                        break;
                }
            }, 100);
        }

        function initializeAxisOverview_ch6() {
            // åŸºç¡€åæ ‡è½´ç»“æ„
            const basicAxisData = [{
                x: [0, 1, 2, 3, 4, 5],
                y: [1, 4, 2, 3, 5, 2],
                type: 'scatter',
                mode: 'lines+markers',
                name: 'æ•°æ®çº¿'
            }];
            
            const basicAxisLayout = {
                title: 'åŸºç¡€åæ ‡è½´ç»“æ„',
                xaxis: {title: 'Xè½´æ ‡ç­¾'},
                yaxis: {title: 'Yè½´æ ‡ç­¾'}
            };
            
            Plotly.newPlot('ch6-basic-axis', basicAxisData, basicAxisLayout, {responsive: true});

            // è½´è„Šç»„ä»¶æ ‡è¯†
            const spineData = [{
                x: [0, 10],
                y: [0, 10],
                type: 'scatter',
                mode: 'markers',
                name: 'æ•°æ®ç‚¹'
            }];
            
            const spineLayout = {
                title: 'å››æ¡è½´è„Šæ ‡è¯†',
                xaxis: {title: 'Xè½´'},
                yaxis: {title: 'Yè½´'},
                shapes: [
                    {type: 'line', xref: 'paper', yref: 'paper', x0: 0, y0: 0, x1: 1, y1: 0, line: {color: '#2c3e50', width: 4}},
                    {type: 'line', xref: 'paper', yref: 'paper', x0: 0, y0: 1, x1: 1, y1: 1, line: {color: '#e74c3c', width: 4}},
                    {type: 'line', xref: 'paper', yref: 'paper', x0: 0, y0: 0, x1: 0, y1: 1, line: {color: '#27ae60', width: 4}},
                    {type: 'line', xref: 'paper', yref: 'paper', x0: 1, y0: 0, x1: 1, y1: 1, line: {color: '#f39c12', width: 4}}
                ]
            };
            
            Plotly.newPlot('ch6-spine-chart', spineData, spineLayout, {responsive: true});
        }

        function initializeCustomTicks_ch6() {
            // æ—¶é—´åˆ»åº¦æ ¼å¼åŒ–
            const hours = ['00:00', '02:00', '04:00', '06:00', '08:00', '10:00', '12:00', '14:00', '16:00', '18:00', '20:00', '22:00'];
            const temperature = [18, 17, 16, 15, 16, 20, 25, 28, 26, 22, 20, 19];
            
            const timeData = [{
                x: hours,
                y: temperature,
                type: 'scatter',
                mode: 'lines+markers',
                name: 'æ¸©åº¦å˜åŒ–'
            }];
            
            const timeLayout = {
                title: '24å°æ—¶æ¸©åº¦å˜åŒ– - æ—¶é—´åˆ»åº¦æ ¼å¼åŒ–',
                xaxis: {title: 'æ—¶é—´ (HH:MM)', tickangle: -45},
                yaxis: {title: 'æ¸©åº¦ (Â°C)'}
            };
            
            Plotly.newPlot('ch6-time-tick', timeData, timeLayout, {responsive: true});

            // åˆ»åº¦æ ·å¼å®šåˆ¶
            const styleData = [{
                x: [1, 2, 3, 4, 5],
                y: [2, 3, 4, 3, 2],
                type: 'scatter',
                mode: 'lines+markers',
                name: 'è‡ªå®šä¹‰åˆ»åº¦æ ·å¼'
            }];
            
            const styleLayout = {
                title: 'åˆ»åº¦æ ·å¼è‡ªå®šä¹‰',
                xaxis: {
                    title: 'Xè½´ - è‡ªå®šä¹‰åˆ»åº¦',
                    tickcolor: '#e74c3c',
                    tickwidth: 3,
                    ticklen: 10,
                    tickangle: 45
                },
                yaxis: {
                    title: 'Yè½´ - è‡ªå®šä¹‰åˆ»åº¦',
                    tickcolor: '#27ae60',
                    tickwidth: 3,
                    ticklen: 10
                }
            };
            
            Plotly.newPlot('ch6-tick-style', styleData, styleLayout, {responsive: true});
        }

        function initializeHideSpines_ch6() {
            // éšè—å…¨éƒ¨è½´è„Š
            const hideAllData = [{
                x: [0.5],
                y: [0.5],
                type: 'scatter',
                mode: 'markers',
                marker: {size: 50, color: '#e74c3c', symbol: 'hexagon'}
            }];
            
            const hideAllLayout = {
                title: 'éšè—å…¨éƒ¨è½´è„Šç¤ºä¾‹',
                xaxis: {showgrid: false, zeroline: false, showticklabels: false, showline: false, ticks: ''},
                yaxis: {showgrid: false, zeroline: false, showticklabels: false, showline: false, ticks: ''}
            };
            
            Plotly.newPlot('ch6-hide-all', hideAllData, hideAllLayout, {responsive: true});

            // éƒ¨åˆ†è½´è„Šéšè—
            const hidePartData = [{
                x: [1, 2, 3, 4, 5],
                y: [3, 2, 4, 3, 5],
                type: 'scatter',
                mode: 'lines+markers',
                name: 'æ•°æ®çº¿'
            }];
            
            const hidePartLayout = {
                title: 'éƒ¨åˆ†è½´è„Šéšè—ç¤ºä¾‹',
                xaxis: {title: 'Xè½´', showgrid: true, zeroline: false, showline: false},
                yaxis: {title: 'Yè½´', showgrid: true, zeroline: false, showline: true, linecolor: '#e74c3c', linewidth: 3}
            };
            
            Plotly.newPlot('ch6-hide-part', hidePartData, hidePartLayout, {responsive: true});
        }

        function initializeCaseStudy1_ch6() {
            const windHours = ['00:00', '02:00', '04:00', '06:00', '08:00', '10:00', '12:00', '14:00', '16:00', '18:00', '20:00', '22:00', '24:00'];
            const windSpeed = [7, 9, 11, 14, 8, 15, 22, 11, 10, 11, 11, 13, 8];
            
            const windData = [{
                x: windHours,
                y: windSpeed,
                type: 'scatter',
                mode: 'lines+markers',
                name: 'å¹³å‡é£é€Ÿ'
            }];
            
            const windLayout = {
                title: 'æ·±åœ³å¸‚24å°æ—¶çš„å¹³å‡é£é€Ÿ',
                xaxis: {title: 'æ—¶é—´', tickangle: -45},
                yaxis: {title: 'å¹³å‡é£é€Ÿ (km/h)', range: [0, 25]}
            };
            
            Plotly.newPlot('ch6-shenzhen-wind', windData, windLayout, {responsive: true});
        }

        function initializeCaseStudy2_ch6() {
            const windHours = ['00:00', '02:00', '04:00', '06:00', '08:00', '10:00', '12:00', '14:00', '16:00', '18:00', '20:00', '22:00', '24:00'];
            const windSpeed = [7, 9, 11, 14, 8, 15, 22, 11, 10, 11, 11, 13, 8];
            
            const windData2 = [{
                x: windHours,
                y: windSpeed,
                type: 'scatter',
                mode: 'lines+markers',
                name: 'å¹³å‡é£é€Ÿ'
            }];
            
            const windLayout2 = {
                title: 'æ·±åœ³å¸‚24å°æ—¶çš„å¹³å‡é£é€Ÿï¼ˆéšè—éƒ¨åˆ†è½´è„Šï¼‰',
                xaxis: {title: 'æ—¶é—´ï¼ˆhï¼‰', tickangle: -45, mirror: false},
                yaxis: {title: 'å¹³å‡é£é€Ÿ(km/h)', range: [0, 25], mirror: false}
            };
            
            Plotly.newPlot('ch6-shenzhen-wind2', windData2, windLayout2, {responsive: true});
        }

        function initializeCaseStudy3_ch6() {
            const xValues = [];
            const sineValues = [];
            const cosineValues = [];
            
            for (let i = 0; i <= 360; i += 2) {
                const radians = i * Math.PI / 180;
                xValues.push(radians);
                sineValues.push(Math.sin(radians));
                cosineValues.push(Math.cos(radians));
            }
            
            const sineCosineData = [
                {x: xValues, y: sineValues, type: 'scatter', mode: 'lines', name: 'sin(x)'},
                {x: xValues, y: cosineValues, type: 'scatter', mode: 'lines', name: 'cos(x)'}
            ];
            
            const sineCosineLayout = {
                title: 'æ­£å¼¦å’Œä½™å¼¦å‡½æ•°å¯¹æ¯” (0-2Ï€)',
                xaxis: {
                    title: 'x (å¼§åº¦)',
                    tickmode: 'array',
                    tickvals: [0, Math.PI/2, Math.PI, 3*Math.PI/2, 2*Math.PI],
                    ticktext: ['0', 'Ï€/2', 'Ï€', '3Ï€/2', '2Ï€']
                },
                yaxis: {title: 'å‡½æ•°å€¼', range: [-1.2, 1.2]}
            };
            
            Plotly.newPlot('ch6-sine-cosine', sineCosineData, sineCosineLayout, {responsive: true});
        }

        // ==================== ç¬¬ä¸ƒç« ï¼š3Då¯è§†åŒ– ====================
        function initChapter7() {
            createChart1_ch7();
            createChart2_ch7();
            createChart3_ch7();
        }

        // å®ä¾‹1ï¼š3Dæ•£ç‚¹å›¾æ˜Ÿæ˜Ÿ
        function createChart1_ch7() {
            try {
                const n = 30;
                const x = Array.from({length: n}, () => Math.floor(Math.random() * 40));
                const y = Array.from({length: n}, () => Math.floor(Math.random() * 40));
                const z = Array.from({length: n}, () => Math.floor(Math.random() * 40));
                
                const colors = z.map(z_val => {
                    if (z_val <= 10) return '#FFD700';
                    else if (z_val < 20) return '#C71585';
                    else return '#008B8B';
                });

                const traces = [];
                
                for (let i = 0; i < n; i++) {
                    const cx = x[i], cy = y[i], cz = z[i];
                    const color = colors[i];
                    const size = 1.8;
                    
                    let starPointsX = [], starPointsY = [], starPointsZ = [];
                    
                    for (let j = 0; j < 10; j++) {
                        let angle, radius;
                        if (j % 2 === 0) {
                            angle = (j * 36 - 90) * Math.PI / 180;
                            radius = size;
                        } else {
                            angle = (j * 36 - 90) * Math.PI / 180;
                            radius = size * 0.4;
                        }
                        
                        starPointsX.push(cx + radius * Math.cos(angle));
                        starPointsY.push(cy);
                        starPointsZ.push(cz + radius * Math.sin(angle));
                    }
                    
                    starPointsX.push(starPointsX[0]);
                    starPointsY.push(starPointsY[0]);
                    starPointsZ.push(starPointsZ[0]);
                    
                    const trace = {
                        x: starPointsX,
                        y: starPointsY,
                        z: starPointsZ,
                        mode: 'lines',
                        type: 'scatter3d',
                        line: {color: color, width: 4},
                        hoverinfo: 'none',
                        showlegend: false
                    };
                    
                    traces.push(trace);
                }

                const centerTrace = {
                    x: x,
                    y: y,
                    z: z,
                    mode: 'markers',
                    type: 'scatter3d',
                    marker: {
                        size: 3,
                        color: colors,
                        symbol: 'circle',
                        opacity: 0
                    },
                    text: z.map((z_val, i) => `æ˜Ÿ${i+1}<br>x: ${x[i]}<br>y: ${y[i]}<br>z: ${z_val}`),
                    hovertemplate: '%{text}<extra></extra>',
                    showlegend: false
                };
                
                traces.push(centerTrace);

                const layout = {
                    title: {text: '3Dæ•£ç‚¹å›¾ - æ˜Ÿæ˜Ÿåˆ†å¸ƒ', font: {size: 16}},
                    scene: {
                        xaxis: {title: 'xè½´', range: [0, 40]},
                        yaxis: {title: 'yè½´', range: [0, 40]},
                        zaxis: {title: 'zè½´', range: [0, 40]},
                        camera: {eye: {x: 1.5, y: 1.5, z: 1.5}}
                    },
                    margin: {l: 0, r: 0, t: 40, b: 0}
                };

                Plotly.newPlot('ch7-chart1', traces, layout, {responsive: true});
            } catch (error) {
                console.error('åˆ›å»ºå›¾è¡¨1å¤±è´¥:', error);
            }
        }

        // å®ä¾‹2ï¼šé—ªçƒçš„3Dæ˜Ÿæ˜Ÿ
        function createChart2_ch7() {
            try {
                const xx = [13, 5, 25, 13, 9, 19, 3, 39, 13, 27];
                const yy = [4, 38, 16, 26, 7, 19, 28, 10, 17, 18];
                const zz = [7, 19, 6, 12, 25, 19, 23, 25, 10, 15];

                let frame = 0;
                
                function updateChart() {
                    const color = frame % 2 === 0 ? '#C71585' : '#FFFFFF';
                    
                    const traces = [];
                    
                    for (let i = 0; i < xx.length; i++) {
                        const cx = xx[i], cy = yy[i], cz = zz[i];
                        const size = 2.5;
                        
                        let starPointsX = [], starPointsY = [], starPointsZ = [];
                        
                        for (let j = 0; j < 10; j++) {
                            let angle, radius;
                            if (j % 2 === 0) {
                                angle = (j * 36 - 90) * Math.PI / 180;
                                radius = size;
                            } else {
                                angle = (j * 36 - 90) * Math.PI / 180;
                                radius = size * 0.4;
                            }
                            
                            starPointsX.push(cx + radius * Math.cos(angle));
                            starPointsY.push(cy);
                            starPointsZ.push(cz + radius * Math.sin(angle));
                        }
                        
                        starPointsX.push(starPointsX[0]);
                        starPointsY.push(starPointsY[0]);
                        starPointsZ.push(starPointsZ[0]);
                        
                        const trace = {
                            x: starPointsX,
                            y: starPointsY,
                            z: starPointsZ,
                            mode: 'lines',
                            type: 'scatter3d',
                            line: {color: color, width: 5},
                            hoverinfo: 'none',
                            showlegend: false
                        };
                        
                        traces.push(trace);
                    }

                    const centerTrace = {
                        x: xx,
                        y: yy,
                        z: zz,
                        mode: 'markers',
                        type: 'scatter3d',
                        marker: {
                            size: 3,
                            color: color,
                            symbol: 'circle',
                            opacity: 0
                        },
                        text: xx.map((x_val, i) => `é—ªçƒæ˜Ÿ${i+1}<br>x: ${x_val}<br>y: ${yy[i]}<br>z: ${zz[i]}`),
                        hovertemplate: '%{text}<extra></extra>',
                        showlegend: false
                    };
                    
                    traces.push(centerTrace);

                    const layout = {
                        title: {text: '3Dæ•£ç‚¹å›¾ - é—ªçƒçš„æ˜Ÿæ˜Ÿ', font: {size: 16}},
                        scene: {
                            xaxis: {title: 'xè½´', range: [0, 40]},
                            yaxis: {title: 'yè½´', range: [0, 40]},
                            zaxis: {title: 'zè½´', range: [0, 40]},
                            camera: {eye: {x: 1.5, y: 1.5, z: 1.5}}
                        },
                        margin: {l: 0, r: 0, t: 40, b: 0}
                    };

                    Plotly.react('ch7-chart2', traces, layout, {responsive: true});
                    frame++;
                }

                updateChart();
                
                if (isAnimating_ch7) {
                    animationFrame_ch7 = setInterval(updateChart, 1000);
                }

            } catch (error) {
                console.error('åˆ›å»ºå›¾è¡¨2å¤±è´¥:', error);
            }
        }

        // å®ä¾‹3ï¼šç¾å›½äººå£åˆ†å¸ƒåœ°å›¾
        function createChart3_ch7() {
            try {
                const cities = [
                    {name: 'New York', lat: 40.7128, lon: -74.0060, pop: 8419000},
                    {name: 'Los Angeles', lat: 34.0522, lon: -118.2437, pop: 3980000},
                    {name: 'Chicago', lat: 41.8781, lon: -87.6298, pop: 2716000},
                    {name: 'Houston', lat: 29.7604, lon: -95.3698, pop: 2320000},
                    {name: 'Phoenix', lat: 33.4484, lon: -112.0740, pop: 1680000},
                    {name: 'Philadelphia', lat: 39.9526, lon: -75.1652, pop: 1584000},
                    {name: 'San Antonio', lat: 29.4241, lon: -98.4936, pop: 1547000},
                    {name: 'San Diego', lat: 32.7157, lon: -117.1611, pop: 1424000},
                    {name: 'Dallas', lat: 32.7767, lon: -96.7970, pop: 1343000},
                    {name: 'San Jose', lat: 37.3382, lon: -121.8863, pop: 1022000}
                ];

                const maxPop = Math.max(...cities.map(c => c.pop));
                const sizes = cities.map(c => (c.pop / maxPop) * 50);

                const trace = {
                    type: 'scattergeo',
                    locationmode: 'USA-states',
                    lat: cities.map(c => c.lat),
                    lon: cities.map(c => c.lon),
                    text: cities.map(c => `${c.name}<br>äººå£: ${c.pop.toLocaleString()}`),
                    marker: {
                        size: sizes,
                        color: sizes,
                        colorscale: 'Blues',
                        colorbar: {title: 'äººå£æ•°é‡', titleside: 'right', ticksuffix: 'ä¸‡'},
                        line: {color: 'black', width: 0.5}
                    },
                    hovertemplate: '%{text}<extra></extra>'
                };

                const layout = {
                    title: {text: '2014å¹´ç¾å›½éƒ¨åˆ†åŸé•‡çš„äººå£åˆ†å¸ƒæƒ…å†µ', font: {size: 16}},
                    geo: {
                        scope: 'usa',
                        projection: {type: 'albers usa'},
                        showland: true,
                        landcolor: '#EAEAEA',
                        showlakes: true,
                        lakecolor: '#B3E5FC'
                    },
                    margin: {l: 0, r: 0, t: 40, b: 0}
                };

                Plotly.newPlot('ch7-chart3', [trace], layout, {responsive: true});
            } catch (error) {
                console.error('åˆ›å»ºå›¾è¡¨3å¤±è´¥:', error);
            }
        }

        function refreshAllCharts_ch7() {
            if (animationFrame_ch7) {
                clearInterval(animationFrame_ch7);
                animationFrame_ch7 = null;
            }
            
            createChart1_ch7();
            createChart2_ch7();
            createChart3_ch7();
        }

        function toggleAnimation_ch7() {
            isAnimating_ch7 = !isAnimating_ch7;
            if (isAnimating_ch7) {
                createChart2_ch7();
            } else {
                if (animationFrame_ch7) {
                    clearInterval(animationFrame_ch7);
                    animationFrame_ch7 = null;
                }
            }
        }

        function resetView_ch7() {
            const charts = ['ch7-chart1', 'ch7-chart2', 'ch7-chart3'];
            charts.forEach(chartId => {
                try {
                    Plotly.relayout(chartId, {
                        'scene.camera': {eye: {x: 1.5, y: 1.5, z: 1.5}}
                    });
                } catch (error) {
                    console.warn('é‡ç½®è§†å›¾å¤±è´¥:', chartId, error);
                }
            });
        }

        // ==================== ç¬¬å…«ç« ï¼šé«˜çº§æ•°æ®å¯è§†åŒ–æŠ€æœ¯ ====================
        function initChapter8() {
            createContourChart_ch8();
        }

        function showChart_ch8(index) {
            // éšè—æ‰€æœ‰å›¾è¡¨
            document.querySelectorAll('#chapter8 .chart-container').forEach(chart => {
                chart.style.display = 'none';
            });
            
            // æ˜¾ç¤ºæŒ‡å®šå›¾è¡¨
            const targetChart = document.getElementById(`ch8-chart-${index}`);
            if (targetChart) {
                targetChart.style.display = 'block';
            }
            
            // æ›´æ–°è®¡æ•°å™¨
            document.getElementById('ch8-counter').textContent = `${index + 1} / 10`;
            
            // æ›´æ–°ç‚¹çŠ¶æ€
            document.querySelectorAll('.ch8-dot').forEach((dot, i) => {
                dot.classList.toggle('active', i === index);
            });
            
            // æ›´æ–°æŒ‰é’®çŠ¶æ€
            document.getElementById('ch8-prev').disabled = index === 0;
            document.getElementById('ch8-next').disabled = index === 9;
            
            currentChartIndex_ch8 = index;
            
            // åˆ›å»ºå¯¹åº”çš„å›¾è¡¨
            setTimeout(() => {
                switch(index) {
                    case 0: createContourChart_ch8(); break;
                    case 1: createStreamPlot_ch8(); break;
                    case 2: createStemChart_ch8(); break;
                    case 3: createDumbbellChart_ch8(); break;
                    case 4: createGanttChart_ch8(); break;
                    case 5: createPyramidChart_ch8(); break;
                    case 6: createFunnelChart_ch8(); break;
                    case 7: createSankeyChart_ch8(); break;
                    case 8: createTreeChart_ch8(); break;
                    case 9: createWaffleChart_ch8(); break;
                }
            }, 100);
        }

        function showPrevChart_ch8() {
            if (currentChartIndex_ch8 > 0) {
                showChart_ch8(currentChartIndex_ch8 - 1);
            }
        }

        function showNextChart_ch8() {
            if (currentChartIndex_ch8 < 9) {
                showChart_ch8(currentChartIndex_ch8 + 1);
            }
        }

        function jumpToChart_ch8(index) {
            showChart_ch8(index);
        }

        // ç¬¬å…«ç« å›¾è¡¨åˆ›å»ºå‡½æ•°
        function createContourChart_ch8() {
            // ç­‰é«˜çº¿å›¾å·²åœ¨HTMLä¸­å®šä¹‰
        }

        function createStreamplotChart_ch8() {
            // çŸ¢é‡åœºæµçº¿å›¾å·²åœ¨HTMLä¸­å®šä¹‰  
        }

        function createStemChart_ch8() {
            // æ£‰æ£’å›¾å·²åœ¨HTMLä¸­å®šä¹‰
        }

        function createDumbbellChart_ch8() {
            // å“‘é“ƒå›¾å·²åœ¨HTMLä¸­å®šä¹‰
        }

        function createFunnelChart_ch8() {
            // æ¼æ–—å›¾å·²åœ¨HTMLä¸­å®šä¹‰
        }

        function createSankeyChart_ch8() {
            createSankey_ch8(); // ä½¿ç”¨å·²å®šä¹‰çš„å‡½æ•°
        }

        function createGanttChart_ch8() {
            createGantt_ch8(); // ä½¿ç”¨å·²å®šä¹‰çš„å‡½æ•°
        }

        function createHeatmapChart_ch8() {
            createHeatmap_ch8(); // ä½¿ç”¨å·²å®šä¹‰çš„å‡½æ•°
        }

        function createTreeChart_ch8() {
            // å±‚æ¬¡ç»“æ„æ ‘çŠ¶å›¾å·²åœ¨HTMLä¸­å®šä¹‰ï¼Œæˆ–ä½¿ç”¨createTree_ch8å‡½æ•°
            if (typeof createTree_ch8 === 'function') {
                createTree_ch8();
            }
        }

        function createWaffleChart_ch8() {
            // åå¤«é¥¼å›¾å·²åœ¨HTMLä¸­å®šä¹‰ï¼Œæˆ–ä½¿ç”¨createWaffleChart_ch8å‡½æ•°
            // è¿™ä¸ªå‡½æ•°åœ¨æ–‡ä»¶åé¢å·²ç»å®šä¹‰äº†
        }

        // åˆ›å»ºç­‰é«˜çº¿å›¾
        function createContourChart_ch8() {
            const n = 50;
            const x = [];
            const y = [];
            
            for (let i = 0; i < n; i++) {
                x.push(-2 + i * 4 / n);
                y.push(-2 + i * 4 / n);
            }
            
            const z = [];
            for (let i = 0; i < n; i++) {
                const row = [];
                for (let j = 0; j < n; j++) {
                    const x_val = x[j];
                    const y_val = y[i];
                    const h = (1 - x_val/2 + Math.pow(x_val, 5) + Math.pow(y_val, 3)) * 
                              Math.exp(-Math.pow(x_val, 2) - Math.pow(y_val, 2));
                    row.push(h);
                }
                z.push(row);
            }
            
            const data = [{
                x: x,
                y: y,
                z: z,
                type: 'contour',
                colorscale: 'Earth'
            }];
            
            const layout = {
                title: 'ä¸‰ç»´å‡½æ•°çš„ç­‰é«˜çº¿å›¾',
                xaxis: {title: 'Xè½´'},
                yaxis: {title: 'Yè½´'},
                margin: {t: 40, r: 20, b: 40, l: 40}
            };
            
            Plotly.newPlot('ch8-contour', data, layout, {responsive: true});
        }

        // åˆ›å»ºçŸ¢é‡åœºæµçº¿å›¾
        function createStreamPlot_ch8() {
            const n = 15;
            const arrowData = [];
            
            for (let i = 0; i < n; i++) {
                for (let j = 0; j < n; j++) {
                    const x_val = -3 + j * 6 / n;
                    const y_val = -3 + i * 6 / n;
                    
                    const u = -y_val;
                    const v = x_val;
                    
                    const scale = 0.15;
                    const x_end = x_val + u * scale;
                    const y_end = y_val + v * scale;
                    
                    arrowData.push({
                        type: 'scatter',
                        x: [x_val, x_end],
                        y: [y_val, y_end],
                        mode: 'lines',
                        line: {color: 'blue', width: 2},
                        showlegend: false
                    });
                }
            }
            
            const layout = {
                title: 'çŸ¢é‡åœºæµçº¿å›¾',
                xaxis: {title: 'Xè½´', range: [-3, 3]},
                yaxis: {title: 'Yè½´', range: [-3, 3]},
                margin: {t: 40, r: 20, b: 40, l: 40}
            };
            
            Plotly.newPlot('ch8-streamplot', arrowData, layout, {responsive: true});
        }

        // åˆ›å»ºæ£‰æ£’å›¾
        function createStemChart_ch8() {
            const brands = ['å®éª310', 'å®é©¬i3', 'è‡´äº«', 'ç„•é©°', 'åŠ›å¸†530', 'æ´¾åŠ›å¥¥', 'æ‚¦ç¿”V3', 'ä¹é£RV', 'å¥¥è¿ªA1', 'å¨é©°FS', 'å¤åˆ©N7', 'å¯è¾°R30', 'å’Œæ‚¦A13RS', 'è‡´ç‚«', 'èµ›æ¬§'];
            const consumption = [5.9, 6.2, 6.7, 7.0, 7.0, 7.1, 7.2, 7.4, 7.5, 7.6, 7.7, 7.7, 7.7, 7.8, 7.9];
            
            const stemLines = [];
            for (let i = 0; i < brands.length; i++) {
                stemLines.push({
                    type: 'scatter',
                    mode: 'lines',
                    x: [i, i],
                    y: [0, consumption[i]],
                    line: {color: 'blue', width: 2},
                    showlegend: false,
                    hoverinfo: 'none'
                });
            }
            
            const markers = {
                x: Array.from({length: brands.length}, (_, i) => i),
                y: consumption,
                type: 'scatter',
                mode: 'markers',
                marker: {color: 'red', size: 8, symbol: 'circle'},
                text: brands.map((brand, i) => `${brand}: ${consumption[i]} L/km`),
                hoverinfo: 'text',
                name: 'ç‡ƒæ–™æ¶ˆè€—é‡'
            };
            
            const baseline = {
                type: 'scatter',
                mode: 'lines',
                x: [-0.5, brands.length - 0.5],
                y: [0, 0],
                line: {color: 'black', width: 1},
                showlegend: false,
                hoverinfo: 'none'
            };
            
            const layout = {
                title: 'ä¸åŒå“ç‰Œè½¿è½¦çš„ç‡ƒæ–™æ¶ˆè€—é‡',
                xaxis: { 
                    title: 'æ±½è½¦å“ç‰Œ',
                    tickmode: 'array',
                    tickvals: Array.from({length: brands.length}, (_, i) => i),
                    ticktext: brands,
                    tickangle: 60
                },
                yaxis: {title: 'ç‡ƒæ–™æ¶ˆè€—é‡(L/km)', range: [0, 10]},
                margin: {t: 40, r: 20, b: 100, l: 60}
            };
            
            Plotly.newPlot('ch8-stem', [baseline, ...stemLines, markers], layout, {responsive: true});
        }

        // åˆ›å»ºå“‘é“ƒå›¾
        function createDumbbellChart_ch8() {
            const cities = ['çº½çº¦', 'æ´›æ‰çŸ¶', 'èŠåŠ å“¥', 'ä¼‘æ–¯é¡¿', 'è´¹åŸ', 'å‡¤å‡°åŸ', 'åœ£åœ°äºšå“¥', 'è¾¾æ‹‰æ–¯'];
            const pct_2013 = [2.3, 1.8, 3.1, 2.7, 1.9, 2.4, 2.8, 2.2];
            const pct_2014 = [3.1, 2.5, 2.8, 3.4, 2.8, 3.2, 3.5, 2.9];
            
            const trace2013 = {
                x: pct_2013,
                y: cities,
                type: 'scatter',
                mode: 'markers',
                name: '2013å¹´',
                marker: {color: 'blue', size: 10}
            };
            
            const trace2014 = {
                x: pct_2014,
                y: cities,
                type: 'scatter',
                mode: 'markers',
                name: '2014å¹´',
                marker: {color: 'red', size: 10}
            };
            
            const lines = [];
            for (let i = 0; i < cities.length; i++) {
                lines.push({
                    x: [pct_2013[i], pct_2014[i]],
                    y: [cities[i], cities[i]],
                    type: 'scatter',
                    mode: 'lines',
                    line: {color: 'gray', width: 2},
                    showlegend: false
                });
            }
            
            const layout = {
                title: '2013å¹´ä¸2014å¹´åŸå¸‚äººå£PCTæŒ‡æ ‡å˜åŒ–',
                xaxis: {title: 'å˜åŒ–ç‡ (%)'},
                yaxis: {title: 'åŸå¸‚'},
                margin: {t: 40, r: 20, b: 40, l: 80}
            };
            
            Plotly.newPlot('ch8-dumbbell', [trace2013, trace2014, ...lines], layout, {responsive: true});
        }

        // åˆ›å»ºç”˜ç‰¹å›¾
        function createGanttChart_ch8() {
            const tasks = ['éœ€æ±‚åˆ†æ', 'ç³»ç»Ÿè®¾è®¡', 'å‰ç«¯å¼€å‘', 'åç«¯å¼€å‘', 'æ•°æ®åº“è®¾è®¡', 'æµ‹è¯•', 'éƒ¨ç½²ä¸Šçº¿'];
            const startDates = [0, 2, 4, 4, 3, 7, 9];
            const durations = [2, 2, 3, 4, 2, 2, 1];
            
            const trace = {
                x: startDates,
                y: tasks,
                width: durations,
                type: 'bar',
                orientation: 'h',
                marker: {
                    color: 'rgba(65, 105, 225, 0.8)',
                    line: {color: 'rgba(65, 105, 225, 1)', width: 1}
                },
                text: durations.map(d => d + 'å‘¨'),
                textposition: 'inside',
                textfont: {color: 'white', size: 12}
            };
            
            const layout = {
                title: 'é¡¹ç›®ä»»åŠ¡ç”˜ç‰¹å›¾',
                xaxis: {title: 'å¼€å§‹æ—¶é—´ (å‘¨)', range: [-1, 11]},
                yaxis: {title: 'ä»»åŠ¡åç§°', autorange: 'reversed'},
                margin: {t: 40, r: 20, b: 60, l: 80}
            };
            
            Plotly.newPlot('ch8-gantt', [trace], layout, {responsive: true});
        }

        // åˆ›å»ºäººå£é‡‘å­—å¡”å›¾
        function createPyramidChart_ch8() {
            const ageGroups = ['0-9', '10-19', '20-29', '30-39', '40-49', '50-59', '60-69', '70+'];
            const male = [-120000, -95000, -85000, -75000, -68000, -55000, -40000, -25000];
            const female = [110000, 90000, 80000, 72000, 65000, 52000, 38000, 20000];
            
            const maleTrace = {
                y: ageGroups,
                x: male,
                type: 'bar',
                name: 'ç”·',
                orientation: 'h',
                marker: {color: 'lightblue'}
            };
            
            const femaleTrace = {
                y: ageGroups,
                x: female,
                type: 'bar',
                name: 'å¥³',
                orientation: 'h',
                marker: {color: 'lightpink'}
            };
            
            const layout = {
                title: 'äººå£é‡‘å­—å¡”å›¾',
                xaxis: {title: 'äººæ•°'},
                yaxis: {title: 'å¹´é¾„æ®µ'},
                margin: {t: 40, r: 20, b: 40, l: 40},
                barmode: 'overlay'
            };
            
            Plotly.newPlot('ch8-pyramid', [maleTrace, femaleTrace], layout, {responsive: true});
        }

        // åˆ›å»ºæ¼æ–—å›¾
        function createFunnelChart_ch8() {
            const stages = ['è®¿é—®å•†å“', 'åŠ è´­ç‰©è½¦', 'ç”Ÿæˆè®¢å•', 'æ”¯ä»˜è®¢å•', 'å®Œæˆäº¤æ˜“'];
            const x1 = [1000, 500, 300, 200, 150];
            const x2 = x1.map(x => (Math.max(...x1) - x) / 2);
            const x3 = x1.map((x, i) => x + x2[i]);
            
            const trace1 = {
                x: x3,
                y: stages,
                type: 'bar',
                orientation: 'h',
                marker: {color: 'green', opacity: 0.5},
                name: 'æ€»é‡',
                hoverinfo: 'skip'
            };
            
            const trace2 = {
                x: x2,
                y: stages,
                type: 'bar',
                orientation: 'h',
                marker: {color: 'white', opacity: 1.0, line: {color: 'black', width: 0.5}},
                name: 'è¾…åŠ©',
                hoverinfo: 'skip'
            };
            
            const percentages = x1.map(x => ((x / x1[0]) * 100).toFixed(2) + '%');
            const trace5 = {
                x: x2.map((x, i) => x + (x3[i] - x2[i]) / 2),
                y: stages,
                type: 'scatter',
                mode: 'text',
                text: percentages,
                textfont: {size: 14, color: 'black'},
                showlegend: false,
                hoverinfo: 'skip'
            };
            
            const layout = {
                title: 'ç”¨æˆ·è½¬åŒ–æ¼æ–—å›¾',
                xaxis: {title: 'å®¢æˆ·æ•°é‡', showticklabels: false},
                yaxis: {title: '', tickmode: 'array', tickvals: stages, ticktext: stages},
                showlegend: false,
                margin: {t: 50, r: 80, b: 40, l: 80},
                barmode: 'overlay'
            };
            
            Plotly.newPlot('ch8-funnel', [trace1, trace2, trace5], layout, {responsive: true});
        }

        // åˆ›å»ºæ¡‘åŸºå›¾
        function createSankeyChart_ch8() {
            const data = {
                type: "sankey",
                arrangement: "snap",
                node: {
                    pad: 15,
                    thickness: 30,
                    line: {color: "black", width: 0.5},
                    label: ["å·¥èµ„", "å‰¯ä¸š", "ç”Ÿæ´»", "è´­ç‰©", "æ·±é€ ", "è¿åŠ¨", "å…¶ä»–", "ä¹°ä¹¦"],
                    color: ["lightgreen", "lightgreen", "lightcoral", "lightcoral", "lightcoral", "lightcoral", "lightcoral", "lightcoral"]
                },
                link: {
                    source: [0, 0, 0, 0, 0, 1, 1],
                    target: [2, 3, 4, 5, 6, 2, 7],
                    value: [0.3, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1],
                    color: "rgba(144, 238, 144, 0.5)"
                }
            };
            
            const layout = {
                title: "æ—¥å¸¸ç”Ÿæ´»å¼€æ”¯çš„æ¡‘åŸºå›¾",
                font: {size: 12, family: "Arial, sans-serif"},
                margin: {t: 50, r: 30, b: 30, l: 30}
            };
            
            Plotly.newPlot('ch8-sankey', [data], layout, {responsive: true});
        }

        // åˆ›å»ºæ ‘çŠ¶å›¾
        function createTreeChart_ch8() {
            const nodes = [
                {x: 0, y: 0, text: "æ ¹èŠ‚ç‚¹", size: 20},
                {x: -2, y: 1, text: "åˆ†æ”¯A", size: 15},
                {x: 2, y: 1, text: "åˆ†æ”¯B", size: 15},
                {x: -3, y: 2, text: "å¶å­A1", size: 10},
                {x: -1, y: 2, text: "å¶å­A2", size: 10},
                {x: 1, y: 2, text: "å¶å­B1", size: 10},
                {x: 3, y: 2, text: "å¶å­B2", size: 10}
            ];
            
            const connections = [
                {x0: 0, y0: 0, x1: -2, y1: 1},
                {x0: 0, y0: 0, x1: 2, y1: 1},
                {x0: -2, y0: 1, x1: -3, y1: 2},
                {x0: -2, y0: 1, x1: -1, y1: 2},
                {x0: 2, y0: 1, x1: 1, y1: 2},
                {x0: 2, y0: 1, x1: 3, y1: 2}
            ];
            
            const lineTraces = connections.map(conn => ({
                x: [conn.x0, conn.x1],
                y: [conn.y0, conn.y1],
                mode: 'lines',
                line: {color: 'blue', width: 2},
                showlegend: false
            }));
            
            const nodeTrace = {
                x: nodes.map(n => n.x),
                y: nodes.map(n => n.y),
                mode: 'markers+text',
                marker: {size: nodes.map(n => n.size), color: 'lightblue'},
                text: nodes.map(n => n.text),
                textposition: 'middle center'
            };
            
            const layout = {
                title: 'å±‚æ¬¡ç»“æ„æ ‘çŠ¶å›¾',
                xaxis: {showgrid: false, zeroline: false, showticklabels: false},
                yaxis: {showgrid: false, zeroline: false, showticklabels: false},
                margin: {t: 40, r: 20, b: 20, l: 20}
            };
            
            Plotly.newPlot('ch8-tree', [...lineTraces, nodeTrace], layout, {responsive: true});
        }

        // åˆ›å»ºåå¤«é¥¼å›¾
        function createWaffleChart_ch8() {
            const gridSize = 10;
            const totalCells = gridSize * gridSize;
            const percentage = 95;
            const filledCells = Math.round(totalCells * percentage / 100);
            
            const x = [];
            const y = [];
            const colors = [];
            
            for (let row = 0; row < gridSize; row++) {
                for (let col = 0; col < gridSize; col++) {
                    const cellIndex = row * gridSize + col;
                    x.push(col);
                    y.push(gridSize - row - 1);
                    
                    if (cellIndex < filledCells) {
                        colors.push('#20B2AA');
                    } else {
                        colors.push('#D3D3D3');
                    }
                }
            }
            
            const trace = {
                x: x,
                y: y,
                mode: 'markers',
                type: 'scatter',
                marker: {
                    color: colors,
                    size: 30,
                    line: {color: 'white', width: 2}
                },
                hoverinfo: 'none'
            };
            
            const layout = {
                title: 'ç”µå½±ã€Šå°‘å¹´çš„ä½ ã€‹ä¸Šåº§ç‡',
                xaxis: {title: '', range: [-0.5, gridSize - 0.5], showgrid: false, zeroline: false, showticklabels: false},
                yaxis: {title: '', range: [-0.5, gridSize - 0.5], showgrid: false, zeroline: false, showticklabels: false},
                margin: {t: 40, r: 20, b: 20, l: 20},
                showlegend: false
            };
            
            Plotly.newPlot('ch8-waffle', [trace], layout, {responsive: true});
        }

        // ==================== ç« èŠ‚åˆå§‹åŒ–å‡½æ•° ====================
        function initChapter2() {
            console.log('åˆå§‹åŒ–ç¬¬äºŒç« ...');
            if (typeof showChart_ch2 === 'function') {
                showChart_ch2(0);
            } else {
                // å¦‚æœæ²¡æœ‰showChart_ch2å‡½æ•°ï¼Œåˆ›å»ºç®€å•çš„å›¾è¡¨
                const months = ['1æœˆ', '2æœˆ', '3æœˆ', '4æœˆ', '5æœˆ', '6æœˆ'];
                const sales = [120, 135, 125, 145, 160, 155];
                
                if (typeof Plotly !== 'undefined') {
                    Plotly.newPlot('ch2-chart', [{
                        x: months,
                        y: sales,
                        type: 'scatter',
                        mode: 'lines+markers',
                        name: 'é”€å”®é¢ï¼ˆä¸‡å…ƒï¼‰'
                    }], {
                        title: 'æœˆåº¦é”€å”®è¶‹åŠ¿'
                    }, {responsive: true});
                }
            }
        }

        function initChapter3() {
            console.log('åˆå§‹åŒ–ç¬¬ä¸‰ç« ...');
            // åˆå§‹åŒ–åŸºç¡€å›¾è¡¨æ ‡ç­¾
            const basicTab = document.querySelector('.ch3-tab');
            if (basicTab) {
                if (typeof showBasicCharts_ch3 === 'function') {
                    showBasicCharts_ch3(basicTab);
                }
            }
        }

        function initChapter6() {
            console.log('åˆå§‹åŒ–ç¬¬å…­ç« ...');
            // åˆå§‹åŒ–ç¬¬ä¸€ä¸ªæ¡ˆä¾‹
            const buttons = document.querySelectorAll('.ch6-tab');
            if (buttons.length > 0) {
                if (typeof showChart_ch6 === 'function') {
                    showChart_ch6(buttons[0]);
                }
            } else {
                // å¦‚æœæ²¡æœ‰æŒ‰é’®ï¼Œç›´æ¥åˆå§‹åŒ–å›¾è¡¨
                if (typeof Plotly !== 'undefined') {
                    const hours = Array.from({length: 24}, (_, i) => i + 'æ—¶');
                    const windSpeed = Array.from({length: 24}, () => Math.random() * 8 + 2);
                    
                    Plotly.newPlot('ch6-shenzhen-wind', [{
                        x: hours,
                        y: windSpeed,
                        type: 'scatter',
                        mode: 'lines+markers'
                    }], {
                        title: 'æ·±åœ³å¸‚24å°æ—¶çš„å¹³å‡é£é€Ÿ'
                    }, {responsive: true});
                }
            }
        }

        function initChapter7() {
            console.log('åˆå§‹åŒ–ç¬¬ä¸ƒç« ...');
            if (typeof refreshAllCharts_ch7 === 'function') {
                refreshAllCharts_ch7();
            } else if (typeof Plotly !== 'undefined') {
                // åˆ›å»ºç®€å•çš„3Dæ•£ç‚¹å›¾
                const starsData = Array.from({length: 30}, () => ({
                    x: Math.floor(Math.random() * 40),
                    y: Math.floor(Math.random() * 40),
                    z: Math.floor(Math.random() * 40)
                }));
                
                const colors = starsData.map(star => 
                    star.z <= 10 ? '#FFD700' : star.z < 20 ? '#C71585' : '#00CED1'
                );
                
                Plotly.newPlot('ch7-chart1', [{
                    x: starsData.map(s => s.x),
                    y: starsData.map(s => s.y),
                    z: starsData.map(s => s.z),
                    mode: 'markers',
                    type: 'scatter3d',
                    marker: {
                        size: 8,
                        color: colors,
                        symbol: 'star'
                    }
                }], {
                    title: 'ä¸‰ç»´ç©ºé—´çš„æ˜Ÿæ˜Ÿ',
                    scene: {
                        xaxis: {title: 'Xè½´'},
                        yaxis: {title: 'Yè½´'},
                        zaxis: {title: 'Zè½´'}
                    }
                }, {responsive: true});
            }
        }

        function initChapter8() {
            console.log('åˆå§‹åŒ–ç¬¬å…«ç« ...');
            currentChartIndex_ch8 = 0;
            if (typeof showChart_ch8 === 'function') {
                showChart_ch8(currentChartIndex_ch8);
            } else {
                // åˆ›å»ºç®€å•çš„åå¤«é¥¼å›¾
                if (typeof Plotly !== 'undefined') {
                    const gridSize = 10;
                    const x = [];
                    const y = [];
                    const colors = [];
                    
                    for (let row = 0; row < gridSize; row++) {
                        for (let col = 0; col < gridSize; col++) {
                            x.push(col);
                            y.push(gridSize - row - 1);
                            colors.push(Math.random() > 0.05 ? '#20B2AA' : '#D3D3D3');
                        }
                    }
                    
                    Plotly.newPlot('ch8-waffle', [{
                        x: x,
                        y: y,
                        mode: 'markers',
                        marker: {
                            color: colors,
                            size: 30,
                            line: {color: 'white', width: 2}
                        }
                    }], {
                        title: 'ç”µå½±ä¸Šåº§ç‡'
                    }, {responsive: true});
                }
            }
        }

        // ==================== ç« èŠ‚åˆ‡æ¢åŠŸèƒ½ ====================
        function switchChapter(chapterId, tabElement) {
            // åˆ‡æ¢æ ‡ç­¾çŠ¶æ€
            document.querySelectorAll('.chapter-tab').forEach(tab => tab.classList.remove('active'));
            tabElement.classList.add('active');
            
            // åˆ‡æ¢ç« èŠ‚å†…å®¹
            document.querySelectorAll('.chapter-content').forEach(chapter => chapter.classList.remove('active'));
            document.getElementById(chapterId).classList.add('active');
            
            // åˆå§‹åŒ–å¯¹åº”ç« èŠ‚
            setTimeout(() => {
                switch(chapterId) {
                    case 'chapter2':
                        initChapter2();
                        break;
                    case 'chapter3':
                        initChapter3();
                        break;
                    case 'chapter4':
                        initChapter4();
                        break;
                    case 'chapter5':
                        initChapter5();
                        break;
                    case 'chapter6':
                        initChapter6();
                        break;
                    case 'chapter7':
                        initChapter7();
                        break;
                    case 'chapter8':
                        initChapter8();
                        break;
                }
            }, 100);
        }

        // ==================== ç¬¬å››ç« ï¼šPythoné£æ ¼å›¾è¡¨ ====================
        let bookChart_ch4 = null;
        let exchangeChart_ch4 = null;
        let salesChart_ch4 = null;
        let temperatureChart_ch4 = null;
        let snowflakeChart_ch4 = null;
        let bookChartType_ch4 = 'bar';
        let lineStyle_ch4 = 'solid';
        let markerStyle_ch4 = 'circle';

        function initChapter4() {
            // åˆå§‹åŒ–ç¬¬ä¸€ä¸ªæ ‡ç­¾é¡µ
            showTab_ch4('book', document.querySelector('.ch4-tab-button.active'));
        }

        function showTab_ch4(tabName, tabElement) {
            // åˆ‡æ¢æ ‡ç­¾çŠ¶æ€
            document.querySelectorAll('.ch4-tab-button').forEach(tab => tab.classList.remove('active'));
            tabElement.classList.add('active');
            
            // éšè—æ‰€æœ‰å†…å®¹
            document.querySelectorAll('.ch4-tab-content').forEach(content => content.classList.remove('active'));
            
            // æ˜¾ç¤ºé€‰ä¸­çš„å†…å®¹
            document.getElementById('ch4-' + tabName).classList.add('active');
            
            // åˆå§‹åŒ–å¯¹åº”çš„å›¾è¡¨
            setTimeout(() => {
                switch(tabName) {
                    case 'book':
                        initBookChart_ch4();
                        break;
                    case 'exchange':
                        initExchangeChart_ch4();
                        break;
                    case 'sales':
                        initSalesChart_ch4();
                        break;
                    case 'temperature':
                        initTemperatureChart_ch4();
                        break;
                    case 'snowflake':
                        initSnowflakeChart_ch4();
                        break;
                }
            }, 100);
        }

        function initBookChart_ch4() {
            const ctx = document.getElementById('bookChart');
            if (!ctx) return;
            
            if (bookChart_ch4) {
                bookChart_ch4.destroy();
            }
            
            const data = {
                labels: ['å°è¯´', 'ä¼ è®°', 'å†å²', 'ç§‘å­¦', 'è‰ºæœ¯', 'å“²å­¦'],
                datasets: [
                    {
                        label: 'åœ°åŒºA',
                        data: [120, 95, 80, 130, 75, 60],
                        backgroundColor: 'rgba(54, 162, 235, 0.8)',
                        borderColor: 'rgba(54, 162, 235, 1)',
                        borderWidth: 1
                    },
                    {
                        label: 'åœ°åŒºB',
                        data: [85, 110, 95, 70, 105, 80],
                        backgroundColor: 'rgba(255, 99, 132, 0.8)',
                        borderColor: 'rgba(255, 99, 132, 1)',
                        borderWidth: 1
                    }
                ]
            };
            
            bookChart_ch4 = new Chart(ctx, {
                type: bookChartType_ch4,
                data: data,
                options: {
                    responsive: true,
                    plugins: {
                        title: {
                            display: true,
                            text: 'ä¸¤ä¸ªåœ°åŒºå¯¹ä¸åŒç§ç±»å›¾ä¹¦çš„é‡‡è´­æƒ…å†µ'
                        },
                        legend: {
                            position: 'top'
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            title: {
                                display: true,
                                text: 'é‡‡è´­æ•°é‡ï¼ˆå†Œï¼‰'
                            }
                        }
                    }
                }
            });
        }

        function initExchangeChart_ch4() {
            const ctx = document.getElementById('exchangeChart');
            if (!ctx) return;
            
            if (exchangeChart_ch4) {
                exchangeChart_ch4.destroy();
            }
            
            const data = {
                labels: ['1æ—¥', '5æ—¥', '10æ—¥', '15æ—¥', '20æ—¥', '25æ—¥', '30æ—¥'],
                datasets: [
                    {
                        label: '2017å¹´7æœˆ',
                        data: [6.85, 6.82, 6.88, 6.91, 6.87, 6.83, 6.86],
                        borderColor: 'rgba(255, 159, 64, 1)',
                        backgroundColor: 'rgba(255, 159, 64, 0.2)',
                        tension: 0.1,
                        borderDash: lineStyle_ch4 === 'dashed' ? [5, 5] : []
                    },
                    {
                        label: '2019å¹´7æœˆ',
                        data: [6.87, 6.90, 6.85, 6.82, 6.88, 6.92, 6.89],
                        borderColor: 'rgba(75, 192, 192, 1)',
                        backgroundColor: 'rgba(75, 192, 192, 0.2)',
                        tension: 0.1,
                        borderDash: lineStyle_ch4 === 'dashed' ? [5, 5] : []
                    }
                ];
            };
            
            exchangeChart_ch4 = new Chart(ctx, {
                type: 'line',
                data: data,
                options: {
                    responsive: true,
                    plugins: {
                        title: {
                            display: true,
                            text: '2017å¹´7æœˆä¸2019å¹´7æœˆç¾å…ƒ/äººæ°‘å¸æ±‡ç‡èµ°åŠ¿'
                        }
                    },
                    scales: {
                        y: {
                            title: {
                                display: true,
                                text: 'æ±‡ç‡ï¼ˆäººæ°‘å¸/ç¾å…ƒï¼‰'
                            }
                        }
                    }
                }
            });
        }

        function initSalesChart_ch4() {
            const ctx = document.getElementById('salesChart');
            if (!ctx) return;
            
            if (salesChart_ch4) {
                salesChart_ch4.destroy();
            }
            
            const data = {
                labels: ['ç¬¬ä¸€å­£åº¦', 'ç¬¬äºŒå­£åº¦', 'ç¬¬ä¸‰å­£åº¦', 'ç¬¬å››å­£åº¦'],
                datasets: [
                    {
                        label: 'äº§å“A',
                        data: [15000, 18000, 22000, 25000],
                        borderColor: 'rgba(255, 99, 132, 1)',
                        backgroundColor: 'rgba(255, 99, 132, 0.2)',
                        pointStyle: markerStyle_ch4
                    },
                    {
                        label: 'äº§å“B',
                        data: [12000, 16000, 19000, 21000],
                        borderColor: 'rgba(54, 162, 235, 1)',
                        backgroundColor: 'rgba(54, 162, 235, 0.2)',
                        pointStyle: markerStyle_ch4
                    },
                    {
                        label: 'äº§å“C',
                        data: [8000, 12000, 15000, 18000],
                        borderColor: 'rgba(75, 192, 192, 1)',
                        backgroundColor: 'rgba(75, 192, 192, 0.2)',
                        pointStyle: markerStyle_ch4
                    }
                ];
            };
            
            salesChart_ch4 = new Chart(ctx, {
                type: 'line',
                data: data,
                options: {
                    responsive: true,
                    plugins: {
                        title: {
                            display: true,
                            text: 'æ ‡è®°ä¸åŒäº§å“å„å­£åº¦çš„é”€å”®é¢'
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            title: {
                                display: true,
                                text: 'é”€å”®é¢ï¼ˆå…ƒï¼‰'
                            }
                        }
                    }
                }
            });
        }

        function initTemperatureChart_ch4() {
            const ctx = document.getElementById('temperatureChart');
            if (!ctx) return;
            
            if (temperatureChart_ch4) {
                temperatureChart_ch4.destroy();
            }
            
            const labels = [];
            const highTemp = [];
            const lowTemp = [];
            
            for (let i = 1; i <= 15; i++) {
                labels.push(i + 'æ—¥');
                highTemp.push(20 + Math.random() * 15);
                lowTemp.push(10 + Math.random() * 10);
            }
            
            const data = {
                labels: labels,
                datasets: [
                    {
                        label: 'æœ€é«˜æ°”æ¸©',
                        data: highTemp,
                        borderColor: 'rgba(255, 99, 132, 1)',
                        backgroundColor: 'rgba(255, 99, 132, 0.2)',
                        fill: false
                    },
                    {
                        label: 'æœ€ä½æ°”æ¸©',
                        data: lowTemp,
                        borderColor: 'rgba(54, 162, 235, 1)',
                        backgroundColor: 'rgba(54, 162, 235, 0.2)',
                        fill: false
                    }
                ];
            };
            
            temperatureChart_ch4 = new Chart(ctx, {
                type: 'line',
                data: data,
                options: {
                    responsive: true,
                    plugins: {
                        title: {
                            display: true,
                            text: 'æœªæ¥15å¤©æœ€é«˜æ°”æ¸©å’Œæœ€ä½æ°”æ¸©çš„èµ°åŠ¿'
                        }
                    },
                    scales: {
                        y: {
                            title: {
                                display: true,
                                text: 'æ¸©åº¦ï¼ˆÂ°Cï¼‰'
                            }
                        }
                    }
                }
            });
        }

        function initSnowflakeChart_ch4() {
            const ctx = document.getElementById('snowflakeChart');
            if (!ctx) return;
            
            if (snowflakeChart_ch4) {
                snowflakeChart_ch4.destroy();
            }
            
            // ç”Ÿæˆé›ªèŠ±æ•°æ®
            const snowflakes = [];
            for (let i = 0; i < 100; i++) {
                snowflakes.push({
                    x: Math.random() * 100,
                    y: Math.random() * 100,
                    size: Math.random() * 20 + 5,
                    color: `hsl(${Math.random() * 60 + 180}, 70%, 60%)` // è“ç»¿è‰²ç³»
                });
            }
            
            const data = {
                datasets: [{
                    label: 'é›ªèŠ±',
                    data: snowflakes,
                    backgroundColor: snowflakes.map(s => s.color),
                    pointRadius: snowflakes.map(s => s.size)
                }]
            };
            
            snowflakeChart_ch4 = new Chart(ctx, {
                type: 'scatter',
                data: data,
                options: {
                    responsive: true,
                    plugins: {
                        title: {
                            display: true,
                            text: 'å½©è‰²é›ªèŠ±å›¾æ¡ˆ'
                        },
                        legend: {
                            display: false
                        }
                    },
                    scales: {
                        x: {
                            display: false
                        },
                        y: {
                            display: false
                        }
                    }
                }
            });
        }

        // æ§åˆ¶å‡½æ•°
        function generateBookData_ch4() {
            initBookChart_ch4();
        }

        function toggleBookType_ch4() {
            bookChartType_ch4 = bookChartType_ch4 === 'bar' ? 'line' : 'bar';
            initBookChart_ch4();
        }

        function generateExchangeData_ch4() {
            initExchangeChart_ch4();
        }

        function toggleLineStyle_ch4() {
            lineStyle_ch4 = lineStyle_ch4 === 'solid' ? 'dashed' : 'solid';
            initExchangeChart_ch4();
        }

        function generateSalesData_ch4() {
            initSalesChart_ch4();
        }

        function toggleMarkerStyle_ch4() {
            const styles = ['circle', 'triangle', 'rect', 'star'];
            const currentIndex = styles.indexOf(markerStyle_ch4);
            markerStyle_ch4 = styles[(currentIndex + 1) % styles.length];
            initSalesChart_ch4();
        }

        function generateTemperatureData_ch4() {
            initTemperatureChart_ch4();
        }

        function generateSnowflakeData_ch4() {
            initSnowflakeChart_ch4();
        }

        // ==================== ç« èŠ‚åˆå§‹åŒ–å‡½æ•° ====================
        function initChapter2() {
            console.log('åˆå§‹åŒ–ç¬¬äºŒç« ...');
            if (typeof showChart_ch2 === 'function') {
                showChart_ch2(0);
            } else {
                // å¦‚æœæ²¡æœ‰showChart_ch2å‡½æ•°ï¼Œåˆ›å»ºç®€å•çš„å›¾è¡¨
                const months = ['1æœˆ', '2æœˆ', '3æœˆ', '4æœˆ', '5æœˆ', '6æœˆ'];
                const sales = [120, 135, 125, 145, 160, 155];
                
                if (typeof Plotly !== 'undefined') {
                    Plotly.newPlot('ch2-chart', [{
                        x: months,
                        y: sales,
                        type: 'scatter',
                        mode: 'lines+markers',
                        name: 'é”€å”®é¢ï¼ˆä¸‡å…ƒï¼‰'
                    }], {
                        title: 'æœˆåº¦é”€å”®è¶‹åŠ¿'
                    }, {responsive: true});
                }
            }
        }

        function initChapter3() {
            console.log('åˆå§‹åŒ–ç¬¬ä¸‰ç« ...');
            // åˆå§‹åŒ–åŸºç¡€å›¾è¡¨æ ‡ç­¾
            const basicTab = document.querySelector('.ch3-tab');
            if (basicTab) {
                if (typeof showBasicCharts_ch3 === 'function') {
                    showBasicCharts_ch3(basicTab);
                }
            }
        }

        function initChapter6() {
            console.log('åˆå§‹åŒ–ç¬¬å…­ç« ...');
            // åˆå§‹åŒ–ç¬¬ä¸€ä¸ªæ¡ˆä¾‹
            const buttons = document.querySelectorAll('.ch6-tab');
            if (buttons.length > 0) {
                if (typeof showChart_ch6 === 'function') {
                    showChart_ch6(buttons[0]);
                }
            } else {
                // å¦‚æœæ²¡æœ‰æŒ‰é’®ï¼Œç›´æ¥åˆå§‹åŒ–å›¾è¡¨
                if (typeof Plotly !== 'undefined') {
                    const hours = Array.from({length: 24}, (_, i) => i + 'æ—¶');
                    const windSpeed = Array.from({length: 24}, () => Math.random() * 8 + 2);
                    
                    Plotly.newPlot('ch6-shenzhen-wind', [{
                        x: hours,
                        y: windSpeed,
                        type: 'scatter',
                        mode: 'lines+markers'
                    }], {
                        title: 'æ·±åœ³å¸‚24å°æ—¶çš„å¹³å‡é£é€Ÿ'
                    }, {responsive: true});
                }
            }
        }

        function initChapter7() {
            console.log('åˆå§‹åŒ–ç¬¬ä¸ƒç« ...');
            if (typeof refreshAllCharts_ch7 === 'function') {
                refreshAllCharts_ch7();
            } else if (typeof Plotly !== 'undefined') {
                // åˆ›å»ºç®€å•çš„3Dæ•£ç‚¹å›¾
                const starsData = Array.from({length: 30}, () => ({
                    x: Math.floor(Math.random() * 40),
                    y: Math.floor(Math.random() * 40),
                    z: Math.floor(Math.random() * 40)
                }));
                
                const colors = starsData.map(star => 
                    star.z <= 10 ? '#FFD700' : star.z < 20 ? '#C71585' : '#00CED1'
                );
                
                Plotly.newPlot('ch7-chart1', [{
                    x: starsData.map(s => s.x),
                    y: starsData.map(s => s.y),
                    z: starsData.map(s => s.z),
                    mode: 'markers',
                    type: 'scatter3d',
                    marker: {
                        size: 8,
                        color: colors,
                        symbol: 'star'
                    }
                }], {
                    title: 'ä¸‰ç»´ç©ºé—´çš„æ˜Ÿæ˜Ÿ',
                    scene: {
                        xaxis: {title: 'Xè½´'},
                        yaxis: {title: 'Yè½´'},
                        zaxis: {title: 'Zè½´'}
                    }
                }, {responsive: true});
            }
        }

        function initChapter8() {
            console.log('åˆå§‹åŒ–ç¬¬å…«ç« ...');
            currentChartIndex_ch8 = 0;
            if (typeof showChart_ch8 === 'function') {
                showChart_ch8(currentChartIndex_ch8);
            } else {
                // åˆ›å»ºç®€å•çš„åå¤«é¥¼å›¾
                if (typeof Plotly !== 'undefined') {
                    const gridSize = 10;
                    const x = [];
                    const y = [];
                    const colors = [];
                    
                    for (let row = 0; row < gridSize; row++) {
                        for (let col = 0; col < gridSize; col++) {
                            x.push(col);
                            y.push(gridSize - row - 1);
                            colors.push(Math.random() > 0.05 ? '#20B2AA' : '#D3D3D3');
                        }
                    }
                    
                    Plotly.newPlot('ch8-waffle', [{
                        x: x,
                        y: y,
                        mode: 'markers',
                        marker: {
                            color: colors,
                            size: 30,
                            line: {color: 'white', width: 2}
                        }
                    }], {
                        title: 'ç”µå½±ä¸Šåº§ç‡'
                    }, {responsive: true});
                }
            }
        }

        // ==================== ç« èŠ‚åˆ‡æ¢åŠŸèƒ½ ====================
        function switchChapter(chapterId, tabElement) {
            // åˆ‡æ¢æ ‡ç­¾çŠ¶æ€
            document.querySelectorAll('.chapter-tab').forEach(tab => tab.classList.remove('active'));
            tabElement.classList.add('active');
            
            // åˆ‡æ¢ç« èŠ‚å†…å®¹
            document.querySelectorAll('.chapter-content').forEach(chapter => chapter.classList.remove('active'));
            document.getElementById(chapterId).classList.add('active');
            
            // åˆå§‹åŒ–å¯¹åº”ç« èŠ‚
            setTimeout(() => {
                switch(chapterId) {
                    case 'chapter2':
                        initChapter2();
                        break;
                    case 'chapter3':
                        initChapter3();
                        break;
                    case 'chapter4':
                        initChapter4();
                        break;
                    case 'chapter5':
                        updateInstance_ch5(0);
                        break;
                    case 'chapter6':
                        initChapter6();
                        break;
                    case 'chapter7':
                        initChapter7();
                        break;
                    case 'chapter8':
                        initChapter8();
                        break;
                }
            }, 100);
        }

        // ==================== æ ‡ç­¾åˆ‡æ¢åŠŸèƒ½ ====================
        function switchTab(tabName, tabElement) {
            // æŸ¥æ‰¾çˆ¶å®¹å™¨
            const parent = tabElement.parentElement;
            if (!parent) return;
            
            // åˆ‡æ¢æ ‡ç­¾çŠ¶æ€
            parent.querySelectorAll('.nav-tab, .ch3-tab, .ch4-tab, .ch5-tab, .ch6-tab').forEach(tab => tab.classList.remove('active'));
            tabElement.classList.add('active');
            
            // æŸ¥æ‰¾å†…å®¹å®¹å™¨
            const contentContainer = parent.nextElementSibling || parent.parentElement.querySelector('.tab-content-area, .ch3-content, .ch4-tab-content');
            if (!contentContainer) return;
            
            // åˆ‡æ¢å†…å®¹
            contentContainer.querySelectorAll('.tab-content, .ch3-content, .ch4-tab-content').forEach(content => content.classList.remove('active'));
            const targetContent = document.getElementById(tabName + '-tab') || document.getElementById('ch4-' + tabName);
            if (targetContent) {
                targetContent.classList.add('active');
            }
        }

        // ==================== ç¬¬äº”ç« ç›¸å…³å‡½æ•° ====================
        function updateInstance_ch5(instanceIndex) {
            const titleElement = document.getElementById('ch5-title');
            const titleElement2 = document.getElementById('ch5-title2');
            const titleElement3 = document.getElementById('ch5-title3');
            
            switch(instanceIndex) {
                case 0:
                    // å¾®ä¿¡ç”¨æˆ·åˆ†æ
                    if (titleElement) titleElement.textContent = "å®ä¾‹1ï¼šå¾®ä¿¡ç”¨æˆ·åˆ†æ";
                    if (titleElement2) titleElement2.textContent = "æ€§åˆ«æ¯”ä¾‹";
                    if (titleElement3) titleElement3.textContent = "å¹´é¾„åˆ†å¸ƒ";
                    
                    const genderData = [{
                        values: [1200, 800],
                        labels: ['ç”·', 'å¥³'],
                        type: 'pie'
                    }];
                    if (typeof Plotly !== 'undefined') {
                        Plotly.newPlot('ch5-chart1', genderData, {title: 'æ€§åˆ«æ¯”ä¾‹'}, {responsive: true});
                    }
                    
                    const ageData = [{
                        x: ['18-25', '26-35', '36-45', '46-55', '55+'],
                        y: [300, 450, 380, 280, 190],
                        type: 'bar'
                    }];
                    if (typeof Plotly !== 'undefined') {
                        Plotly.newPlot('ch5-chart2', ageData, {title: 'å¹´é¾„åˆ†å¸ƒ'}, {responsive: true});
                    }
                    
                    const cityData = [{
                        values: [35, 25, 20, 15, 5],
                        labels: ['ä¸€çº¿åŸå¸‚', 'äºŒçº¿åŸå¸‚', 'ä¸‰çº¿åŸå¸‚', 'å››çº¿åŸå¸‚', 'å…¶ä»–'],
                        type: 'pie'
                    }];
                    if (typeof Plotly !== 'undefined') {
                        Plotly.newPlot('ch5-chart3', cityData, {title: 'åŸå¸‚åˆ†å¸ƒ'}, {responsive: true});
                    }
                    break;
                    
                case 1:
                    // ç”µå•†é”€å”®åˆ†æ
                    if (titleElement) titleElement.textContent = "å®ä¾‹2ï¼šç”µå•†é”€å”®åˆ†æ";
                    if (titleElement2) titleElement2.textContent = "äº§å“ç±»åˆ«";
                    if (titleElement3) titleElement3.textContent = "æœˆåº¦è¶‹åŠ¿";
                    
                    const categoryData = [{
                        values: [45, 25, 15, 10, 5],
                        labels: ['ç”µå­äº§å“', 'æœè£…', 'é£Ÿå“', 'å›¾ä¹¦', 'å…¶ä»–'],
                        type: 'pie'
                    }];
                    if (typeof Plotly !== 'undefined') {
                        Plotly.newPlot('ch5-chart1', categoryData, {title: 'äº§å“ç±»åˆ«é”€å”®å æ¯”'}, {responsive: true});
                    }
                    
                    const monthlyData = [{
                        x: ['1æœˆ', '2æœˆ', '3æœˆ', '4æœˆ', '5æœˆ', '6æœˆ'],
                        y: [120, 135, 125, 145, 160, 155],
                        type: 'scatter',
                        mode: 'lines+markers'
                    }];
                    if (typeof Plotly !== 'undefined') {
                        Plotly.newPlot('ch5-chart2', monthlyData, {title: 'æœˆåº¦é”€å”®è¶‹åŠ¿'}, {responsive: true});
                    }
                    
                    const regionData = [{
                        x: ['ååŒ—', 'åä¸œ', 'åå—', 'åè¥¿', 'åä¸­'],
                        y: [280, 350, 320, 180, 240],
                        type: 'bar'
                    }];
                    if (typeof Plotly !== 'undefined') {
                        Plotly.newPlot('ch5-chart3', regionData, {title: 'åœ°åŒºé”€å”®å¯¹æ¯”'}, {responsive: true});
                    }
                    break;
                    
                case 2:
                    // æŠ–éŸ³ç”¨æˆ·åˆ†æ
                    if (titleElement) titleElement.textContent = "å®ä¾‹3ï¼šæŠ–éŸ³ç”¨æˆ·åˆ†æ";
                    if (titleElement2) titleElement2.textContent = "å†…å®¹ç±»å‹åˆ†å¸ƒ";
                    if (titleElement3) titleElement3.textContent = "å†…å®¹ç±»å‹åˆ†å¸ƒ";
                    
                    const growthData = [
                        {x: ['2018', '2019', '2020', '2021', '2022'], y: [1, 3.2, 6, 8.5, 10], type: 'scatter', mode: 'lines+markers', name: 'ç”¨æˆ·å¢é•¿(äº¿)'}
                    ];
                    if (typeof Plotly !== 'undefined') {
                        Plotly.newPlot('ch5-chart1', growthData, {title: 'æŠ–éŸ³ç”¨æˆ·å¢é•¿è¶‹åŠ¿'}, {responsive: true});
                    }
                    
                    const activeData = [{
                        values: [35, 28, 20, 10, 7],
                        labels: ['æ™šä¸Š', 'ä¸‹åˆ', 'ä¸Šåˆ', 'æ·±å¤œ', 'å‡Œæ™¨'],
                        type: 'pie'
                    }];
                    if (typeof Plotly !== 'undefined') {
                        Plotly.newPlot('ch5-chart2', activeData, {title: 'ç”¨æˆ·æ´»è·ƒæ—¶é—´æ®µ'}, {responsive: true});
                    }
                    
                    const contentTypeData = [{
                        values: [30, 25, 20, 15, 10],
                        labels: ['å¨±ä¹', 'æ•™è‚²', 'ç”Ÿæ´»', 'æ–°é—»', 'å…¶ä»–'],
                        type: 'pie'
                    }];
                    if (typeof Plotly !== 'undefined') {
                        Plotly.newPlot('ch5-chart3', contentTypeData, {title: 'å†…å®¹ç±»å‹åˆ†å¸ƒ'}, {responsive: true});
                    }
                    break;
            }
        }

        function updateInstance_ch5_button() {
            // é‡è½½ç‰ˆæœ¬çš„å‡½æ•°ï¼Œç”¨äºæŒ‰é’®è°ƒç”¨
            updateInstance_ch5(0);
        }

        // ==================== ç« èŠ‚åˆå§‹åŒ–å‡½æ•° ====================
        function initChapter5() {
            // åˆå§‹åŒ–ç¬¬äº”ç« 
            updateInstance_ch5(0);
        }

        // ç¬¬å…­ç« ç›¸å…³å‡½æ•°
        function showChart_ch6(buttonElement) {
            // åˆ‡æ¢æ ‡ç­¾çŠ¶æ€
            document.querySelectorAll('.ch6-tab').forEach(tab => tab.classList.remove('active'));
            buttonElement.classList.add('active');
            
            // éšè—æ‰€æœ‰å†…å®¹
            document.querySelectorAll('.ch6-content').forEach(content => content.style.display = 'none');
            
            // æ˜¾ç¤ºå¯¹åº”å†…å®¹
            const targetId = buttonElement.getAttribute('onclick').match(/'([^']+)'/)[1];
            const targetElement = document.getElementById(targetId);
            if (targetElement) {
                targetElement.style.display = 'block';
                
                // åˆå§‹åŒ–å¯¹åº”çš„å›¾è¡¨
                setTimeout(() => {
                    switch(targetId) {
                        case 'ch6-case-study-1':
                            initShenzhenWind_ch6('ch6-shenzhen-wind', false);
                            break;
                        case 'ch6-case-study-2':
                            initShenzhenWind_ch6('ch6-shenzhen-wind2', true);
                            break;
                        case 'ch6-case-study-3':
                            initSineCosine_ch6('ch6-sine-cosine');
                            break;
                    }
                }, 100);
            }
        }

        function initShenzhenWind_ch6(elementId, hideSpines) {
            const element = document.getElementById(elementId);
            if (!element || typeof Plotly === 'undefined') return;
            
            const hours = Array.from({length: 24}, (_, i) => i + 'æ—¶');
            const windSpeed = Array.from({length: 24}, () => Math.random() * 8 + 2);
            
            const data = [{
                x: hours,
                y: windSpeed,
                type: 'scatter',
                mode: 'lines+markers',
                line: {color: '#3498db', width: 3},
                marker: {size: 8, color: '#3498db'}
            }];
            
            const layout = {
                title: hideSpines ? 'æ·±åœ³å¸‚24å°æ—¶å¹³å‡é£é€Ÿï¼ˆéšè—è½´è„Šç‰ˆï¼‰' : 'æ·±åœ³å¸‚24å°æ—¶çš„å¹³å‡é£é€Ÿï¼ˆåŸºç¡€ç‰ˆï¼‰',
                xaxis: {
                    title: 'æ—¶é—´',
                    showgrid: true,
                    zeroline: !hideSpines
                },
                yaxis: {
                    title: 'é£é€Ÿ (m/s)',
                    showgrid: true,
                    zeroline: !hideSpines
                },
                showlegend: false,
                margin: {t: 50, r: 30, b: 50, l: 60}
            };
            
            Plotly.newPlot(elementId, data, layout, {responsive: true});
        }

        function initSineCosine_ch6(elementId) {
            const element = document.getElementById(elementId);
            if (!element || typeof Plotly === 'undefined') return;
            
            const x = Array.from({length: 100}, (_, i) => (i * 0.1).toFixed(2));
            const sinValues = x.map(val => Math.sin(parseFloat(val)));
            const cosValues = x.map(val => Math.cos(parseFloat(val)));
            
            const data = [
                {
                    x: x,
                    y: sinValues,
                    type: 'scatter',
                    mode: 'lines',
                    name: 'sin(x)',
                    line: {color: '#e74c3c', width: 3}
                },
                {
                    x: x,
                    y: cosValues,
                    type: 'scatter',
                    mode: 'lines',
                    name: 'cos(x)',
                    line: {color: '#27ae60', width: 3}
                }
            ];
            
            const layout = {
                title: 'æ­£å¼¦å’Œä½™å¼¦å‡½æ•°å¯¹æ¯”',
                xaxis: {title: 'x'},
                yaxis: {title: 'y'},
                margin: {t: 50, r: 30, b: 50, l: 60}
            };
            
            Plotly.newPlot(elementId, data, layout, {responsive: true});
        }

        function initChapter6() {
            // åˆå§‹åŒ–ç¬¬å…­ç«  - å…ˆæ˜¾ç¤ºç¬¬ä¸€ä¸ªæ¡ˆä¾‹
            const buttons = document.querySelectorAll('.ch6-tab');
            if (buttons.length > 0) {
                // ä½¿ç”¨ç¬¬ä¸€ä¸ªæŒ‰é’®çš„æ•°æ®
                const firstButton = buttons[0];
                firstButton.classList.add('active');
                showChart_ch6(firstButton);
            } else {
                // å¦‚æœæ²¡æœ‰æŒ‰é’®ï¼Œç›´æ¥åˆå§‹åŒ–ç¬¬ä¸€ä¸ªå›¾è¡¨
                setTimeout(() => {
                    initShenzhenWind_ch6('ch6-shenzhen-wind', false);
                    document.getElementById('ch6-case-study-1').style.display = 'block';
                }, 500);
            }
        }

        function initChapter7() {
            // åˆå§‹åŒ–ç¬¬ä¸ƒç« 
            setTimeout(() => {
                // åˆå§‹åŒ–ç¬¬ä¸€ä¸ª3Då›¾è¡¨
                const chart1 = document.getElementById('ch7-chart1');
                if (chart1 && typeof Plotly !== 'undefined') {
                    // åˆ›å»º3Dæ•£ç‚¹å›¾æ•°æ®
                    const data = [{
                        x: Array.from({length: 30}, () => Math.floor(Math.random() * 40)),
                        y: Array.from({length: 30}, () => Math.floor(Math.random() * 40)),
                        z: Array.from({length: 30}, () => Math.floor(Math.random() * 40)),
                        mode: 'markers',
                        type: 'scatter3d',
                        marker: {
                            size: 8,
                            color: Array.from({length: 30}, () => 
                                Math.random() > 0.5 ? '#FFD700' : Math.random() > 0.5 ? '#C71585' : '#00CED1'
                            ),
                            symbol: 'star'
                        }
                    }];

                    const layout = {
                        title: 'ä¸‰ç»´ç©ºé—´çš„æ˜Ÿæ˜Ÿ',
                        scene: {
                            xaxis: {title: 'Xè½´'},
                            yaxis: {title: 'Yè½´'},
                            zaxis: {title: 'Zè½´'}
                        }
                    };

                    Plotly.newPlot('ch7-chart1', data, layout, {responsive: true});
                }

                // åˆ›å»ºé—ªçƒåŠ¨ç”»
                const chart2 = document.getElementById('ch7-chart2');
                if (chart2 && typeof Plotly !== 'undefined') {
                    const xx = [13, 5, 25, 13, 9, 19, 3, 39, 13, 27];
                    const yy = [4, 38, 16, 26, 7, 19, 28, 10, 17, 18];
                    const zz = [7, 19, 6, 12, 25, 19, 23, 25, 10, 15];
                    
                    const data = [{
                        x: xx,
                        y: yy,
                        z: zz,
                        mode: 'markers',
                        type: 'scatter3d',
                        marker: {
                            size: 12,
                            color: '#C71585',
                            symbol: 'star'
                        }
                    }];

                    const layout = {
                        title: 'ä¸‰ç»´ç©ºé—´é—ªçƒçš„æ˜Ÿæ˜Ÿ',
                        scene: {
                            xaxis: {title: 'Xè½´'},
                            yaxis: {title: 'Yè½´'},
                            zaxis: {title: 'Zè½´'}
                        }
                    };

                    Plotly.newPlot('ch7-chart2', data, layout, {responsive: true});
                }
            }, 500);
        }

        // ç¬¬å…«ç« ç›¸å…³å˜é‡å’Œå‡½æ•°
        let currentChartIndex_ch8 = 0;
        const totalCharts_ch8 = 10;

        function showChart_ch8(index) {
            // éšè—æ‰€æœ‰å›¾è¡¨
            for (let i = 0; i < totalCharts_ch8; i++) {
                const chartElement = document.getElementById('ch8-chart-' + i);
                if (chartElement) {
                    chartElement.style.display = 'none';
                }
                const dotElement = document.querySelectorAll('.ch8-dot')[i];
                if (dotElement) {
                    dotElement.classList.remove('active');
                }
            }
            
            // æ˜¾ç¤ºå½“å‰å›¾è¡¨
            const currentChartElement = document.getElementById('ch8-chart-' + index);
            if (currentChartElement) {
                currentChartElement.style.display = 'block';
            }
            const currentDotElement = document.querySelectorAll('.ch8-dot')[index];
            if (currentDotElement) {
                currentDotElement.classList.add('active');
            }
            
            // æ›´æ–°è®¡æ•°å™¨
            const counterElement = document.getElementById('ch8-counter');
            if (counterElement) {
                counterElement.textContent = (index + 1) + ' / ' + totalCharts_ch8;
            }
            
            // æ›´æ–°æŒ‰é’®çŠ¶æ€
            const prevBtn = document.getElementById('ch8-prev');
            const nextBtn = document.getElementById('ch8-next');
            if (prevBtn) prevBtn.disabled = index === 0;
            if (nextBtn) nextBtn.disabled = index === totalCharts_ch8 - 1;
            
            // åˆå§‹åŒ–å¯¹åº”çš„å›¾è¡¨
            setTimeout(() => {
                switch(index) {
                    case 0: createContourChart_ch8(); break;
                    case 1: createStreamplotChart_ch8(); break;
                    case 2: createStemChart_ch8(); break;
                    case 3: createDumbbellChart_ch8(); break;
                    case 4: createFunnelChart_ch8(); break;
                    case 5: createSankeyChart_ch8(); break;
                    case 6: createGanttChart_ch8(); break;
                    case 7: createHeatmapChart_ch8(); break;
                    case 8: createTreeChart_ch8(); break;
                    case 9: createWaffleChart_ch8(); break;
                }
            }, 100);
            
            currentChartIndex_ch8 = index;
        }

        function showPrevChart_ch8() {
            if (currentChartIndex_ch8 > 0) {
                showChart_ch8(currentChartIndex_ch8 - 1);
            }
        }

        function showNextChart_ch8() {
            if (currentChartIndex_ch8 < totalCharts_ch8 - 1) {
                showChart_ch8(currentChartIndex_ch8 + 1);
            }
        }

        function jumpToChart_ch8(index) {
            showChart_ch8(index);
        }

        // ç¬¬å…«ç« å›¾è¡¨åˆ›å»ºå‡½æ•°
        function createContourChart_ch8() {
            // ç­‰é«˜çº¿å›¾å·²åœ¨HTMLä¸­å®šä¹‰
        }

        function createStreamplotChart_ch8() {
            // çŸ¢é‡åœºæµçº¿å›¾å·²åœ¨HTMLä¸­å®šä¹‰  
        }

        function createStemChart_ch8() {
            // æ£‰æ£’å›¾å·²åœ¨HTMLä¸­å®šä¹‰
        }

        function createDumbbellChart_ch8() {
            // å“‘é“ƒå›¾å·²åœ¨HTMLä¸­å®šä¹‰
        }

        function createFunnelChart_ch8() {
            // æ¼æ–—å›¾å·²åœ¨HTMLä¸­å®šä¹‰
        }

        function createSankeyChart_ch8() {
            createSankey_ch8(); // ä½¿ç”¨å·²å®šä¹‰çš„å‡½æ•°
        }

        function createGanttChart_ch8() {
            createGantt_ch8(); // ä½¿ç”¨å·²å®šä¹‰çš„å‡½æ•°
        }

        function createHeatmapChart_ch8() {
            createHeatmap_ch8(); // ä½¿ç”¨å·²å®šä¹‰çš„å‡½æ•°
        }

        function createTreeChart_ch8() {
            // å±‚æ¬¡ç»“æ„æ ‘çŠ¶å›¾å·²åœ¨HTMLä¸­å®šä¹‰ï¼Œæˆ–ä½¿ç”¨createTree_ch8å‡½æ•°
            if (typeof createTree_ch8 === 'function') {
                createTree_ch8();
            }
        }

        function createWaffleChart_ch8() {
            // åå¤«é¥¼å›¾å·²åœ¨HTMLä¸­å®šä¹‰ï¼Œæˆ–ä½¿ç”¨createWaffleChart_ch8å‡½æ•°
            // è¿™ä¸ªå‡½æ•°åœ¨æ–‡ä»¶åé¢å·²ç»å®šä¹‰äº†
        }

        function initChapter8() {
            // åˆå§‹åŒ–ç¬¬å…«ç« 
            currentChartIndex_ch8 = 0;
            showChart_ch8(currentChartIndex_ch8);
        }

        // ==================== é¡µé¢åˆå§‹åŒ– ====================
        document.addEventListener('DOMContentLoaded', function() {
            console.log('é¡µé¢åŠ è½½å®Œæˆï¼Œå¼€å§‹åˆå§‹åŒ–...');
            setTimeout(() => {
                try {
                    if (typeof Plotly !== 'undefined') {
                        console.log('Plotlyå·²åŠ è½½ï¼Œåˆå§‹åŒ–ç¬¬äºŒç« ...');
                        initChapter2();
                    } else {
                        console.error('PlotlyæœªåŠ è½½');
                    }
                } catch (error) {
                    console.error('åˆå§‹åŒ–å¤±è´¥:', error);
                }
            }, 1000);
        });

        // é¡µé¢å¸è½½æ—¶æ¸…ç†
        window.addEventListener('beforeunload', function() {
            if (animationFrame_ch7) {
                clearInterval(animationFrame_ch7);
            }
        });

        // ==================== é¡µé¢åˆå§‹åŒ– ====================
        document.addEventListener('DOMContentLoaded', function() {
            console.log('é¡µé¢åŠ è½½å®Œæˆï¼Œå¼€å§‹åˆå§‹åŒ–...');
            setTimeout(() => {
                try {
                    // æ£€æŸ¥å¿…è¦çš„åº“æ˜¯å¦åŠ è½½
                    if (typeof Plotly === 'undefined') {
                        console.error('PlotlyæœªåŠ è½½');
                        return;
                    }
                    if (typeof Chart === 'undefined') {
                        console.error('Chart.jsæœªåŠ è½½');
                        return;
                    }
                    
                    console.log('å¼€å§‹åˆå§‹åŒ–ç¬¬äºŒç« ...');
                    initChapter2();
                    
                } catch (error) {
                    console.error('åˆå§‹åŒ–å¤±è´¥:', error);
                }
            }, 1000);
        });
    </script>
</body>
</html>