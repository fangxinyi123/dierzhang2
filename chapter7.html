<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ç¬¬7ç«  - 3Då¯è§†åŒ–æŠ€æœ¯</title>
    <script src="https://cdn.plot.ly/plotly-2.27.0.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Microsoft YaHei', Arial, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
        }

        header {
            text-align: center;
            margin-bottom: 40px;
            background: rgba(255, 255, 255, 0.95);
            padding: 30px;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
        }

        h1 {
            color: #2c3e50;
            font-size: 2.5em;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.1);
        }

        .subtitle {
            color: #7f8c8d;
            font-size: 1.2em;
        }

        .charts-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(600px, 1fr));
            gap: 30px;
            margin-bottom: 30px;
        }

        .chart-container {
            background: rgba(255, 255, 255, 0.95);
            padding: 25px;
            border-radius: 15px;
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.1);
            transition: transform 0.3s ease, box-shadow 0.3s ease;
        }

        .chart-container:hover {
            transform: translateY(-5px);
            box-shadow: 0 15px 35px rgba(0, 0, 0, 0.15);
        }

        .chart-title {
            color: #2c3e50;
            font-size: 1.4em;
            margin-bottom: 10px;
            font-weight: bold;
        }

        .chart-description {
            color: #7f8c8d;
            margin-bottom: 20px;
            line-height: 1.6;
        }

        .plot-area {
            width: 100%;
            height: 450px;
            border: 1px solid #e0e0e0;
            border-radius: 8px;
            background: #fafafa;
        }

        .controls {
            text-align: center;
            margin-top: 30px;
        }

        .btn {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 12px 25px;
            margin: 0 10px;
            border-radius: 25px;
            cursor: pointer;
            font-size: 16px;
            font-weight: bold;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(102, 126, 234, 0.3);
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(102, 126, 234, 0.4);
        }

        .btn:active {
            transform: translateY(0);
        }

        .error-message {
            color: #e74c3c;
            text-align: center;
            padding: 20px;
            background: #ffeaea;
            border: 1px solid #e74c3c;
            border-radius: 8px;
            margin: 10px 0;
        }

        @media (max-width: 768px) {
            .charts-grid {
                grid-template-columns: 1fr;
            }
            
            h1 {
                font-size: 2em;
            }
            
            .plot-area {
                height: 350px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>ğŸŒ ç¬¬7ç«  æ•°æ®å¯è§†åŒ–å¹³å°</h1>
            <p class="subtitle">3Då¯è§†åŒ–æŠ€æœ¯ - ç«‹ä½“æ•°æ®å±•ç¤ºä¸åˆ†æ</p>
        </header>

        <div class="charts-grid">
            <div class="chart-container">
                <h2 class="chart-title">å®ä¾‹1ï¼š3Dæ•£ç‚¹å›¾</h2>
                <p class="chart-description">å±•ç¤ºä¸‰ç»´ç©ºé—´ä¸­çš„æ•°æ®ç‚¹åˆ†å¸ƒï¼Œæ”¯æŒæ—‹è½¬å’Œç¼©æ”¾äº¤äº’</p>
                <div id="chart1" class="plot-area"></div>
            </div>

            <div class="chart-container">
                <h2 class="chart-title">å®ä¾‹2ï¼š3Dè¡¨é¢å›¾</h2>
                <p class="chart-description">å±•ç¤ºä¸‰ç»´å‡½æ•°è¡¨é¢ï¼Œç”¨äºå¯è§†åŒ–è¿ç»­æ•°æ®åˆ†å¸ƒ</p>
                <div id="chart2" class="plot-area"></div>
            </div>

            <div class="chart-container">
                <h2 class="chart-title">å®ä¾‹3ï¼šç¾å›½éƒ¨åˆ†åŸé•‡äººå£åˆ†å¸ƒ</h2>
                <p class="chart-description">ä½¿ç”¨åœ°å›¾æŠ•å½±å±•ç¤ºç¾å›½å„åŸé•‡çš„äººå£åˆ†å¸ƒæƒ…å†µï¼Œæ°”æ³¡å¤§å°è¡¨ç¤ºäººå£æ•°é‡</p>
                <div id="chart3" class="plot-area"></div>
            </div>
        </div>

        <div class="controls">
            <button class="btn" onclick="refreshAllCharts()">ğŸ”„ åˆ·æ–°æ‰€æœ‰å›¾è¡¨</button>
            <button class="btn" onclick="toggleAnimation()">ğŸ¬ åˆ‡æ¢åŠ¨ç”»</button>
            <button class="btn" onclick="resetView()">ğŸ” é‡ç½®è§†å›¾</button>
        </div>
    </div>

    <script>
        // å…¨å±€å˜é‡
        let animationFrame = null;
        let isAnimating = false;

        // ç­‰å¾…PlotlyåŠ è½½å®Œæˆ
        function waitForPlotly(callback, maxAttempts = 10) {
            let attempts = 0;
            function check() {
                attempts++;
                if (typeof Plotly !== 'undefined' && Plotly.newPlot) {
                    callback();
                } else if (attempts < maxAttempts) {
                    setTimeout(check, 200);
                } else {
                    console.error('PlotlyåŠ è½½è¶…æ—¶');
                }
            }
            check();
        }

        // æ˜¾ç¤ºé”™è¯¯ä¿¡æ¯
        function showError(chartId, message) {
            const chartElement = document.getElementById(chartId);
            if (chartElement) {
                chartElement.innerHTML = `<div class="error-message">âŒ ${message}</div>`;
            }
        }

        // å®ä¾‹1ï¼š3Dæ•£ç‚¹å›¾
        function createChart1() {
            try {
                // ç”Ÿæˆ3Dæ•£ç‚¹æ•°æ®
                const nPoints = 100;
                const x = [];
                const y = [];
                const z = [];
                const colors = [];
                
                for (let i = 0; i < nPoints; i++) {
                    x.push(Math.random() * 10);
                    y.push(Math.random() * 10);
                    z.push(Math.random() * 10 + 2);
                    colors.push(Math.random());
                }

                const trace = {
                    x: x,
                    y: y,
                    z: z,
                    mode: 'markers',
                    marker: {
                        size: 8,
                        color: colors,
                        colorscale: 'Viridis',
                        opacity: 0.8,
                        colorbar: {
                            title: 'æ•°å€¼',
                            titleside: 'right'
                        }
                    },
                    type: 'scatter3d',
                    text: 'æ•°æ®ç‚¹',
                    hovertemplate: 'X: %{x:.2f}<br>Y: %{y:.2f}<br>Z: %{z:.2f}<extra></extra>'
                };

                const layout = {
                    title: {
                        text: '3Dæ•£ç‚¹å›¾ç¤ºä¾‹',
                        font: {size: 16}
                    },
                    scene: {
                        xaxis: {title: 'Xè½´'},
                        yaxis: {title: 'Yè½´'},
                        zaxis: {title: 'Zè½´'},
                        camera: {
                            eye: {x: 1.5, y: 1.5, z: 1.5}
                        }
                    },
                    margin: {l: 0, r: 0, t: 40, b: 0},
                    paper_bgcolor: 'rgba(0,0,0,0)',
                    plot_bgcolor: 'rgba(0,0,0,0)'
                };

                const config = {
                    responsive: true,
                    displayModeBar: true,
                    displaylogo: false
                };

                Plotly.newPlot('chart1', [trace], layout, config);
            } catch (error) {
                console.error('åˆ›å»ºå›¾è¡¨1å¤±è´¥:', error);
                showError('chart1', 'åˆ›å»ºå›¾è¡¨å¤±è´¥ï¼š' + error.message);
            }
        }

        // å®ä¾‹2ï¼š3Dè¡¨é¢å›¾
        function createChart2() {
            try {
                // ç”Ÿæˆ3Dè¡¨é¢æ•°æ®
                const size = 30;
                const x = [];
                const y = [];
                const z = [];

                for (let i = 0; i < size; i++) {
                    x[i] = [];
                    y[i] = [];
                    z[i] = [];
                    for (let j = 0; j < size; j++) {
                        const xVal = (i - size/2) / 4;
                        const yVal = (j - size/2) / 4;
                        x[i][j] = xVal;
                        y[i][j] = yVal;
                        z[i][j] = Math.sin(Math.sqrt(xVal*xVal + yVal*yVal));
                    }
                }

                const trace = {
                    x: x[0],
                    y: x.map(row => row[0]),
                    z: z,
                    type: 'surface',
                    colorscale: 'Jet',
                    showscale: true,
                    colorbar: {
                        title: 'Zå€¼',
                        titleside: 'right'
                    }
                };

                const layout = {
                    title: {
                        text: '3Dè¡¨é¢å›¾ç¤ºä¾‹',
                        font: {size: 16}
                    },
                    scene: {
                        xaxis: {title: 'Xè½´'},
                        yaxis: {title: 'Yè½´'},
                        zaxis: {title: 'Zè½´'},
                        camera: {
                            eye: {x: 1.5, y: 1.5, z: 1.5}
                        }
                    },
                    margin: {l: 0, r: 0, t: 40, b: 0},
                    paper_bgcolor: 'rgba(0,0,0,0)',
                    plot_bgcolor: 'rgba(0,0,0,0)'
                };

                const config = {
                    responsive: true,
                    displayModeBar: true,
                    displaylogo: false
                };

                Plotly.newPlot('chart2', [trace], layout, config);
            } catch (error) {
                console.error('åˆ›å»ºå›¾è¡¨2å¤±è´¥:', error);
                showError('chart2', 'åˆ›å»ºå›¾è¡¨å¤±è´¥ï¼š' + error.message);
            }
        }

        // å®ä¾‹3ï¼šç¾å›½äººå£åˆ†å¸ƒåœ°å›¾
        function createChart3() {
            try {
                // æ¨¡æ‹Ÿç¾å›½åŸå¸‚æ•°æ®
                const cities = [
                    {name: 'New York', lat: 40.7128, lon: -74.0060, pop: 8419000},
                    {name: 'Los Angeles', lat: 34.0522, lon: -118.2437, pop: 3980000},
                    {name: 'Chicago', lat: 41.8781, lon: -87.6298, pop: 2716000},
                    {name: 'Houston', lat: 29.7604, lon: -95.3698, pop: 2320000},
                    {name: 'Phoenix', lat: 33.4484, lon: -112.0740, pop: 1680000},
                    {name: 'Philadelphia', lat: 39.9526, lon: -75.1652, pop: 1584000},
                    {name: 'San Antonio', lat: 29.4241, lon: -98.4936, pop: 1547000},
                    {name: 'San Diego', lat: 32.7157, lon: -117.1611, pop: 1424000},
                    {name: 'Dallas', lat: 32.7767, lon: -96.7970, pop: 1343000},
                    {name: 'San Jose', lat: 37.3382, lon: -121.8863, pop: 1022000},
                    {name: 'Austin', lat: 30.2672, lon: -97.7431, pop: 950000},
                    {name: 'Jacksonville', lat: 30.3322, lon: -81.6557, pop: 911000},
                    {name: 'Fort Worth', lat: 32.7555, lon: -97.3308, pop: 895000},
                    {name: 'Columbus', lat: 39.9612, lon: -82.9988, pop: 879000},
                    {name: 'Charlotte', lat: 35.2271, lon: -80.8431, pop: 885000}
                ];

                const maxPop = Math.max(...cities.map(c => c.pop));
                const sizes = cities.map(c => (c.pop / maxPop) * 50);

                const trace = {
                    type: 'scattergeo',
                    locationmode: 'USA-states',
                    lat: cities.map(c => c.lat),
                    lon: cities.map(c => c.lon),
                    text: cities.map(c => `${c.name}<br>äººå£: ${c.pop.toLocaleString()}`),
                    marker: {
                        size: sizes,
                        color: sizes,
                        colorscale: 'Blues',
                        colorbar: {
                            title: 'äººå£æ•°é‡',
                            titleside: 'right',
                            ticksuffix: 'ä¸‡'
                        },
                        line: {
                            color: 'black',
                            width: 0.5
                        }
                    },
                    hovertemplate: '%{text}<extra></extra>'
                };

                const layout = {
                    title: {
                        text: '2014å¹´ç¾å›½éƒ¨åˆ†åŸé•‡çš„äººå£åˆ†å¸ƒæƒ…å†µ',
                        font: {size: 16}
                    },
                    geo: {
                        scope: 'usa',
                        projection: {
                            type: 'albers usa'
                        },
                        showland: true,
                        landcolor: '#EAEAEA',
                        showlakes: true,
                        lakecolor: '#B3E5FC',
                        showsubunits: true,
                        subunitcolor: 'white',
                        countrycolor: 'white',
                        coastlinecolor: 'white'
                    },
                    margin: {l: 0, r: 0, t: 40, b: 0},
                    paper_bgcolor: 'rgba(0,0,0,0)',
                    plot_bgcolor: 'rgba(0,0,0,0)'
                };

                const config = {
                    responsive: true,
                    displayModeBar: true,
                    displaylogo: false
                };

                Plotly.newPlot('chart3', [trace], layout, config);
            } catch (error) {
                console.error('åˆ›å»ºå›¾è¡¨3å¤±è´¥:', error);
                showError('chart3', 'åˆ›å»ºå›¾è¡¨å¤±è´¥ï¼š' + error.message);
            }
        }

        // åˆ·æ–°æ‰€æœ‰å›¾è¡¨
        function refreshAllCharts() {
            if (animationFrame) {
                clearInterval(animationFrame);
                animationFrame = null;
            }
            
            createChart1();
            createChart2();
            createChart3();
        }

        // åˆ‡æ¢åŠ¨ç”»
        function toggleAnimation() {
            if (isAnimating) {
                if (animationFrame) {
                    clearInterval(animationFrame);
                    animationFrame = null;
                }
                isAnimating = false;
            } else {
                isAnimating = true;
                let angle = 0;
                
                animationFrame = setInterval(() => {
                    angle += 2;
                    const camera = {
                        eye: {
                            x: 1.5 * Math.cos(angle * Math.PI / 180),
                            y: 1.5 * Math.sin(angle * Math.PI / 180),
                            z: 1.5
                        }
                    };
                    
                    Plotly.relayout('chart1', {'scene.camera': camera});
                    Plotly.relayout('chart2', {'scene.camera': camera});
                }, 100);
            }
        }

        // é‡ç½®è§†å›¾
        function resetView() {
            const defaultCamera = {
                eye: {x: 1.5, y: 1.5, z: 1.5}
            };
            
            Plotly.relayout('chart1', {'scene.camera': defaultCamera});
            Plotly.relayout('chart2', {'scene.camera': defaultCamera});
            Plotly.relayout('chart3', {});
        }

        // åˆå§‹åŒ–é¡µé¢
        document.addEventListener('DOMContentLoaded', function() {
            // ç¡®ä¿Plotlyå·²åŠ è½½
            if (typeof Plotly === 'undefined') {
                setTimeout(() => {
                    initializeCharts();
                }, 1000);
            } else {
                initializeCharts();
            }
        });

        function initializeCharts() {
            try {
                createChart1();
                createChart2();
                createChart3();
                console.log('æ‰€æœ‰å›¾è¡¨åˆå§‹åŒ–å®Œæˆ');
            } catch (error) {
                console.error('å›¾è¡¨åˆå§‹åŒ–å¤±è´¥:', error);
            }
        }
    </script>
</body>
</html>