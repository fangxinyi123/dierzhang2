<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>第8章数据可视化平台</title>
    <script src="https://cdn.plot.ly/plotly-2.27.0.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Microsoft YaHei', Arial, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
            overflow: hidden;
        }
        
        header {
            background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
            color: white;
            padding: 30px;
            text-align: center;
        }
        
        h1 {
            font-size: 2.5rem;
            margin-bottom: 10px;
        }
        
        .subtitle {
            font-size: 1.1rem;
            margin-bottom: 20px;
            opacity: 0.9;
        }
        
        .navigation {
            background: rgba(255, 255, 255, 0.1);
            padding: 20px;
            border-radius: 10px;
            margin-top: 20px;
        }
        
        .nav-buttons {
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 20px;
            margin-bottom: 15px;
        }
        
        .nav-btn {
            background: rgba(255, 255, 255, 0.2);
            border: 2px solid rgba(255, 255, 255, 0.5);
            color: white;
            padding: 12px 24px;
            border-radius: 25px;
            cursor: pointer;
            font-size: 1rem;
            transition: all 0.3s ease;
        }
        
        .nav-btn:hover {
            background: rgba(255, 255, 255, 0.3);
            transform: translateY(-2px);
        }
        
        .nav-btn:disabled {
            background: rgba(100, 100, 100, 0.5);
            cursor: not-allowed;
            transform: none;
        }
        
        .chart-counter {
            background: rgba(255, 255, 255, 0.3);
            padding: 10px 20px;
            border-radius: 20px;
            font-weight: bold;
            min-width: 100px;
            text-align: center;
        }
        
        .chart-dots {
            display: flex;
            justify-content: center;
            gap: 8px;
        }
        
        .dot {
            width: 12px;
            height: 12px;
            border-radius: 50%;
            background: rgba(255, 255, 255, 0.4);
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .dot.active {
            background: white;
            transform: scale(1.2);
        }
        
        main {
            padding: 40px 30px;
        }
        
        .section-intro {
            text-align: center;
            margin-bottom: 30px;
        }
        
        .section-title {
            font-size: 2rem;
            color: #333;
            margin-bottom: 15px;
        }
        
        .section-desc {
            color: #666;
            font-size: 1.1rem;
            max-width: 800px;
            margin: 0 auto;
            line-height: 1.6;
        }
        
        .charts-grid {
            position: relative;
            min-height: 500px;
        }
        
        .chart-container {
            background: white;
            border-radius: 10px;
            padding: 25px;
            box-shadow: 0 5px 20px rgba(0, 0, 0, 0.1);
            display: none;
            min-height: 450px;
            border: 1px solid #e0e0e0;
        }
        
        .chart-container.active {
            display: block;
        }
        
        .chart-title {
            font-size: 1.4rem;
            color: #333;
            margin-bottom: 10px;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .chart-number {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            width: 35px;
            height: 35px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.9rem;
            font-weight: bold;
        }
        
        .chart-description {
            color: #666;
            font-size: 0.95rem;
            margin-bottom: 20px;
            line-height: 1.5;
        }
        
        .chart-area {
            width: 100%;
            height: 400px;
            background: #f8f9fa;
            border-radius: 8px;
            padding: 10px;
        }
        
        .loading {
            display: flex;
            align-items: center;
            justify-content: center;
            height: 400px;
            color: #666;
            font-size: 1.1rem;
        }
        
        .spinner {
            width: 30px;
            height: 30px;
            border: 3px solid #f3f3f3;
            border-top: 3px solid #4facfe;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin-right: 15px;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        footer {
            background: #f8f9fa;
            padding: 20px;
            text-align: center;
            color: #666;
            border-top: 1px solid #e9ecef;
        }
        
        @media (max-width: 768px) {
            h1 {
                font-size: 2rem;
            }
            
            .nav-btn {
                font-size: 0.9rem;
                padding: 10px 20px;
            }
            
            .nav-buttons {
                gap: 10px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>第8章数据可视化平台</h1>
            <p class="subtitle">探索高级数据可视化技术的综合展示平台</p>
            
            <div class="navigation">
                <div class="nav-buttons">
                    <button class="nav-btn" id="prevBtn" onclick="showPrevChart()">
                        ← 上一张
                    </button>
                    <div class="chart-counter" id="counter">1 / 10</div>
                    <button class="nav-btn" id="nextBtn" onclick="showNextChart()">
                        下一张 →
                    </button>
                </div>
                <div class="chart-dots">
                    <span class="dot active" onclick="jumpToChart(0)"></span>
                    <span class="dot" onclick="jumpToChart(1)"></span>
                    <span class="dot" onclick="jumpToChart(2)"></span>
                    <span class="dot" onclick="jumpToChart(3)"></span>
                    <span class="dot" onclick="jumpToChart(4)"></span>
                    <span class="dot" onclick="jumpToChart(5)"></span>
                    <span class="dot" onclick="jumpToChart(6)"></span>
                    <span class="dot" onclick="jumpToChart(7)"></span>
                    <span class="dot" onclick="jumpToChart(8)"></span>
                    <span class="dot" onclick="jumpToChart(9)"></span>
                </div>
            </div>
        </header>
        
        <main>
            <div class="section-intro">
                <h2 class="section-title">高级数据可视化技术展示</h2>
                <p class="section-desc">
                    本平台展示了第8章中的10种高级数据可视化技术，包括等高线图、矢量场流线图、棉棒图、哑铃图、甘特图、人口金字塔图、漏斗图、桑基图、树状图和华夫饼图。
                </p>
            </div>
            
            <div class="charts-grid">
                <!-- 等高线图 -->
                <div class="chart-container active" id="chart-0">
                    <div class="chart-title">
                        <span class="chart-number">1</span>
                        等高线图 (8.1)
                    </div>
                    <div class="chart-description">
                        等高线图用于表示三维数据在二维平面上的投影，通过等值线展示数据的高度分布特征。
                    </div>
                    <div class="chart-area" id="contour-chart"></div>
                </div>
                
                <!-- 矢量场流线图 -->
                <div class="chart-container" id="chart-1">
                    <div class="chart-title">
                        <span class="chart-number">2</span>
                        矢量场流线图 (8.2)
                    </div>
                    <div class="chart-description">
                        矢量场流线图用于可视化向量场的流动方向和强度，广泛应用于流体力学、电磁场等科学计算领域。
                    </div>
                    <div class="chart-area" id="streamplot-chart"></div>
                </div>
                
                <!-- 棉棒图 -->
                <div class="chart-container" id="chart-2">
                    <div class="chart-title">
                        <span class="chart-number">3</span>
                        棉棒图 (8.3)
                    </div>
                    <div class="chart-description">
                        棉棒图用于展示离散数据点的数值，通过垂直线条连接基线到数据点，适合展示时间序列数据对比。
                    </div>
                    <div class="chart-area" id="stem-chart"></div>
                </div>
                
                <!-- 哑铃图 -->
                <div class="chart-container" id="chart-3">
                    <div class="chart-title">
                        <span class="chart-number">4</span>
                        哑铃图 (8.4)
                    </div>
                    <div class="chart-description">
                        哑铃图用于比较两个时间点或两组数据的差异，通过连接线展示变化趋势，适合展示前后对比。
                    </div>
                    <div class="chart-area" id="dumbbell-chart"></div>
                </div>
                
                <!-- 甘特图 -->
                <div class="chart-container" id="chart-4">
                    <div class="chart-title">
                        <span class="chart-number">5</span>
                        甘特图 (8.5)
                    </div>
                    <div class="chart-description">
                        甘特图是项目管理中的重要工具，通过条形图展示项目任务的时间安排、持续时间和依赖关系。
                    </div>
                    <div class="chart-area" id="gantt-chart"></div>
                </div>
                
                <!-- 人口金字塔图 -->
                <div class="chart-container" id="chart-5">
                    <div class="chart-title">
                        <span class="chart-number">6</span>
                        人口金字塔图 (8.6)
                    </div>
                    <div class="chart-description">
                        人口金字塔图用于展示人口按年龄和性别的分布情况，是人口统计学中的经典图表。
                    </div>
                    <div class="chart-area" id="pyramid-chart"></div>
                </div>
                
                <!-- 漏斗图 -->
                <div class="chart-container" id="chart-6">
                    <div class="chart-title">
                        <span class="chart-number">7</span>
                        漏斗图 (8.7)
                    </div>
                    <div class="chart-description">
                        漏斗图用于展示数据在不同阶段的递减过程，常用于销售漏斗、转化率分析等场景。
                    </div>
                    <div class="chart-area" id="funnel-chart"></div>
                </div>
                
                <!-- 桑基图 -->
                <div class="chart-container" id="chart-7">
                    <div class="chart-title">
                        <span class="chart-number">8</span>
                        桑基图 (8.8)
                    </div>
                    <div class="chart-description">
                        桑基图用于展示流量在不同节点间的分配和流动，通过流动带的宽度表示流量大小。
                    </div>
                    <div class="chart-area" id="sankey-chart"></div>
                </div>
                
                <!-- 树状图 -->
                <div class="chart-container" id="chart-8">
                    <div class="chart-title">
                        <span class="chart-number">9</span>
                        树状图 (8.9)
                    </div>
                    <div class="chart-description">
                        树状图以树形结构展示层级数据，通过节点的连接关系展示数据的层次结构和从属关系。
                    </div>
                    <div class="chart-area" id="tree-chart"></div>
                </div>
                
                <!-- 华夫饼图 -->
                <div class="chart-container" id="chart-9">
                    <div class="chart-title">
                        <span class="chart-number">10</span>
                        华夫饼图 (8.10)
                    </div>
                    <div class="chart-description">
                        华夫饼图通过网格单元的组合展示比例数据，以直观的方式呈现百分比信息。
                    </div>
                    <div class="chart-area" id="waffle-chart"></div>
                </div>
            </div>
        </main>
        
        <footer>
            <p>© 2024 第8章数据可视化平台 | 基于Plotly.js构建</p>
        </footer>
    </div>

    <script>
        // 全局变量
        let currentChartIndex = 0;
        const totalCharts = 10;
        let chartsCreated = false;

        // 导航功能
        function showChart(index) {
            console.log("显示图表:", index);
            
            // 隐藏所有图表
            document.querySelectorAll('.chart-container').forEach(chart => {
                chart.classList.remove('active');
            });
            
            // 显示指定图表
            const targetChart = document.getElementById(`chart-${index}`);
            if (targetChart) {
                targetChart.classList.add('active');
            }
            
            // 更新计数器
            document.getElementById('counter').textContent = `${index + 1} / ${totalCharts}`;
            
            // 更新点状态
            document.querySelectorAll('.dot').forEach((dot, i) => {
                dot.classList.toggle('active', i === index);
            });
            
            // 更新按钮状态
            document.getElementById('prevBtn').disabled = index === 0;
            document.getElementById('nextBtn').disabled = index === totalCharts - 1;
            
            currentChartIndex = index;
        }

        function showPrevChart() {
            if (currentChartIndex > 0) {
                showChart(currentChartIndex - 1);
            }
        }

        function showNextChart() {
            if (currentChartIndex < totalCharts - 1) {
                showChart(currentChartIndex + 1);
            }
        }

        function jumpToChart(index) {
            showChart(index);
        }

        // 创建等高线图
        function createContourChart() {
            const n = 50;
            const x = [];
            const y = [];
            
            for (let i = 0; i < n; i++) {
                x.push(-2 + i * 4 / n);
                y.push(-2 + i * 4 / n);
            }
            
            const z = [];
            for (let i = 0; i < n; i++) {
                const row = [];
                for (let j = 0; j < n; j++) {
                    const x_val = x[j];
                    const y_val = y[i];
                    const h = (1 - x_val/2 + Math.pow(x_val, 5) + Math.pow(y_val, 3)) * 
                              Math.exp(-Math.pow(x_val, 2) - Math.pow(y_val, 2));
                    row.push(h);
                }
                z.push(row);
            }
            
            const data = [{
                x: x,
                y: y,
                z: z,
                type: 'contour',
                colorscale: 'Earth'
            }];
            
            const layout = {
                title: '三维函数的等高线图',
                xaxis: { title: 'X轴' },
                yaxis: { title: 'Y轴' },
                margin: { t: 40, r: 20, b: 40, l: 40 },
                height: 350
            };
            
            Plotly.newPlot('contour-chart', data, layout, {responsive: true});
        }

        // 创建矢量场流线图
        function createStreamPlot() {
            const n = 15;
            const arrowData = [];
            
            for (let i = 0; i < n; i++) {
                for (let j = 0; j < n; j++) {
                    const x_val = -3 + j * 6 / n;
                    const y_val = -3 + i * 6 / n;
                    
                    const u = -y_val;
                    const v = x_val;
                    
                    const scale = 0.15;
                    const x_end = x_val + u * scale;
                    const y_end = y_val + v * scale;
                    
                    arrowData.push({
                        type: 'scatter',
                        x: [x_val, x_end],
                        y: [y_val, y_end],
                        mode: 'lines',
                        line: { color: 'blue', width: 2 },
                        showlegend: false
                    });
                }
            }
            
            const layout = {
                title: '矢量场流线图',
                xaxis: { title: 'X轴', range: [-3, 3] },
                yaxis: { title: 'Y轴', range: [-3, 3] },
                margin: { t: 40, r: 20, b: 40, l: 40 },
                height: 350
            };
            
            Plotly.newPlot('streamplot-chart', arrowData, layout, {responsive: true});
        }

        // 创建棉棒图 (8.3) - 使用正确的plt.stem样式
        function createStemChart() {
            const brands = ['宝骏310', '宝马i3', '致享', '焕驰', '力帆530', '派力奥', '悦翔V3', '乐风RV', '奥迪A1', '威驰FS', '夏利N7', '启辰R30', '和悦A13RS', '致炫', '赛欧'];
            const consumption = [5.9, 6.2, 6.7, 7.0, 7.0, 7.1, 7.2, 7.4, 7.5, 7.6, 7.7, 7.7, 7.7, 7.8, 7.9];
            
            // 创建垂直线条（stem部分）
            const stemLines = [];
            for (let i = 0; i < brands.length; i++) {
                stemLines.push({
                    type: 'scatter',
                    mode: 'lines',
                    x: [i, i],
                    y: [0, consumption[i]],
                    line: {
                        color: 'blue',
                        width: 2
                    },
                    showlegend: false,
                    hoverinfo: 'none'
                });
            }
            
            // 创建数据点（marker部分）
            const markers = {
                x: Array.from({length: brands.length}, (_, i) => i),
                y: consumption,
                type: 'scatter',
                mode: 'markers',
                marker: {
                    color: 'red',
                    size: 8,
                    symbol: 'circle'
                },
                text: brands.map((brand, i) => `${brand}: ${consumption[i]} L/km`),
                hoverinfo: 'text',
                name: '燃料消耗量'
            };
            
            // 创建基准线
            const baseline = {
                type: 'scatter',
                mode: 'lines',
                x: [-0.5, brands.length - 0.5],
                y: [0, 0],
                line: {
                    color: 'black',
                    width: 1
                },
                showlegend: false,
                hoverinfo: 'none'
            };
            
            const layout = {
                title: '不同品牌轿车的燃料消耗量',
                xaxis: { 
                    title: '汽车品牌',
                    tickmode: 'array',
                    tickvals: Array.from({length: brands.length}, (_, i) => i),
                    ticktext: brands,
                    tickangle: 60
                },
                yaxis: { 
                    title: '燃料消耗量(L/km)',
                    range: [0, 10]
                },
                margin: { t: 40, r: 20, b: 100, l: 60 },
                height: 400
            };
            
            Plotly.newPlot('stem-chart', [baseline, ...stemLines, markers], layout, {responsive: true});
        }

        // 创建哑铃图
        function createDumbbellChart() {
            const cities = ['纽约', '洛杉矶', '芝加哥', '休斯顿', '费城', '凤凰城', '圣地亚哥', '达拉斯'];
            const pct_2013 = [2.3, 1.8, 3.1, 2.7, 1.9, 2.4, 2.8, 2.2];
            const pct_2014 = [3.1, 2.5, 2.8, 3.4, 2.8, 3.2, 3.5, 2.9];
            
            const trace2013 = {
                x: pct_2013,
                y: cities,
                type: 'scatter',
                mode: 'markers',
                name: '2013年',
                marker: { color: 'blue', size: 10 }
            };
            
            const trace2014 = {
                x: pct_2014,
                y: cities,
                type: 'scatter',
                mode: 'markers',
                name: '2014年',
                marker: { color: 'red', size: 10 }
            };
            
            const lines = [];
            for (let i = 0; i < cities.length; i++) {
                lines.push({
                    x: [pct_2013[i], pct_2014[i]],
                    y: [cities[i], cities[i]],
                    type: 'scatter',
                    mode: 'lines',
                    line: { color: 'gray', width: 2 },
                    showlegend: false
                });
            }
            
            const layout = {
                title: '2013年与2014年城市人口PCT指标变化',
                xaxis: { title: '变化率 (%)' },
                yaxis: { title: '城市' },
                margin: { t: 40, r: 20, b: 40, l: 80 },
                height: 350
            };
            
            Plotly.newPlot('dumbbell-chart', [trace2013, trace2014, ...lines], layout, {responsive: true});
        }

        // 创建甘特图 - 使用plt.barh样式
        function createGanttChart() {
            const tasks = ['需求分析', '系统设计', '前端开发', '后端开发', '数据库设计', '测试', '部署上线'];
            const startDates = [0, 2, 4, 4, 3, 7, 9];
            const durations = [2, 2, 3, 4, 2, 2, 1];
            
            const trace = {
                x: startDates,
                y: tasks,
                width: durations,
                type: 'bar',
                orientation: 'h',
                marker: {
                    color: 'rgba(65, 105, 225, 0.8)',
                    line: {
                        color: 'rgba(65, 105, 225, 1)',
                        width: 1
                    }
                },
                text: durations.map(d => d + '周'),
                textposition: 'inside',
                textfont: {
                    color: 'white',
                    size: 12
                }
            };
            
            const layout = {
                title: '项目任务甘特图',
                xaxis: { 
                    title: '开始时间 (周)',
                    range: [-1, 11]
                },
                yaxis: { 
                    title: '任务名称',
                    autorange: 'reversed'
                },
                margin: { t: 40, r: 20, b: 60, l: 80 },
                height: 350
            };
            
            Plotly.newPlot('gantt-chart', [trace], layout, {responsive: true});
        }

        // 创建人口金字塔图
        function createPyramidChart() {
            const ageGroups = ['0-9', '10-19', '20-29', '30-39', '40-49', '50-59', '60-69', '70+'];
            const male = [-120000, -95000, -85000, -75000, -68000, -55000, -40000, -25000];
            const female = [110000, 90000, 80000, 72000, 65000, 52000, 38000, 20000];
            
            const maleTrace = {
                y: ageGroups,
                x: male,
                type: 'bar',
                name: '男',
                orientation: 'h',
                marker: { color: 'lightblue' }
            };
            
            const femaleTrace = {
                y: ageGroups,
                x: female,
                type: 'bar',
                name: '女',
                orientation: 'h',
                marker: { color: 'lightpink' }
            };
            
            const layout = {
                title: '人口金字塔图',
                xaxis: { title: '人数' },
                yaxis: { title: '年龄段' },
                margin: { t: 40, r: 20, b: 40, l: 40 },
                height: 350,
                barmode: 'overlay'
            };
            
            Plotly.newPlot('pyramid-chart', [maleTrace, femaleTrace], layout, {responsive: true});
        }

        // 创建漏斗图 (8.7) - 使用双bar图+线条样式，符合第8章数据
        function createFunnelChart() {
            const stages = ['访问商品', '加购物车', '生成订单', '支付订单', '完成交易'];
            const x1 = [1000, 500, 300, 200, 150];  // 各环节的客户数量
            const x2 = x1.map(x => (Math.max(...x1) - x) / 2);  // 计算x2
            const x3 = x1.map((x, i) => x + x2[i]);  // x1 + x2
            
            // 创建总量条形图（绿色）
            const trace1 = {
                x: x3,
                y: stages,
                type: 'bar',
                orientation: 'h',
                marker: {
                    color: 'green',
                    opacity: 0.5
                },
                name: '总量',
                hoverinfo: 'skip'
            };
            
            // 创建辅助条形图（白色）
            const trace2 = {
                x: x2,
                y: stages,
                type: 'bar',
                orientation: 'h',
                marker: {
                    color: 'white',
                    opacity: 1.0,
                    line: {
                        color: 'black',
                        width: 0.5
                    }
                },
                name: '辅助',
                hoverinfo: 'skip'
            };
            
            // 添加左侧连接线
            const trace3 = {
                x: x2,
                y: stages,
                type: 'scatter',
                mode: 'lines',
                line: {
                    color: 'black',
                    width: 2
                },
                showlegend: false,
                hoverinfo: 'skip'
            };
            
            // 添加右侧连接线
            const trace4 = {
                x: x3,
                y: stages,
                type: 'scatter',
                mode: 'lines',
                line: {
                    color: 'black',
                    width: 2
                },
                showlegend: false,
                hoverinfo: 'skip'
            };
            
            // 添加百分比标签
            const percentages = x1.map(x => ((x / x1[0]) * 100).toFixed(2) + '%');
            const trace5 = {
                x: x2.map((x, i) => x + (x3[i] - x2[i]) / 2),
                y: stages,
                type: 'scatter',
                mode: 'text',
                text: percentages,
                textfont: {
                    size: 14,
                    color: 'black'
                },
                showlegend: false,
                hoverinfo: 'skip'
            };
            
            // 添加数据标签
            const trace6 = {
                x: x3.map((x, i) => x + 20),
                y: stages,
                type: 'scatter',
                mode: 'text',
                text: x1,
                textfont: {
                    size: 12,
                    color: 'black'
                },
                showlegend: false,
                hoverinfo: 'skip'
            };
            
            const layout = {
                title: '用户转化漏斗图',
                xaxis: { 
                    title: '客户数量',
                    showticklabels: false
                },
                yaxis: { 
                    title: '',
                    tickmode: 'array',
                    tickvals: stages,
                    ticktext: stages
                },
                showlegend: false,
                margin: { t: 50, r: 80, b: 40, l: 80 },
                height: 400,
                barmode: 'overlay'
            };
            
            Plotly.newPlot('funnel-chart', [trace1, trace2, trace3, trace4, trace5, trace6], layout, {responsive: true});
        }

        // 创建桑基图 (8.8) - 基于第8章数据：生活消费分配
        function createSankeyChart() {
            // 第8章桑基图数据：flows = [0.7, 0.3, -0.3, -0.1, -0.3, -0.1, -0.1, -0.1]
            // labels = ["工资", "副业", "生活", "购物", "深造", "运动", "其他", "买书"]
            const data = {
                type: "sankey",
                arrangement: "snap",
                node: {
                    pad: 15,
                    thickness: 30,
                    line: {
                        color: "black",
                        width: 0.5
                    },
                    label: ["工资", "副业", "生活", "购物", "深造", "运动", "其他", "买书"],
                    color: ["lightgreen", "lightgreen", "lightcoral", "lightcoral", "lightcoral", "lightcoral", "lightcoral", "lightcoral"]
                },
                link: {
                    // 工资收入分配：生活(0.3), 购物(0.1), 深造(0.1), 运动(0.1), 其他(0.1)
                    // 副业收入分配：生活(0.1), 买书(0.1)
                    source: [0, 0, 0, 0, 0, 1, 1],
                    target: [2, 3, 4, 5, 6, 2, 7],
                    value: [0.3, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1],
                    color: "rgba(144, 238, 144, 0.5)"
                }
            };
            
            const layout = {
                title: "日常生活开支的桑基图",
                font: {
                    size: 12,
                    family: "Arial, sans-serif"
                },
                margin: { t: 50, r: 30, b: 30, l: 30 },
                height: 400
            };
            
            Plotly.newPlot('sankey-chart', [data], layout, {responsive: true});
        }

        // 创建树状图
        function createTreeChart() {
            const nodes = [
                {x: 0, y: 0, text: "根节点", size: 20},
                {x: -2, y: 1, text: "分支A", size: 15},
                {x: 2, y: 1, text: "分支B", size: 15},
                {x: -3, y: 2, text: "叶子A1", size: 10},
                {x: -1, y: 2, text: "叶子A2", size: 10},
                {x: 1, y: 2, text: "叶子B1", size: 10},
                {x: 3, y: 2, text: "叶子B2", size: 10}
            ];
            
            const connections = [
                {x0: 0, y0: 0, x1: -2, y1: 1},
                {x0: 0, y0: 0, x1: 2, y1: 1},
                {x0: -2, y0: 1, x1: -3, y1: 2},
                {x0: -2, y0: 1, x1: -1, y1: 2},
                {x0: 2, y0: 1, x1: 1, y1: 2},
                {x0: 2, y0: 1, x1: 3, y1: 2}
            ];
            
            const lineTraces = connections.map(conn => ({
                x: [conn.x0, conn.x1],
                y: [conn.y0, conn.y1],
                mode: 'lines',
                line: { color: 'blue', width: 2 },
                showlegend: false
            }));
            
            const nodeTrace = {
                x: nodes.map(n => n.x),
                y: nodes.map(n => n.y),
                mode: 'markers+text',
                marker: {
                    size: nodes.map(n => n.size),
                    color: 'lightblue'
                },
                text: nodes.map(n => n.text),
                textposition: 'middle center'
            };
            
            const layout = {
                title: '层次结构树状图',
                xaxis: { showgrid: false, zeroline: false, showticklabels: false },
                yaxis: { showgrid: false, zeroline: false, showticklabels: false },
                margin: { t: 40, r: 20, b: 20, l: 20 },
                height: 350
            };
            
            Plotly.newPlot('tree-chart', [...lineTraces, nodeTrace], layout, {responsive: true});
        }

        // 创建华夫饼图 (8.10) - 电影《少年的你》上座率
        function createWaffleChart() {
            const gridSize = 10;
            const totalCells = gridSize * gridSize;
            const percentage = 95; // 95%的上座率
            const filledCells = Math.round(totalCells * percentage / 100);
            
            const x = [];
            const y = [];
            const colors = [];
            const text = [];
            
            for (let row = 0; row < gridSize; row++) {
                for (let col = 0; col < gridSize; col++) {
                    const cellIndex = row * gridSize + col;
                    x.push(col);
                    y.push(gridSize - row - 1);
                    
                    if (cellIndex < filledCells) {
                        colors.push('#20B2AA'); // 已占座颜色
                        text.push('');
                    } else {
                        colors.push('#D3D3D3'); // 空座颜色
                        text.push('');
                    }
                }
            }
            
            const trace = {
                x: x,
                y: y,
                mode: 'markers',
                type: 'scatter',
                marker: {
                    color: colors,
                    size: 30,
                    line: {
                        color: 'white',
                        width: 2
                    }
                },
                text: text,
                hoverinfo: 'none'
            };
            
            const layout = {
                title: '电影《少年的你》上座率',
                xaxis: { 
                    title: '',
                    range: [-0.5, gridSize - 0.5],
                    showgrid: false,
                    zeroline: false,
                    showticklabels: false
                },
                yaxis: { 
                    title: '',
                    range: [-0.5, gridSize - 0.5],
                    showgrid: false,
                    zeroline: false,
                    showticklabels: false
                },
                margin: { t: 40, r: 20, b: 20, l: 20 },
                height: 350,
                showlegend: false
            };
            
            Plotly.newPlot('waffle-chart', [trace], layout, {responsive: true});
        }

        // 初始化所有图表
        function initializeCharts() {
            console.log("开始初始化图表...");
            
            try {
                createContourChart();
                console.log("等高线图创建成功");
            } catch (e) {
                console.error("等高线图创建失败:", e);
            }
            
            try {
                createStreamPlot();
                console.log("矢量场流线图创建成功");
            } catch (e) {
                console.error("矢量场流线图创建失败:", e);
            }
            
            try {
                createStemChart();
                console.log("棉棒图创建成功");
            } catch (e) {
                console.error("棉棒图创建失败:", e);
            }
            
            try {
                createDumbbellChart();
                console.log("哑铃图创建成功");
            } catch (e) {
                console.error("哑铃图创建失败:", e);
            }
            
            try {
                createGanttChart();
                console.log("甘特图创建成功");
            } catch (e) {
                console.error("甘特图创建失败:", e);
            }
            
            try {
                createPyramidChart();
                console.log("人口金字塔图创建成功");
            } catch (e) {
                console.error("人口金字塔图创建失败:", e);
            }
            
            try {
                createFunnelChart();
                console.log("漏斗图创建成功");
            } catch (e) {
                console.error("漏斗图创建失败:", e);
            }
            
            try {
                createSankeyChart();
                console.log("桑基图创建成功");
            } catch (e) {
                console.error("桑基图创建失败:", e);
            }
            
            try {
                createTreeChart();
                console.log("树状图创建成功");
            } catch (e) {
                console.error("树状图创建失败:", e);
            }
            
            try {
                createWaffleChart();
                console.log("华夫饼图创建成功");
            } catch (e) {
                console.error("华夫饼图创建失败:", e);
            }
            
            chartsCreated = true;
            console.log("所有图表初始化完成");
        }

        // 页面加载完成后初始化
        document.addEventListener('DOMContentLoaded', function() {
            console.log("页面加载完成");
            setTimeout(initializeCharts, 500);
        });

        // 响应式处理
        window.addEventListener('resize', function() {
            if (chartsCreated) {
                const chartIds = ['contour-chart', 'streamplot-chart', 'stem-chart', 'dumbbell-chart', 
                                 'gantt-chart', 'pyramid-chart', 'funnel-chart', 'sankey-chart', 
                                 'tree-chart', 'waffle-chart'];
                
                chartIds.forEach(id => {
                    const element = document.getElementById(id);
                    if (element) {
                        Plotly.Plots.resize(element);
                    }
                });
            }
        });
    </script>
</body>
</html>